<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.79.1"><link rel=stylesheet href=https://cloudmesh.github.io/pi/css/terminal-macos.css><link rel=stylesheet href=https://cloudmesh.github.io/pi/css/terminal-ubuntu.css><link rel=stylesheet href=https://cloudmesh.github.io/pi/css/terminal-gitbash.css><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/pi/favicons/favicon.ico><link rel=apple-touch-icon href=/pi/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/pi/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/pi/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pi/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/pi/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/pi/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/pi/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/pi/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/pi/favicons/android-192x192.png sizes=192x192><title>Create and Deploy a Container and OpenAPI Service with Docker and K3s | Cloudmesh Cluster Pi Planet</title><meta property="og:title" content="Create and Deploy a Container and OpenAPI Service with Docker and K3s"><meta property="og:description" content="This post is walks you through using your pi cluster to create and deploy a container and OpenAPI Service on Docker and K3s"><meta property="og:type" content="article"><meta property="og:url" content="https://cloudmesh.github.io/pi/tutorial/create-deploy-container-k3/"><meta property="og:image" content="https://cloudmesh.github.io/pi/tutorial/create-deploy-container-k3/featured-dashboard.png"><meta property="article:published_time" content="2021-05-07T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-11T13:28:05-04:00"><meta property="og:site_name" content="Cloudmesh Cluster Pi Planet"><meta itemprop=name content="Create and Deploy a Container and OpenAPI Service with Docker and K3s"><meta itemprop=description content="This post is walks you through using your pi cluster to create and deploy a container and OpenAPI Service on Docker and K3s"><meta itemprop=datePublished content="2021-05-07T00:00:00+00:00"><meta itemprop=dateModified content="2021-05-11T13:28:05-04:00"><meta itemprop=wordCount content="2442"><meta itemprop=image content="https://cloudmesh.github.io/pi/tutorial/create-deploy-container-k3/featured-dashboard.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cloudmesh.github.io/pi/tutorial/create-deploy-container-k3/featured-dashboard.png"><meta name=twitter:title content="Create and Deploy a Container and OpenAPI Service with Docker and K3s"><meta name=twitter:description content="This post is walks you through using your pi cluster to create and deploy a container and OpenAPI Service on Docker and K3s"><link rel=preload href=/pi/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css as=style><link href=/pi/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/pi/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zM197.0804 232.033c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zM197.0804 177.6188c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zM197.5309 286.4723c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zM197.0804 340.5784c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Cloudmesh Cluster Pi Planet</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pi/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pi/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pi/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pi/community/><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/pi/tutorial/><span class=active>Tutorials</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/pi/tutorial/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Tutorials</a></li><ul><li class="collapse show" id=pitutorial><a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialraspberry-burn-windows href=/pi/tutorial/raspberry-burn-windows/>DRAFT: Burning a Preconfigured Pi Cluster from your OS (not approved yet)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialmpi href=/pi/tutorial/mpi/>Deploy MPI for Python (mpi4py) on your Pi Cluster</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-pitutorialcreate-deploy-container-k3 href=/pi/tutorial/create-deploy-container-k3/>Create and Deploy a Container and OpenAPI Service with Docker and K3s</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialk3s-cluster href=/pi/tutorial/k3s-cluster/>Deploy K3S on a Pi Cluster</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialanalytics-services href=/pi/tutorial/analytics-services/>Analytics Services</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialraspberry-burn href=/pi/tutorial/raspberry-burn/>Burning a set of pre-configured Raspberry OS cards for Raspberry Pis with Wifi Access</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialubuntu-burn href=/pi/tutorial/ubuntu-burn/>Burning a set of Ubuntu Server Cards for Raspberry Pis with Internet Access</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialgui-burn href=/pi/tutorial/gui-burn/>Burning a Cluster using Cloudmesh Burn GUI</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialgh-command href=/pi/tutorial/gh-command/>Command gh</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialcms-commands href=/pi/tutorial/cms-commands/>Cms Commands</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutoriallinks href=/pi/tutorial/links/>Links</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialnetwork-scanning-tutorial href=/pi/tutorial/network-scanning-tutorial/>Network Scanning Tutorial</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialport-forwarding-ssh-tunnels href=/pi/tutorial/port-forwarding-ssh-tunnels/>Port Forwarding Tutorial</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialubuntu href=/pi/tutorial/ubuntu/>Ubuntu</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-pitutorialusermanagement href=/pi/tutorial/usermanagement/>User Management</a></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudmesh/pi//edit/main/content/en/tutorial/create-deploy-container-k3/index.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/cloudmesh/pi//new/main/content/en/tutorial/create-deploy-container-k3/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i>Create child page</a>
<a href="https://github.com/cloudmesh/pi//issues/new?title=Create%20and%20Deploy%20a%20Container%20and%20OpenAPI%20Service%20with%20Docker%20and%20K3s" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href=https://github.com/cloudmesh/pi//issues/new target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a>
<a id=print href=https://cloudmesh.github.io/pi/tutorial/_print/><i class="fa fa-print fa-fw"></i>Print entire section</a></div><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-prerequisites>2. Prerequisites</a></li><li><a href=#3-install-docker>3. Install Docker</a></li><li><a href=#4-create-a-dockerfile>4. Create a Dockerfile</a></li><li><a href=#5-build-a-docker-image>5. Build a Docker Image</a></li><li><a href=#6-start-a-docker-container>6. Start a Docker Container</a></li><li><a href=#7-generate-and-start-the-cloudmesh-openapi-pipelineanovasvm-service>7. Generate and Start the Cloudmesh-Openapi PipelineAnovaSVM Service</a></li><li><a href=#8-interact-with-the-running-service>8. Interact with the Running Service</a></li><li><a href=#9-save-a-docker-image>9. Save a Docker Image</a></li><li><a href=#10-install-k3s-on-our-pi-cluster>10. Install K3s on our Pi Cluster</a></li><li><a href=#11-import-the-cloudmesh-openapi-image-into-all-k3s-nodes>11. Import the <code>cloudmesh-openapi</code> Image into All K3s Nodes</a></li><li><a href=#12-create-a-kubernetes-pod-manifest-yaml>12. Create a Kubernetes Pod Manifest YAML</a></li><li><a href=#13-deploy-a-pod>13. Deploy a Pod</a></li><li><a href=#14-start-a-shell-in-the-pod>14. Start a Shell in the Pod</a></li><li><a href=#15-create-a-kubernetes-service-manifest-to-start-a-k3s-load-balancer>15. Create a Kubernetes Service Manifest to Start a K3s Load-Balancer</a></li><li><a href=#16-deploy-the-loadbalancer-service>16. Deploy the LoadBalancer Service</a></li><li><a href=#17-interact-with-the-cloudmesh-openapi-pod>17. Interact with the <code>cloudmesh-openapi</code> Pod</a></li><li><a href=#18-automatically-deploy-an-openapi-service>18. Automatically deploy an OpenApi Service</a></li><li><a href=#19-creating-a-kubernetes-dashboard-to-monitor-the-services>19. Creating a Kubernetes Dashboard to Monitor the Services.</a></li><li><a href=#20-accessing-the-dashboard>20. Accessing the Dashboard</a></li><li><a href=#21-restarting-an-openapi-service-after-reboot>21. Restarting an OpenAPI service after Reboot.</a></li><li><a href=#22-commands-useful-for-debugging>22. Commands Useful for Debugging</a></li><li><a href=#23-uninstall-k3s>23. Uninstall K3s</a></li><li><a href=#24-uninstall-docker>24. Uninstall Docker</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><h1>Create and Deploy a Container and OpenAPI Service with Docker and K3s</h1><div class=lead>This post is walks you through using your pi cluster to create and deploy a container and OpenAPI Service on Docker and K3s</div><div class="td-byline mb-4">By <b>Anthony Orlowski(<a href=mailto:antorlowski@gmail.com>antorlowski@gmail.com</a>), Richard Otten, Gregor von Laszewski (<a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>) <a href=https://laszewski.github.io>laszewski.github.io</a></b> |
<time datetime=2021-05-07 class=text-muted>2021.05.07</time></div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:1121px><img class=card-img-top src=/pi/tutorial/create-deploy-container-k3/featured-dashboard_hu3bdb24a6878631c4ef3df1aa73d2ab37_260775_1111x610_fill_catmullrom_smart1_2.png width=1111 height=610><div class="card-body px-0 pt-2 pb-0"><p class=card-text></p></div></div><div class="pageinfo pageinfo-primary"><p>In this tutorial we will use a cms-burn created cluster to install Docker,
create a Docker container for the cloudmesh-openapi service, deploy the
container on Docker, install K3s, deploy the container on K3s, and enable
access to the container from an external host. Finally, automatically deploy
an OpenApi service onto a K3s cluster given only its python and yaml files.</p><p>This is currently (4/29/21) tested on a Raspberry pi using Ubuntu OS.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to install Docker, create a docker container, deploy a docker
container, install k3s, deploy a container on K3s, make K3s
containers externally accessible.</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-prerequisites>2. Prerequisites</a></li><li><a href=#3-install-docker>3. Install Docker</a></li><li><a href=#4-create-a-dockerfile>4. Create a Dockerfile</a></li><li><a href=#5-build-a-docker-image>5. Build a Docker Image</a></li><li><a href=#6-start-a-docker-container>6. Start a Docker Container</a></li><li><a href=#7-generate-and-start-the-cloudmesh-openapi-pipelineanovasvm-service>7. Generate and Start the Cloudmesh-Openapi PipelineAnovaSVM Service</a></li><li><a href=#8-interact-with-the-running-service>8. Interact with the Running Service</a></li><li><a href=#9-save-a-docker-image>9. Save a Docker Image</a></li><li><a href=#10-install-k3s-on-our-pi-cluster>10. Install K3s on our Pi Cluster</a></li><li><a href=#11-import-the-cloudmesh-openapi-image-into-all-k3s-nodes>11. Import the <code>cloudmesh-openapi</code> Image into All K3s Nodes</a></li><li><a href=#12-create-a-kubernetes-pod-manifest-yaml>12. Create a Kubernetes Pod Manifest YAML</a></li><li><a href=#13-deploy-a-pod>13. Deploy a Pod</a></li><li><a href=#14-start-a-shell-in-the-pod>14. Start a Shell in the Pod</a></li><li><a href=#15-create-a-kubernetes-service-manifest-to-start-a-k3s-load-balancer>15. Create a Kubernetes Service Manifest to Start a K3s Load-Balancer</a></li><li><a href=#16-deploy-the-loadbalancer-service>16. Deploy the LoadBalancer Service</a></li><li><a href=#17-interact-with-the-cloudmesh-openapi-pod>17. Interact with the <code>cloudmesh-openapi</code> Pod</a></li><li><a href=#18-automatically-deploy-an-openapi-service>18. Automatically deploy an OpenApi Service</a></li><li><a href=#19-creating-a-kubernetes-dashboard-to-monitor-the-services>19. Creating a Kubernetes Dashboard to Monitor the Services.</a></li><li><a href=#20-accessing-the-dashboard>20. Accessing the Dashboard</a></li><li><a href=#21-restarting-an-openapi-service-after-reboot>21. Restarting an OpenAPI service after Reboot.</a></li><li><a href=#22-commands-useful-for-debugging>22. Commands Useful for Debugging</a></li><li><a href=#23-uninstall-k3s>23. Uninstall K3s</a></li><li><a href=#24-uninstall-docker>24. Uninstall Docker</a></li></ul></nav></div></div><h2 id=1-introduction>1. Introduction</h2><p>Many tutorials walk you through individual components of our learning
objectives. This tutorial will walk you through step-by-step to create a
service and deploy it on a cms-brun created cluster.</p><h2 id=2-prerequisites>2. Prerequisites</h2><p>This tutorial assumes a cluster burned using one of the following methods:</p><p><a href=https://cloudmesh.github.io/pi/tutorial/raspberry-burn/>Burn a Raspberry OS Cluster</a> (not currently tested)</p><p><a href=https://cloudmesh.github.io/pi/tutorial/ubuntu-burn/>Burn an Ubuntu Cluster</a> (currently tested)</p><p><a href=https://cloudmesh.github.io/pi/tutorial/gui-burn/>Use our GUI to Burn a Cluster</a></p><h2 id=3-install-docker>3. Install Docker</h2><p>Access your cluster manager (red) and get the cloudmesh Docker installer.</p><pre><code>laptop$ ssh red
red$ cd cm
red$ cloudmesh-installer get docker-command
red$ cd ..
</code></pre><p>Now we install Docker.</p><pre><code>red$ cms docker deploy --host=localhost
</code></pre><p>Let us add our user to the Docker group so we can execute Docker comands without <code>sudo</code>.</p><pre><code>red$ sudo usermod -aG docker ubuntu
</code></pre><p>Let us verify the install by checking the version.</p><pre><code>red$ docker version
</code></pre><h2 id=4-create-a-dockerfile>4. Create a Dockerfile</h2><p>We will create a file named <code>Dockerfile</code> in a directory
<code>cloudmesh-openapi-container</code>. Substitute your prefered editor if you do not
like emacs.</p><pre><code>red$ mkdir cloudmesh-openapi-container
red$ cd cloudmesh-openapi-container
red$ emacs Dockerfile
</code></pre><p>In <code>Dockerfile</code> add the following lines. This provides Docker the commands
needed to install <a href=https://cloudmesh.github.io/pi/tutorial/analytics-services/>cloudmesh-openapi</a>
and the needed packages for our PipleLineAnovaSVM example into a Ubuntu
container.</p><pre><code># syntax=docker/dockerfile:1
FROM ubuntu:20.04
RUN mkdir cm
RUN apt update
RUN apt install python3-venv python3-wheel python3-dev python3-pip build-essential -y
RUN ln -s /usr/bin/pip3 /usr/bin/pip
RUN pip install pip -U
RUN pip install cloudmesh-installer
RUN apt install git -y
RUN cd cm; cloudmesh-installer get openapi
RUN pip install sklearn pandas
ARG DEBIAN_FRONTEND=noninteractive
ENV TZ=America/Indiana/Indianapolis
RUN apt install tzdata -y
RUN apt install emacs -y
CMD /bin/bash
</code></pre><h2 id=5-build-a-docker-image>5. Build a Docker Image</h2><p>Now we build an image based on the instructions provided in <code>Dockerfile</code>. We
name the image <code>cloudmesh-openapi</code>. The <code>.</code> instructs Docker to use the
Dockerfile in the present working directory.</p><pre><code>red$ docker build -t cloudmesh-openapi .
</code></pre><h2 id=6-start-a-docker-container>6. Start a Docker Container</h2><p>Now we start a Docker containe using our <code>cloudmesh-openapi</code> image. The
<code>-it</code> provide an interactive terminal, the <code>-p</code> maps the container port 8080
to the host port 8080, and <code>/bin/bash</code> is the command to run in the container.</p><pre><code>red$ docker run -it -p 8080:8080 cloudmesh-openapi /bin/bash
</code></pre><h2 id=7-generate-and-start-the-cloudmesh-openapi-pipelineanovasvm-service>7. Generate and Start the Cloudmesh-Openapi PipelineAnovaSVM Service</h2><p>Generate the service yaml.</p><pre><code>container$ cms openapi generate PipelineAnovaSVM \
    --filename=./tests/Scikitlearn-experimental/sklearn_svm.py \
    --import_class \
    --enable_upload
</code></pre><p>Start the service (defaults to port 8080). Leave this running and go to a
new terminal.</p><pre><code>container$ cms openapi server start ./tests/Scikitlearn-experimental/sklearn_svm.yaml --host=0.0.0.0
</code></pre><h2 id=8-interact-with-the-running-service>8. Interact with the Running Service</h2><p>In another terminal on your laptop you can now access the service from
<code>red.local:8080</code> because we mapped the container port 8080 to the host port 8080.</p><p>In a web browser go to <code>http://red.local:8080/cloudmesh/ui</code> to access the
web UI of the service.</p><p>Alternatively, you can access the service directly from the command line of
your laptop.</p><pre><code>laptop$ curl -L -o iris.data &quot;https://raw.githubusercontent.com/cloudmesh/cloudmesh-openapi/main/tests/Scikitlearn-experimental/iris.data&quot;

laptop$ export CMSIP=red.local:8080

laptop$ curl -X POST &quot;http://$CMSIP/cloudmesh/upload&quot; -H  &quot;accept: text/plain&quot; -H  &quot;Content-Type: multipart/form-data&quot; -F &quot;upload=@iris.data&quot;

laptop$ curl -X GET &quot;http://$CMSIP/cloudmesh/PipelineAnovaSVM/train?filename=iris.data&quot; -H  &quot;accept: text/plain&quot;

laptop$ curl -X GET &quot;http://$CMSIP/cloudmesh/PipelineAnovaSVM/make_prediction?model_name=iris&amp;params=5.1%2C%203.5%2C%201.4%2C%200.2&quot; -H  &quot;accept: */*&quot;
</code></pre><p>You can now <code>ctrl-C</code> and <code>exit</code> the running container to stop the service.</p><h2 id=9-save-a-docker-image>9. Save a Docker Image</h2><p>We need to save the Docker image so we can provide it to our K3s cluster.
alternatively you can upload it to a Docker registry like DockerHub.</p><p>We save our image in a tarfile named <code>cloudmesh-openapi.tar</code>.</p><pre><code>red$ docker save --output cloudmesh-openapi.tar cloudmesh-openapi:latest
</code></pre><p>We will reference this file later to import it to our K3s cluster.</p><h2 id=10-install-k3s-on-our-pi-cluster>10. Install K3s on our Pi Cluster</h2><p>Enable containers in the kernel, and wait for the cluster to reboot.</p><pre><code>laptop$ cms pi k3 enable containers red,red[01-03]
</code></pre><p>Now install K3s</p><pre><code>laptop$ cms pi k3 install cluster red,red0[1-3]
</code></pre><p>Verify all nodes show up.</p><pre><code>laptop$ cms pi k3 cluster info
</code></pre><h2 id=11-import-the-cloudmesh-openapi-image-into-all-k3s-nodes>11. Import the <code>cloudmesh-openapi</code> Image into All K3s Nodes</h2><p>As we are not using an image repository, we need to copy our
<code>cloudmesh-openapi.tar</code> file to all k3s nodes and import them image into
K3s.</p><pre><code>red$ cms pi k3 import image red,red0[1-3] cloudmesh-openapi.tar /home/ubuntu

pi k3 import image red,red0[1-3] cloudmesh-openapi.tar /home/ubuntu
INFO: Copying image to ['red', 'red01', 'red02', 'red03'] using source: cloudmesh-openapi.tar and destination: /home/ubuntu
INFO: This may take a few minutes depending on the file size and number of destinations
+---------+---------+--------+
| host    | success | stdout |
+---------+---------+--------+
| red     | True    |        |
| red01   | True    |        |
| red02   | True    |        |
| red03   | True    |        |
+---------+---------+--------+
INFO: Import image on ['red', 'red01', 'red02', 'red03'] using filepath:/home/ubuntu/cloudmesh-openapi.tar
+---------+---------+--------------------------------------------------+
| host    | success | stdout                                           |
+---------+---------+--------------------------------------------------+
| red     | True    | unpacking docker.io/library/cloudmesh-           |
|         |         | openapi:latest (sha256:829d62dafbb8c3335804517d6 |
|         |         | 00313e64be1983b93286328f6c0f66f7c4781ad)...done  |
| red01   | True    | unpacking docker.io/library/cloudmesh-           |
|         |         | openapi:latest (sha256:829d62dafbb8c3335804517d6 |
|         |         | 00313e64be1983b93286328f6c0f66f7c4781ad)...done  |
| red02   | True    | unpacking docker.io/library/cloudmesh-           |
|         |         | openapi:latest (sha256:829d62dafbb8c3335804517d6 |
|         |         | 00313e64be1983b93286328f6c0f66f7c4781ad)...done  |
| red03   | True    | unpacking docker.io/library/cloudmesh-           |
|         |         | openapi:latest (sha256:829d62dafbb8c3335804517d6 |
|         |         | 00313e64be1983b93286328f6c0f66f7c4781ad)...done  |
+---------+---------+--------------------------------------------------+
</code></pre><p>Validate the container is present.</p><pre><code>red$ sudo k3s ctr images list 
</code></pre><h2 id=12-create-a-kubernetes-pod-manifest-yaml>12. Create a Kubernetes Pod Manifest YAML</h2><p>To create Pod in Kubernetes, you need to define a YAML file. We create one
named <code>cloudmesh-openapi-pod.yaml</code>. The pod is the smallest deployable unit
of computing in K8s, and is a group of one or more containers. In our case one.</p><p>Create <code>cloudmesh-openapi-pod.yaml</code> and paste the following lines in the
document.</p><pre><code>apiVersion: v1
kind: Pod
metadata:
  name: cloudmesh-openapi-pod
  labels:
    app: cloudmesh-openapi-pod
spec:
  containers:
  - name: cloudmesh-openapi
    image: cloudmesh-openapi:latest
    imagePullPolicy: Never
    command:
      - &quot;sleep&quot;
      - &quot;604800&quot;
</code></pre><p>This will define a pod named <code>cloudmesh-openapi-pod</code>, containing
one container named <code>cloudmesh-openapi</code> based on our
<code>cloudmesh-openapi:latest</code> image, running the command <code>sleep 604800</code>. This
will essentially keep our container running for 7 days and then it will
close and restart based on the default restart policy: ALWAYS. The <code>. metadata.label.app</code> is important as it allows us to select our pod in our
in our following load-balancer service. The <code>.spec.imagePullPolicy: Never</code>
is also important as it prevents K8s from trying to download our image from
any repository and instead use the local copy.</p><h2 id=13-deploy-a-pod>13. Deploy a Pod</h2><p>Deploy your pod by applying the <code>cloudmesh-openapi-pod.yaml</code> configuration.</p><pre><code>red$ sudo kubectl apply -f ./cloudmesh-openapi-pod.yaml
</code></pre><p>Check that the pod is running.</p><pre><code>red$ sudo kubectl get pods
</code></pre><h2 id=14-start-a-shell-in-the-pod>14. Start a Shell in the Pod</h2><p>We need to start a shell in our Pod so we can generate and run the
cloudmesh-openapi service.</p><pre><code>red$ sudo kubectl exec --stdin --tty cloudmesh-openapi-pod -- /bin/bash
</code></pre><p>We can now run our serice generate and start command.</p><pre><code>container$ cms openapi generate PipelineAnovaSVM \
    --filename=./tests/Scikitlearn-experimental/sklearn_svm.py \
    --import_class \
    --enable_upload
</code></pre><pre><code>container$ cms openapi server start ./tests/Scikitlearn-experimental/sklearn_svm.yaml --host=0.0.0.0
</code></pre><p>You can now <code>exit</code> and the container and the service will continue running.</p><h2 id=15-create-a-kubernetes-service-manifest-to-start-a-k3s-load-balancer>15. Create a Kubernetes Service Manifest to Start a K3s Load-Balancer</h2><p>Kubernetes services expose your cluster Pods to external networks. K3s comes
with a build int load balancer that watches for Kubernetes LoadBalancer
services, and then deploys the necessary network infrastructure to make your
service accessible.</p><p>Create a file names <code>cloudmesh-openapi-lb-service.yaml</code> and paste the
following lines.</p><pre><code>apiVersion: v1
kind: Service
metadata:
  name: cloudmesh-openapi-lb-service
spec:
  selector:
    app: cloudmesh-openapi-pod
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
      nodePort: 30000
  type: LoadBalancer
</code></pre><p>It is important that the <code>.spec.selector.app</code> matches that defined in your
pod yaml. The <code>port</code> is the port accessible on cluster internal nodes, the
<code>targetPort</code> is the port in the container to which traffic will be forwarded,
and the <code>nodePort</code> is the port on cluster external networks can access the
service. This must match a predefined range.</p><h2 id=16-deploy-the-loadbalancer-service>16. Deploy the LoadBalancer Service</h2><p>Deploy the loadbalancer.</p><pre><code>red$ sudo kubectl apply -f ./cloudmesh-openapi-lb.service.yaml
</code></pre><p>Check to ensure it deployed.</p><pre><code>red$ sudo kubectl get services -o wide
</code></pre><p>Check to see the load balancer pods are deployed on all agent nodes.</p><pre><code>red$ sudo kubectl get pods
</code></pre><h2 id=17-interact-with-the-cloudmesh-openapi-pod>17. Interact with the <code>cloudmesh-openapi</code> Pod</h2><p>Because the loadbalancer is running on all nodes and forwarding traffic to
the existing pod, we can now reach our service from our laptop at <code>red.local:30000</code>. For some
reason <code>red.local:8080</code> works as well, I can&rsquo;t explain that yet.</p><p>On your laptop web browser browse to <code>http://red.local:30000/cloudmesh/ui</code></p><p>Alternatively, interact with the service from the command line.</p><pre><code>laptop$ curl -L -o iris.data &quot;https://raw.githubusercontent.com/cloudmesh/cloudmesh-openapi/main/tests/Scikitlearn-experimental/iris.data&quot;

laptop$ export CMSIP=red.local:30000

laptop$ curl -X POST &quot;http://$CMSIP/cloudmesh/upload&quot; -H  &quot;accept: text/plain&quot; -H  &quot;Content-Type: multipart/form-data&quot; -F &quot;upload=@iris.data&quot;

laptop$ curl -X GET &quot;http://$CMSIP/cloudmesh/PipelineAnovaSVM/train?filename=iris.data&quot; -H  &quot;accept: text/plain&quot;

laptop$ curl -X GET &quot;http://$CMSIP/cloudmesh/PipelineAnovaSVM/make_prediction?model_name=iris&amp;params=5.1%2C%203.5%2C%201.4%2C%200.2&quot; -H  &quot;accept: */*&quot;
</code></pre><h2 id=18-automatically-deploy-an-openapi-service>18. Automatically deploy an OpenApi Service</h2><p>We have provided a command that can automatically deploy an OpenAPI service
given the YAML file, python file, the server, and the ports you want it
deployed on. We expect the user to have previously used cloudmesh-openapi to
generate these files as needed.</p><p><code>cms pi k3 api deploy SERVER PORTS YAML PYTHON</code></p><p>Below is an example command invocation where whe deploy the Scikilearn Pipeline Anova SVM example as a service using the yaml file <code>sklearn_svm.yaml</code> and the python file <code>sklearn_svm_upload-enabled.py</code></p><pre><code>laptop$ cms pi k3 api deploy red 80[80-85] sklearn_svm.yaml sklearn_svm_upload-enabled.py

pi k3 api deploy red 80[80-85] sklearn_svm.yaml sklearn_svm_upload-enabled.py
INFO: Deploying cloudmesh openapi service based on yaml:sklearn_svm.yaml 
python file: sklearn_svm_upload-enabled.py to ports: ['8080', '8081', '8082','8083', '8084', '8085'] on server red
INFO: Deploying service for port: 8080
INFO: Deploying service for port: 8081
INFO: Deploying service for port: 8082
INFO: Deploying service for port: 8083
INFO: Deploying service for port: 8084
INFO: Deploying service for port: 8085
INFO: Services are available at:
NAME                                                 TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)          AGE
kubernetes                                           ClusterIP      10.43.0.1       &lt;none&gt;         443/TCP          39h
cloudmesh-openapi-sklearn-svm-port-8080-lb-service   LoadBalancer   10.43.157.137   192.168.1.16   8080:30988/TCP   89s
cloudmesh-openapi-sklearn-svm-port-8081-lb-service   LoadBalancer   10.43.105.151   192.168.1.16   8081:31733/TCP   69s
cloudmesh-openapi-sklearn-svm-port-8082-lb-service   LoadBalancer   10.43.66.0      192.168.1.16   8082:30442/TCP   55s
cloudmesh-openapi-sklearn-svm-port-8083-lb-service   LoadBalancer   10.43.212.54    192.168.1.16   8083:31632/TCP   33s
cloudmesh-openapi-sklearn-svm-port-8084-lb-service   LoadBalancer   10.43.52.81     192.168.1.16   8084:30334/TCP   22s
cloudmesh-openapi-sklearn-svm-port-8085-lb-service   LoadBalancer   10.43.238.192   192.168.1.16   8085:31442/TCP   8s
</code></pre><p>You can now access and interact with the service in the same manner as we
conducted in section 17.</p><h2 id=19-creating-a-kubernetes-dashboard-to-monitor-the-services>19. Creating a Kubernetes Dashboard to Monitor the Services.</h2><p>Next we will install a Kubernetes Dashboard so we can monitor the resource
consumption of our services.</p><p>If using Raspberry OS on the pis, run:</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard create red
</code></pre><p>If using Ubuntu Server on the pis, run:</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard create red --ubuntu
</code></pre><p>Both commands will automatically start the dashboard. However, on Ubuntu Server, <code>cms pi k3 dashboard start red</code> needs to be run when the pi is rebooted.</p><h2 id=20-accessing-the-dashboard>20. Accessing the Dashboard</h2><p>We can easily access the Web UI Dashboard for easy management of our cluster.</p><p>First, let us connect to the new dashboard created above.</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard connect red
</code></pre><p>We should get a green &ldquo;Connection created&rdquo; message. We can now check on the status of our dashboard and obtain our token to log in.</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard info
pi k3 dashboard info
INFO: Finding running dashboards...
+---------------------+-------------+------------+------------------+-------+
| Server Access Point | Remote Port | Local Port | Dashboard Status | PID   |
+---------------------+-------------+------------+------------------+-------+
| red                 | 8001        | 8001       | Active           | 99240 |
+---------------------+-------------+------------+------------------+-------+
INFO: Dashboard Link:
http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
INFO: Fetching authentication token...
# A long token will go here
</code></pre><blockquote><p>Note. If <code>Dasboard Status</code> says &ldquo;Up but not ready&rdquo;, the k3s dashboard is still likely in the process of coming online. Wait a few moments and try the info command again.</p></blockquote><p>Take note of the authentication token given. To open the dashboard, you may click on the link provided by the info command or use the following command to automaticallly open in browser.</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard
pi k3 dashboard
Opening dashboard...
</code></pre><p>You can monitor your pods resources consumption on the Pods tab.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:1121px><img class=card-img-top src=/pi/tutorial/create-deploy-container-k3/featured-dashboard_hu3bdb24a6878631c4ef3df1aa73d2ab37_260775_1111x610_fill_catmullrom_smart1_2.png width=1111 height=610><div class="card-body px-0 pt-2 pb-0"><p class=card-text></p></div></div><p>When ready, you can then disconnect from your dashboard with the following:</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard disconnect
</code></pre><h2 id=21-restarting-an-openapi-service-after-reboot>21. Restarting an OpenAPI service after Reboot.</h2><p>While hte containers will persist after a reboot, the services do not
currently automatically restart.</p><p>To restart the service suse the command</p><p><code>cms pi k3 api start SERVER PORTS YAML PYTHON</code></p><p>The YAML and PYTHON require the base filename only, they are not re-copied.</p><p>Here is an example invocation.</p><pre><code>laptopl$ cms pi k3 api start red 80[80-89] sklearn_svm.yaml sklearn_svm_upload-enabled.py
pi k3 api start red 80[80-89] sklearn_svm.yaml sklearn_svm_upload-enabled.py
INFO: Starting services in on ports ['8080', '8081', '8082', '8083', '8084', '8085']
INFO: Service on 8080 successfully started
INFO: Service on 8081 successfully started
INFO: Service on 8082 successfully started
INFO: Service on 8083 successfully started
INFO: Service on 8084 successfully started
INFO: Service on 8085 successfully started
</code></pre><h2 id=22-commands-useful-for-debugging>22. Commands Useful for Debugging</h2><p>Useful <code>kubectl</code> commands to debug a broken pod/service</p><pre><code>sudo kubectl describe pod cloudmesh-openapi-pod
sudo kubectl logs --previous cloudmesh-openapi-pod cloudmesh-openapi
sudo kubectl logs cloudmesh-openapi-pod cloudmesh-openapi
sudo kubectl delete pod cloudmesh-openapi-pod
sudo kubectl delete service clodmesh-openapi-lb-service
sudo kubectl get pods --show-labels
sudo kubectl edit pod cloudmesh-openapi-pod
</code></pre><p>If you have trouble accessing the pod shell, like below. Try stopping and
restarting the K3s services.</p><pre><code>(ENV3) ubuntu@red:~/cloudmesh-openapi-container$ sudo kubectl exec --stdin --tty cloudmesh-openapi-pod -- /bin/bash
error: unable to upgrade connection: Authorization error (user=kube-apiserver, verb=create, resource=nodes, subresource=proxy)
</code></pre><p>Stop and restart the K3s services.</p><pre><code>red$ cms pi k3 stop agent red,red0[1-3]
red$ cms pi k3 stop server red
red$ cms pi k3 start server red
ree$ cms pi k3 start agent red,red0[1-3]
</code></pre><h2 id=23-uninstall-k3s>23. Uninstall K3s</h2><pre><code>laptop$ cms pi k3 uninstall cluster red,red0[1-3]
</code></pre><h2 id=24-uninstall-docker>24. Uninstall Docker</h2><pre><code>red$ sudo apt-get purge docker-ce docker-ce-cli containerd.io
red$ sudo rm -rf /var/lib/docker
red$ sudo rm -rf /var/lib/containerd
</code></pre><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/pi/tutorial/k3s-cluster/ class="btn btn-primary"><span class=mr-1>←</span> Previous</a></li><a href=/pi/tutorial/mpi/ class="btn btn-primary">Next <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Gregor von Laszewski" aria-label="Gregor von Laszewski"><a class=text-white target=_blank rel="noopener noreferrer" href=https://laszewski.github.io><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Cloudmesh GitHub" aria-label="Cloudmesh GitHub"><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/cloudmesh><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Web Site GitHub" aria-label="Web Site GitHub"><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/cloudmesh/pi><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Cloudmesh Community Slack" aria-label="Cloudmesh Community Slack"><a class=text-white target=_blank rel="noopener noreferrer" href=https://cloudmesh-community.slack.com><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://groups.google.com/g/piplanet><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The Cloudmesh Projects, Gregor von Laszewski All Rights Reserved</small><p class=mt-2><a href=/pi/about/>About Cloudmesh Pi</a></p></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/pi/js/main.min.ff304e9949717e3408e45c6399bef7e0834e330b2cbb0a5a5ac54227112a59c0.js integrity="sha256-/zBOmUlxfjQI5Fxjmb734INOMwssuwpaWsVCJxEqWcA=" crossorigin=anonymous></script></body></html>