<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.79.1"><link rel=canonical type=text/html href=https://cloudmesh.github.io/pi/tutorial/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/pi/favicons/favicon.ico><link rel=apple-touch-icon href=/pi/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/pi/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/pi/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pi/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/pi/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/pi/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/pi/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/pi/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/pi/favicons/android-192x192.png sizes=192x192><title>Tutorials | Cloudmesh Cluster Pi Planet</title><meta property="og:title" content="Tutorials"><meta property="og:description" content="A Docsy example site"><meta property="og:type" content="website"><meta property="og:url" content="https://cloudmesh.github.io/pi/tutorial/"><meta property="og:site_name" content="Cloudmesh Cluster Pi Planet"><meta itemprop=name content="Tutorials"><meta itemprop=description content="A Docsy example site"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tutorials"><meta name=twitter:description content="A Docsy example site"><link rel=preload href=/pi/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css as=style><link href=/pi/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class="td-section td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/pi/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zM197.0804 232.033c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zM197.0804 177.6188c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zM197.5309 286.4723c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zM197.0804 340.5784c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Cloudmesh Cluster Pi Planet</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pi/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pi/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pi/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pi/community/><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/pi/tutorial/><span class=active>Tutorials</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="print();return false;">Click here to print</a>.</p><p><a href=/pi/tutorial/>Return to the regular view of this page</a>.</p></div><h1 class=title>Tutorials</h1><ul><li>1: <a href=#pg-5074bfefda813c9c05f7aef9b0723c8b>Deploy MPI for Python (mpi4py) on your Pi Cluster</a></li><li>2: <a href=#pg-ded656facea45c679b8e189334544b36>DRAFT: Burning a pre-configured RaspberryOS Cluster on Windows 10</a></li><li>3: <a href=#pg-f5ee82ced5b00cecabe23b2b5c72e415>Create and Deploy a Container and OpenAPI Service with Docker and K3s</a></li><li>4: <a href=#pg-3ffe143e2c4df353af7ad2c2b548ec93>Employ K3S on a Pi Cluster</a></li><li>5: <a href=#pg-cafd8f57e7d7897f4a142c108548aa1f>Autogenerating Analytics Rest Services</a></li><li>6: <a href=#pg-fc0258a9df9604a3a23d2c40592a4a5c>Burning a set of pre-configured Raspberry OS cards for Raspberry Pis with Wifi Access</a></li><li>7: <a href=#pg-2b1e5335b32ab7dc6a177dabd7edc467>Burning a set of Ubuntu Server Cards for Raspberry Pis with Internet Access</a></li><li>8: <a href=#pg-9e7cb422383e60f88931f7c943382971>Burning a set of pre-configured SD cards with a GUI for Raspberry Pis with Wifi Access</a></li><li>9: <a href=#pg-03cb49c826ef4fa4c93d74e1dbc53e48>GitHub gh Command Line Interface</a></li><li>10: <a href=#pg-20addf5f1313d1459bd24fe54815c81f>Command cms</a></li><li>11: <a href=#pg-e366e3514fac18c1ed613e3a5cbad167>Tutorials and Links</a></li><li>12: <a href=#pg-112a4df841cb55c94a6b183558c66221>Network Scanning Tutorial</a></li><li>13: <a href=#pg-38142d6afd1cbdafe9e93351683a6a9a>Port Forwarding Tutorial</a></li><li>14: <a href=#pg-058d31f1ad9ef18980f31316da5cffc8>Ubuntu on the Pi</a></li><li>15: <a href=#pg-8a03792772737c9fcda02ef45a778cc5>User Management</a></li></ul><div class=content><p>This is the <strong>blog</strong> section. It has two categories: News and Releases.</p><p>Files in these directories will be listed in reverse chronological order.</p></div></div><div class=td-content><h1 id=pg-5074bfefda813c9c05f7aef9b0723c8b>1 - Deploy MPI for Python (mpi4py) on your Pi Cluster</h1><div class=lead>Take advantage of parallel communication on your cluster</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/mpi/featured-image_hu31ad1de8477c329f5412ff59acdd044d_22590_600x300_fill_catmullrom_smart1_2.png width=600 height=300><div class="card-body px-0 pt-2 pb-0"><p class=card-text></p></div></div><div class="pageinfo pageinfo-primary"><p>In this tutorial we will deploy and demonstrate MPI for use across a cluster of Raspberry Pis. The Pis can run Ubuntu or Raspberry OS. This tutorial is part ofa larger effort to use Python for MPI programming.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to install and try MPI on a cluster of Raspberry PIs</li><li>Fimd more resources on how to use MPI with Python</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-prerequisites>2. Prerequisites</a></li><li><a href=#3-cms-mpi-commands>3. CMS MPI Commands</a></li><li><a href=#4-install-mpi>4. Install MPI</a></li><li><a href=#5-tryout-mpi-on-a-single-host>5. Tryout MPI on a Single Host</a></li><li><a href=#6-tryout-mpi-on-a-cluster>6. Tryout MPI on a Cluster</a></li><li><a href=#7-uninstall-mpi>7. Uninstall MPI</a></li><li><a href=#8-manual-page>8. Manual Page</a></li><li><a href=#9-references>9. References</a></li></ul></nav></div></div><h2 id=1-introduction>1. Introduction</h2><p>Modern AI and Deep Learning algorithms require immense processing power to churn through big data. In this tutorial we show how to install and try out MPI on a cluster of Raspberry Pis. MPI gives developers access to a powerful set of parallel processing, synchronization, and communication tools to develop thier algorithms in a scalable manner on clustesr. mpi4py gives developers access to MPI from Python allowing easy integration into Python applications.</p><h2 id=2-prerequisites>2. Prerequisites</h2><p>This tutorial assumes a cluster burned using the convenient cloudmesh burn program. It has the advantage that the cluster is preconfigured for you at burn time of the SD Cards. We assume that you use one of the following methods:</p><p><a href=https://cloudmesh.github.io/pi/tutorial/raspberry-burn/>Burn a Raspberry OS Cluster</a></p><p><a href=https://cloudmesh.github.io/pi/tutorial/ubuntu-burn/>Burn an Ubuntu Cluster</a></p><p><a href=https://cloudmesh.github.io/pi/tutorial/gui-burn/>Use our GUI to Burn a Cluster</a></p><p>The tutorial supports both Raspberry OS and Ubuntu.</p><h2 id=3-cms-mpi-commands>3. CMS MPI Commands</h2><p>We use cloudmesh shell (<code>cms</code>) to provide you with some easy to use commands that address deployment of MPI on the cluster.
The MPI commands available from <code>cms</code> are:</p><pre><code>$ cms mpi deploy raspberry HOSTS
$ cms mpi deploy ubuntu HOSTS
$ cms mpi uninstall raspberry HOSTS
$ cms mpi uninstall ubuntu HOSTS
</code></pre><p>The commands can be installed as follows:</p><pre><code>$ cd cm
$ cloudmesh-installer get mpi
</code></pre><h2 id=4-install-mpi>4. Install MPI</h2><p>We can install MPI on a cluster of Pis using the following command. The installation is done in parallel to scale with the number of hosts. Make sure to choose the argument that corresponds to the OS installed on the Raspberry Pis. In this example we will demonstrate the installation on a cluster of Pis running Raspberry OS.</p><p>Required python packages are installed, followed by MPI and mpi4py, and then the version of MPI installed is checked.</p><p>A return code of 0 indicates command success, any other indicates a failure.</p><pre><code>(ENV3) you@your-laptop:~ $ cms mpi deploy raspberry &quot;red,red0[1-3]&quot;
mpi deploy raspberry red,red0[1-3]

# ----------------------------------------------------------------------
# Install MPI on hosts
# ----------------------------------------------------------------------

INFO: Installing essential python packages
INFO: sudo apt-get install python3-venv python3-wheel python3-dev build-essential python3-pip -y; pip3 install pip -U; python3 -m venv ~/ENV3
INFO: This may take several minutes
+-------+------------+--------+
| host  | returncode | stderr |
+-------+------------+--------+
| red   | 0          |        |
| red01 | 0          |        |
| red02 | 0          |        |
| red03 | 0          |        |
+-------+------------+--------+
INFO: Installing mpi on hosts
INFO: sudo apt-get install openmpi-bin -y; source ~/ENV3/bin/activate; pip3 install mpi4py
INFO: This may take several minutes
+-------+------------+--------+
| host  | returncode | stderr |
+-------+------------+--------+
| red   | 0          |        |
| red01 | 0          |        |
| red02 | 0          |        |
| red03 | 0          |        |
+-------+------------+--------+
INFO: Checking version of mpi on hosts
INFO: mpicc --showme:version
+-------+------------+--------+-------------------------------------+
| host  | returncode | stderr | stdout                              |
+-------+------------+--------+-------------------------------------+
| red   | 0          |        | mpicc: Open MPI 3.1.3 (Language: C) |
| red01 | 0          |        | mpicc: Open MPI 3.1.3 (Language: C) |
| red02 | 0          |        | mpicc: Open MPI 3.1.3 (Language: C) |
| red03 | 0          |        | mpicc: Open MPI 3.1.3 (Language: C) |
+-------+------------+--------+-------------------------------------+
</code></pre><h2 id=5-tryout-mpi-on-a-single-host>5. Tryout MPI on a Single Host</h2><p>To test MPI functionality on a single host you can run the following command to run 4 processes on a single Pi.</p><pre><code>(ENV3) pi@red:~ $ mpiexec -n 4 python3 -m mpi4py.bench helloworld
Hello, World! I am process 0 of 4 on red.
Hello, World! I am process 1 of 4 on red.
Hello, World! I am process 2 of 4 on red.
Hello, World! I am process 3 of 4 on red.
</code></pre><h2 id=6-tryout-mpi-on-a-cluster>6. Tryout MPI on a Cluster</h2><blockquote><p>NOTE: This example does not currently work with mpich installed on ubuntu, but it does with openmpi.</p></blockquote><p>To test MPI functionality on a cluster you can run the following command.</p><blockquote><p>NOTE: This command may silently fail if one of the hosts is not in the ~/.ssh/known_hosts file of the executing machine. To ensure it is present, connect to it via ssh first, <code>ssh red01</code>, and approve adding the host key to the known_host file.</p></blockquote><pre><code>(ENV3) pi@red:~ $ mpiexec -n 4 -host red,red01,red02,red03 ~/ENV3/bin/python -m mpi4py.bench helloworld
Hello, World! I am process 0 of 3 on red.
Hello, World! I am process 1 of 3 on red01.
Hello, World! I am process 2 of 3 on red02.
Hello, World! I am process 2 of 3 on red03.
</code></pre><p><strong>However, this will only run one process per host.</strong> A raspberry Pi 4 has 4 vprocessors. We can make a machine file to declare this information and then use <code>mpirun</code> and the <code>machinefile</code> to use all available processors.</p><p>Create a file named <code>machinefile</code> with the following content.</p><pre><code>pi@red slots=4
pi@red01 slots=4
pi@red02 slots=4
pi@red03 slots=4
</code></pre><p>Now we can run the same helloworld example while using all available processors.</p><pre><code>(ENV3) pi@red:~ $ mpirun -np 16 -machinefile ./machinefile ~/ENV3/bin/python -m mpi4py.bench helloworld
Hello, World! I am process  0 of 16 on red.
Hello, World! I am process  1 of 16 on red.
Hello, World! I am process  2 of 16 on red.
Hello, World! I am process  3 of 16 on red.
Hello, World! I am process  4 of 16 on red01.
Hello, World! I am process  6 of 16 on red01.
Hello, World! I am process  5 of 16 on red01.
Hello, World! I am process  7 of 16 on red01.
Hello, World! I am process  8 of 16 on red02.
Hello, World! I am process  9 of 16 on red02.
Hello, World! I am process 10 of 16 on red02.
Hello, World! I am process 11 of 16 on red02.
Hello, World! I am process 12 of 16 on red03.
Hello, World! I am process 13 of 16 on red03.
Hello, World! I am process 14 of 16 on red03.
Hello, World! I am process 15 of 16 on red03.
</code></pre><h2 id=7-uninstall-mpi>7. Uninstall MPI</h2><p>You can unistall MPI in the following manner.</p><pre><code>(ENV3) you@yourlaptop:~ $ cms mpi uninstall raspberry &quot;red,red0[1-3]&quot;
mpi uninstall raspberry red,red0[1-3]

# ----------------------------------------------------------------------
# Uninstall MPI on hosts
# ----------------------------------------------------------------------

INFO: Uninstalling mpi on hosts
INFO: sudo apt-get --purge remove openmpi-bin -y; source ~/ENV3/bin/activate; pip3 uninstall mpi4py -y&quot;
+-------+------------+--------+
| host  | returncode | stderr |
+-------+------------+--------+
| red   | 0          |        |
| red01 | 0          |        |
| red02 | 0          |        |
| red03 | 0          |        |
+-------+------------+--------+
</code></pre><h2 id=8-manual-page>8. Manual Page</h2><pre><code>  Usage:
        mpi deploy raspberry HOSTS
        mpi deploy ubuntu HOSTS
        mpi uninstall raspberry HOSTS
        mpi uninstall ubuntu HOSTS
        
  This command is used to install MPI on a cluster running Raspberry Pi OS or Ubuntu OS.

  Arguments:
      HOSTS   parameterized list of hosts

  Description:
      mpi deploy raspberry HOSTS

          Will deploy mpi for raspberry OS HOSTS in a parallel manner and return installation results.

      mpi deploy ubuntu HOSTS

          Will deploy mpi for ubuntu OS HOSTS (possibly running on raspberry pi platform) in a parallel manner
          and return installation results.

      mpi uninstall raspberry HOSTS

          Will uninstall mpi packagess from raspberry OS HOSTS.

      mpi uninstall ubuntu HOSTS

          Will uninstall mpi packages from ubuntu OS HOSTS.

</code></pre><h2 id=9-references>9. References</h2><p>To learn more about MPI4PY, including examples of communication mechanisms, please see this <a href=https://cloudmesh.github.io/cloudmesh-mpi/report-mpi.pdf>report</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ded656facea45c679b8e189334544b36>2 - DRAFT: Burning a pre-configured RaspberryOS Cluster on Windows 10</h1><div class=lead>A comprehensive tutorial of burning a Raspberry OS cluster with internet access</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/raspberry-burn-windows/featured-image_huf8b50ada3a31d2a67084da179c329740_149718_600x300_fill_catmullrom_smart1_2.png width=600 height=300></div><div class="pageinfo pageinfo-primary"><p>In this tutorial, we explain how to easily set up a preconfigured cluster of Pis using RaspberryOS while burning
SD Cards from Windows 10. The cluster is ready to boot after all cards have been burned. No other configuration is needed.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to use cloudmesh-burn to create a RaspberryOS cluster</li><li>Test the cluster after burning</li><li>Use Windows 10 to conduct the burning</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-pre-requisites>2. Pre-requisites</a></li><li><a href=#3-notation>3. Notation</a></li><li><a href=#4-installing-cloudmesh-and-setup>4. Installing cloudmesh and Setup</a><ul><li><a href=#41-install-from-pip-for-regular-users>4.1 Install from Pip for Regular Users</a></li><li><a href=#42-install-from-source-for-developers>4.2 Install from Source (for Developers)</a></li><li><a href=#43-initializing-the-cms-command>4.3 Initializing the cms Command</a></li><li><a href=#43-create-an-ssh-key>4.3 Create an SSH key</a></li></ul></li><li><a href=#5-burning-the-cluster>5. Burning the Cluster</a></li><li><a href=#6-burn-verification-and-post-process-steps>6. Burn Verification and Post-Process Steps</a><ul><li><a href=#61-setting-up-a-proxy-jump-with-cms-host>6.1 Setting up a Proxy Jump with <code>cms host</code></a></li><li><a href=#62-verifying-manager-and-worker-access>6.2 Verifying Manager and Worker Access</a></li><li><a href=#63-gather-and-scatter-authorized-keys>6.3 Gather and Scatter Authorized Keys</a></li><li><a href=#64-installing-cms-on-a-pi>6.4 Installing <code>cms</code> on a Pi</a></li></ul></li><li><a href=#7-appendix>7. Appendix</a></li><li><a href=#71-writing-our-cluster-configuration>7.1 Writing our cluster configuration</a><ul><li><a href=#72-default-cluster-creation>7.2 Default Cluster Creation</a></li><li><a href=#73-custom-cluster-creation>7.3 Custom Cluster Creation</a></li><li><a href=#74-inspect-the-cluster-configuration>7.4 Inspect the Cluster Configuration</a></li><li><a href=#75-burning-a-custom-cluster>7.5 Burning a Custom Cluster</a></li><li><a href=#76-managing-known_hosts>7.6 Managing known_hosts</a></li><li><a href=#77-get-the-os-image>7.7 Get the OS Image</a></li><li><a href=#77-related-tutorials>7.7 Related tutorials</a></li></ul></li></ul></nav></div></div><h2 id=1-introduction>1. Introduction</h2><p>With the release of <a href=https://www.raspberrypi.org/blog/raspberry-pi-imager-update-to-v1-6/>Pi Imager 1.6</a>, it is possible to configure a Raspberry Pi from any operating system while using RaspberryOS. While pi-imager only uses a limited number of parameters, our system adds network configurations to create a cluster including a simple network configuration. The system works while executing configurations automatically after the first boot. We will focus here on using Windows 10 for the burning. On piplanet.org we are providing additional tutorials that work also for Ubuntu and macOS.</p><p>Our tutorials are useful as typically many steps are involved to set up a cluster. This requires either the replication of time-consuming tasks that can be automated or the knowledge of DevOps frameworks.</p><p>We avoid this by simply burning a card for each of the PIs. No more hours wasted on setting up your initial cluster.</p><p>To facilitate this we developed a special command called <code>cms burn</code>, which allows us to create preconfigured cards with the necessary information. The features this command supports include:</p><ul><li>Setting the hostname,</li><li>Enabling SSH,</li><li>Configuring WiFi,</li><li>Setting the locale,</li><li>Changing the password,</li><li>Adding authorized keys,</li><li>Configuring static IPs for wired ethernet along with routing preferences,</li><li>Configuring a WiFi <em>bridge</em> for a manager Pi to act as a router between the worker PIs and the internet, and</li><li>Automating the configuration on first boot.</li></ul><p>We demonstrate the usage of the <code>cms burn</code> command by creating a cluster of
5 pis (1 manager, 4 workers) where we connect the manager to the internet
via Wifi and configure the workers to access the internet through the manager via
ethernet connection. This is useful for those with restricted internet access where devices must be registered
by MAC Address or through browser login.</p><h2 id=2-pre-requisites>2. Pre-requisites</h2><ul><li>Computer/Laptop with Windows10</li><li><code>python3 --version</code> > 3.9</li><li>WiFi SSID and password</li><li>5 Raspberry Pis and 5 SD Cards with power cables. (However, you only need
a minimum of 2 is needed, one manager and 1 worker if you do not have 4 Pis.
You can adapt our tutorial accordingly)</li><li>5 Ethernet Cables</li><li>An unmanaged ethernet switch</li></ul><p>For parts for different pi cluster configurations, please see lists please see our links on <a href=https://cloudmesh.github.io/pi/docs/hardware/parts/>piplanet.org</a></p><h2 id=3-notation>3. Notation</h2><p>In our tutorial we define the manager hostname to be <code>red</code>, while each
worker has a number in it <code>red01</code>, <code>red02</code>, <code>red03</code>, <code>red04</code></p><p>The following image shows our cluster configuration:</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/raspberry-burn-windows/featured-network_huc4b03e8453bdf7261a9062cdffac07b3_133769_600x300_fill_catmullrom_smart1_2.png width=600 height=300></div><h2 id=4-installing-cloudmesh-and-setup>4. Installing cloudmesh and Setup</h2><p>At the time of writing this tutorial uses Python 3.9.6. To install, go to python.org and click the download button you see on the front page and install this or a newer version. We additionally use gitbash for our commands so make sure you have gitbash installed. You can download from <a href=https://git-scm.com/downloads>https://git-scm.com/downloads</a>. Our <code>burn</code> commands will require administrator privileges, so launch an administrator gitbash window by right-clicking on the program.</p><p>It is best practice to create virtual environments for python.
We also want to place all source code in a common directory called <code>cm</code>.
Let us set up this and create one for this tutorial.</p><p>In your gitbash window create a virtual environment with</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ python -m venv ~/ENV3
</code></pre></div><p>This will create a new python virtual environment. Activate it with the following command.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ <span style=color:#204a87>source</span> ~/ENV3/Scripts/activate
</code></pre></div><p>First, we update pip and verify your <code>python</code> and <code>pip</code> are correct</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install --upgrade pip
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ which python
~/ENV3/Scripts/python

<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ which pip
~/ENV3/Scripts/pip
</code></pre></div><h3 id=41-install-from-pip-for-regular-users><del>4.1 Install from Pip for Regular Users</del></h3><p><del><strong>The pip install for Windows is not yet suported!!. So please use the Install from source installation documentation. Once we officially release this code the install from pip can be used.</strong></del></p><p><del><code>bash~~ ~~(ENV3) you@yourlaptop $ pip install cloudmesh-pi-cluster~~ ~~</code></del></p><h3 id=42-install-from-source-for-developers>4.2 Install from Source (for Developers)</h3><p>If you are a developer that likes to add new features we recommend our source set up. We start after you have created the virtualenv with the install of our convenient <code>cloudmesh-installer</code> and creation of the <code>cm</code> directory in which we download the sources</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ mkdir ~/cm
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ <span style=color:#204a87>cd</span> ~/cm
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install cloudmesh-installer
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cloudmesh-installer get pi
</code></pre></div><p>This directory will now contain all source code. It will also have installed the needed <code>cms</code> command.</p><p>As we are still developing the windows verison, we need to switch to a specific branch. In both of the blocks below, a <code>git fetch</code> immediately before the <code>git checkout windows</code> command may be necessary if the windows branch can&rsquo;t be found.</p><pre><code>(ENV3) you@yourlaptop $ cd cloudmesh-pi-burn
(ENV3) you@yourlaptop $ git checkout windows
(ENV3) you@yourlaptop $ pip install -e .
</code></pre><pre><code>(ENV3) you@yourlaptop $ cd cloudmesh-inventory
(ENV3) you@yourlaptop $ git checkout windows
(ENV3) you@yourlaptop $ pip install -e .
</code></pre><h3 id=43-initializing-the-cms-command>4.3 Initializing the cms Command</h3><p>It is very important to initialize the cms command and test if it is properly installed. You do this simply with the command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms <span style=color:#204a87>help</span>
</code></pre></div><p>You will see a list of subcommands that are part of the cms if your installation succeeded. Check if you can see the command</p><pre><code>burn
</code></pre><p>in the list.</p><h3 id=43-create-an-ssh-key>4.3 Create an SSH key</h3><p>We use ssh to easily login to the manager and worker nodes from the laptop/desktop. Hence we create a keypair in <code>~/.ssh</code>. You can create one as follows by accepting the default location in <code>~/.ssh/id_rsa</code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh-keygen
</code></pre></div><p>Please use a unique and strong passphrase. We will use this default key to access our cluster after burning.</p><p>In case you do not always want to type in your passphrase, you can use ssh-agent in your gitbash window as follows:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ <span style=color:#204a87>eval</span> <span style=color:#4e9a06>`</span>ssh-agent<span style=color:#4e9a06>`</span>
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ <span style=color:#204a87>eval</span> <span style=color:#4e9a06>`</span>ssh-add<span style=color:#4e9a06>`</span>

</code></pre></div><p>These two commands will start the ssh-agent and add your key to it so it is cached for future use within the same gitbash terminal</p><h2 id=5-burning-the-cluster>5. Burning the Cluster</h2><p>We are now ready to burn our cluster. Start by making sure you have the latest images to burn:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn image versions --refresh
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn image get latest-lite
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn image get latest-full
</code></pre></div><p>Next, plug in your first SD Card into your card writer.
Check your writer&rsquo;s path with the following while using gitbash as administrative user.</p><blockquote><p><em>Note: To run gitbash as administrative user, type in the Windows search form and click on Run as administrator). Qw will ougment all commands with the keyword (admin) that need to be run in administrative mode</em></p></blockquote><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>admin<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn info

<span style=color:#8f5902;font-style:italic># ----------------------------------------------------------------------</span>
<span style=color:#8f5902;font-style:italic># This is a Windows Computer</span>
<span style=color:#8f5902;font-style:italic># ----------------------------------------------------------------------</span>

+----------+-------+-------+---------+-------+-----------+--------+----------+--------+----------+
<span style=color:#000;font-weight:700>|</span> Volume   <span style=color:#000;font-weight:700>|</span>   <span style=color:#8f5902;font-style:italic>### | Ltr   | Label   | Fs    | Type      | Size   | Status   | Info   | dev      |</span>
<span style=color:#000;font-weight:700>|</span>----------+-------+-------+---------+-------+-----------+--------+----------+--------+----------<span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> Volume   <span style=color:#000;font-weight:700>|</span>     <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>|</span> F     <span style=color:#000;font-weight:700>|</span> boot    <span style=color:#000;font-weight:700>|</span> FAT32 <span style=color:#000;font-weight:700>|</span> Removable <span style=color:#000;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>256</span> MB <span style=color:#000;font-weight:700>|</span> Healthy  <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span> /dev/sde <span style=color:#000;font-weight:700>|</span>
+----------+-------+-------+---------+-------+-----------+--------+----------+--------+----------+
+--------+-----------------+-----------------+-----------------------------------+--------------+--------+----------+
<span style=color:#000;font-weight:700>|</span>   Disk <span style=color:#000;font-weight:700>|</span> InterfaceType   <span style=color:#000;font-weight:700>|</span> MediaType       <span style=color:#000;font-weight:700>|</span> Model                             <span style=color:#000;font-weight:700>|</span>   Partitions <span style=color:#000;font-weight:700>|</span> Size   <span style=color:#000;font-weight:700>|</span> Status   <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>--------+-----------------+-----------------+-----------------------------------+--------------+--------+----------<span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>      <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>|</span> USB             <span style=color:#000;font-weight:700>|</span> Removable Media <span style=color:#000;font-weight:700>|</span> Generic STORAGE DEVICE USB Device <span style=color:#000;font-weight:700>|</span>            <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>59</span> GB  <span style=color:#000;font-weight:700>|</span> Online   <span style=color:#000;font-weight:700>|</span>
+--------+-----------------+-----------------+-----------------------------------+--------------+--------+----------+
WARNING: We could not find your USB reader in the list of known readers
</code></pre></div><p>This command will take a minute to complete. The warning occurs as your reader may be too new and we do not have it in our database of recognized readers. As long as you see <code>Removable Media</code> and <code>GENERIC STORAGE DEVICE</code> it will be fine.</p><p>Record the disk for the SDCard. In this case, it is <code>4</code>.</p><blockquote><p>Note we omit some output of <code>cms burn info</code> for clarity.</p></blockquote><p>On windows it will not autodetect the SSID, wifi password, locale, or country of your laptop. Hence you have to specify these as parameters. The timezone parameter should include hyphens in place of forward slashes (Ex. use &ldquo;America-Indiana-Indianapolis&rdquo; for &ldquo;America/Indiana/Indianapolis&rdquo;). Timezones can be found at (<a href=https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)>https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)</a>.
To burn the latest 32 bit OS use the following command. Otherwise, look at our subsequent note
for instructions to burn the latest 64 bit OS.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>admin<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn raspberry <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> --password<span style=color:#ce5c00;font-weight:700>=</span>myloginpassword --disk<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4</span> --new --locale<span style=color:#ce5c00;font-weight:700>=</span>en_US.UTF-8 --timezone<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;America-Indiana-Indianapolis&#34;</span> --ssid<span style=color:#ce5c00;font-weight:700>=</span>NETWORK --wifipassword<span style=color:#ce5c00;font-weight:700>=</span>mywifipassword
</code></pre></div><p>If the network name has a space in it, please use two sets of quotes: <code>"--ssid='Net Work'"</code> or escape <code>--ssid=Net\ Work"</code> . We recommend not to use any spaces in network names.</p><pre><code># ----------------------------------------------------------------------
#  _____                 _                           ____   _____
# |  __ \               | |                         / __ \ / ____|
# | |__) |__ _ ___ _ __ | |__   ___ _ __ _ __ _   _| |  | | (___
# |  _  // _` / __| '_ \| '_ \ / _ \ '__| '__| | | | |  | |\___ \
# | | \ \ (_| \__ \ |_) | |_) |  __/ |  | |  | |_| | |__| |____) |
# |_|  \_\__,_|___/ .__/|_.__/ \___|_|  |_|   \__, |\____/|_____/
#                 | |                          __/ |
#                 |_|                         |___/
#  ____
# |  _ \
# | |_) |_   _ _ __ _ __
# |  _ &lt;| | | | '__| '_ \
# | |_) | |_| | |  | | | |
# |____/ \__,_|_|  |_| |_|
#
#
# ----------------------------------------------------------------------

INFO: No inventory found or forced rebuild. Buidling inventory with defaults.
+-------+-------------+---------+---------+--------------------+----------+------------------------+----------+-------------+----------------------------+--------+---------+-------------+-------------------+
| host  | tag         | cluster | service | services           | ip       | dns                    | router   | locale      | timezone                   | owners | comment | description | keyfile           |
+-------+-------------+---------+---------+--------------------+----------+------------------------+----------+-------------+----------------------------+--------+---------+-------------+-------------------+
| red   | latest-lite |         | manager | ['bridge', 'wifi'] | 10.1.1.1 |                        |          | en_US.UTF-8 | AmericaIndianaIndianapolis |        |         |             | ~/.ssh/id_rsa.pub |
| red01 | latest-lite |         | worker  |                    | 10.1.1.2 | ['8.8.8.8', '8.8.4.4'] | 10.1.1.1 | en_US.UTF-8 | AmericaIndianaIndianapolis |        |         |             | ~/.ssh/id_rsa.pub |
| red02 | latest-lite |         | worker  |                    | 10.1.1.3 | ['8.8.8.8', '8.8.4.4'] | 10.1.1.1 | en_US.UTF-8 | AmericaIndianaIndianapolis |        |         |             | ~/.ssh/id_rsa.pub |
| red03 | latest-lite |         | worker  |                    | 10.1.1.4 | ['8.8.8.8', '8.8.4.4'] | 10.1.1.1 | en_US.UTF-8 | AmericaIndianaIndianapolis |        |         |             | ~/.ssh/id_rsa.pub |
| red04 | latest-lite |         | worker  |                    | 10.1.1.5 | ['8.8.8.8', '8.8.4.4'] | 10.1.1.1 | en_US.UTF-8 | AmericaIndianaIndianapolis |        |         |             | ~/.ssh/id_rsa.pub |
+-------+-------------+---------+---------+--------------------+----------+------------------------+----------+-------------+----------------------------+--------+---------+-------------+-------------------+
</code></pre><blockquote><p>Note the <code>--new</code> flag instructs <code>cms burn</code> to build a new (the -f flag does the same but we have not yet tested it).
inventory and overwrites it if it already exists. To see the contents of this file you
can use the command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cms inventory list --inventory<span style=color:#ce5c00;font-weight:700>=</span>inventory-red.yaml
</code></pre></div></blockquote><blockquote><p>Note: if you want to burn the <strong>64 bit OS</strong> use the following series of commands
instead.This creates a default cluster configuration, and then changes the OS tag
latest-lite-64.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>admin<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn image versions --refresh
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>admin<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn image get latest-lite-64 
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>admin<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms inventory add cluster <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span>
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>admin<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms inventory <span style=color:#204a87>set</span> <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> tag to latest-lite-64 --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>admin<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn raspberry <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> --password<span style=color:#ce5c00;font-weight:700>=</span>myloginpassword --disk<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4</span> --locale<span style=color:#ce5c00;font-weight:700>=</span>en_US.UTF-8 --timezone<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;America-Indiana-Indianapolis&#34;</span> --ssid<span style=color:#ce5c00;font-weight:700>=</span>NETWORK --wifipassword<span style=color:#ce5c00;font-weight:700>=</span>mywifipassword
</code></pre></div></blockquote><p>NOT TESTED FROM HERE ON. IMPROVEMENTS WILL BE LIKELY</p><p>After each card is burned, <code>cms burn raspberry</code> will prompt you to swap the SD card to burn the next host.</p><p>After all the cards have been burned, we can now plug them in our raspberry pis and boot. Ensure
that your workers and manager are connected to the same network switch via the ethernet cables. Ensure this network
switch does not have internet access in itself, e.g. do not connect the switch to the internet router. We will use the manager as the sole point of internet access here. This we do deliberately to be able to disconnect all nodes from the network via the Master in case this is needed.</p><h2 id=6-burn-verification-and-post-process-steps>6. Burn Verification and Post-Process Steps</h2><p>After you boot, we recommend waiting 2-3 minutes for the boot process to complete.</p><h3 id=61-setting-up-a-proxy-jump-with-cms-host>6.1 Setting up a Proxy Jump with <code>cms host</code></h3><p>While we are waiting for the Pis to boot, we can set up proxy jump on our laptop/desktop while adding it to the ssh config file. This will make it easier to access our workers. Use the following command to set this up:</p><pre><code>(ENV3) you@yourlaptop $ cms host config proxy pi@red.local &quot;red0[1-4]&quot;
</code></pre><p>It will do the appropriate modifications.</p><h3 id=62-verifying-manager-and-worker-access>6.2 Verifying Manager and Worker Access</h3><p>First verify that you can reach the manager (red).</p><pre><code>(ENV3) you@yourlaptop $ ssh red
...
pi@red:~ $ exit
</code></pre><blockquote><p>Note: If this does not work, it is likely that the wifi configuration was
incorrect, or there is an RF block on the Pi that could not be removed due
to an unknown locale of the burning machine. 2.4GHz wifi is more likely to
work without explicit country configuration than 5 GHz bands.</p></blockquote><p>We can use a simple <code>cms</code> command to verify connection to our Pis. For this purpose, we use our build in temperature command that reads the temperature values from each of the Pis.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms pi temp <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span>
pi temp red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span>
+--------+--------+-------+----------------------------+
<span style=color:#000;font-weight:700>|</span> host   <span style=color:#000;font-weight:700>|</span>    cpu <span style=color:#000;font-weight:700>|</span>   gpu <span style=color:#000;font-weight:700>|</span> date                       <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>--------+--------+-------+----------------------------<span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red    <span style=color:#000;font-weight:700>|</span> 47.712 <span style=color:#000;font-weight:700>|</span>  47.2 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:56.674668 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01  <span style=color:#000;font-weight:700>|</span> 37.485 <span style=color:#000;font-weight:700>|</span>  37.4 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.333300 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02  <span style=color:#000;font-weight:700>|</span> 38.946 <span style=color:#000;font-weight:700>|</span>  38.9 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.303389 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03  <span style=color:#000;font-weight:700>|</span> 38.946 <span style=color:#000;font-weight:700>|</span>  39.4 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.440690 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04  <span style=color:#000;font-weight:700>|</span> 38.936 <span style=color:#000;font-weight:700>|</span>  39.4 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.550690 <span style=color:#000;font-weight:700>|</span>
+--------+--------+-------+----------------------------+
</code></pre></div><p>By receiving this information from our devices we have confirmed our access.</p><h3 id=63-gather-and-scatter-authorized-keys>6.3 Gather and Scatter Authorized Keys</h3><p>Each of the nodes only has our laptop&rsquo;s ssh-key in its respective <code>authorized_keys</code> file. We can use the <code>cms</code> command to gather all keys in our cluster and then distribute them so that each node can ssh into each other.</p><p>We first create ssh-keys for all the nodes in our cluster.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key create <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span>
host key create red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span>
+-------+---------+--------------------------------------------------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> success <span style=color:#000;font-weight:700>|</span> stdout                                           <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------------------------------------------------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC99RR79UTQ <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> JznOPRN/FI6MqNsZ5Eirqs7JXA4UYfnMx8LVaD/ZcI6Sajr0 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 2nw2ucec8OMxtdzPrpWX5B+Hxz3GZWNKCbh2yHhMDIrf/Ohn <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> QGJrBx1mtAbqy4gd7qljEsL0FummdYmPdtHFBy7t2zkVp0J1 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> V5YiLEbbrmX9RXQF1bJvHb4VNOOcwq47qX9h561q8qBxgQLz <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> F3iHmrMxmL8oma1RFVgZmjhnKMoXF+t13uZrf2R5/hVO4K6T <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> +PENSnjW7OX6aiIT8Ty1ga74FhXr9F5t14cofpN6QwuF2SqM <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> CgpVGfRSGMrLI/2pefszU2b5eeICWYePdopkslML+f+n     <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> pi@red                                           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDRN/rGGF+e <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> dZ9S2IWX4P26F7T2H+nsbw7CfeJ6df9oX/npYuM9BPDzcEP7 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> +2jNIZtZVehJj5zHiodjAspCxjg+mByQZye1jioa3MBmgO3j <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> VwxCOPA7x0Wc2Dm9/QOg1kMMMlnNT2NHs+SeQMDXoUkpaLCQ <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 108VQxaTclJ67USC1e/9B7OtjhsVm5kGA7Eamyd5PgtANT7G <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> jHERXSnGzFnbqqsZEBvCLWLSbaSq3adWR1bVvDblu11nyitE <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> x7YKZA9RK0A7rTBzrZa70SfG65dSbpqQFxmQYSrgiwVSBokk <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 0vvk5l7NhBDrrrxWYWd9dm/SrDrInjcuDsCsjOVuccx7     <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> pi@red01                                         <span style=color:#000;font-weight:700>|</span>
... <span style=color:#8f5902;font-style:italic># Ommitted some output for brevity</span>
+-------+---------+--------------------------------------------------+
</code></pre></div><p>We can subsequently gather these keys into a file.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key gather <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> <span style=color:#4e9a06>\&#34;</span>~/.ssh/cluster_red_keys<span style=color:#4e9a06>\&#34;</span>
</code></pre></div><p>And then Scatter them to the <code>authorized_keys</code> of our nodes.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key scatter <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> <span style=color:#4e9a06>\&#34;</span>~/.ssh/cluster_red_keys<span style=color:#4e9a06>\&#34;</span>
host key scatter red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span> /Users/richie/.ssh/cluster_red_keys
+-------+---------+--------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> success <span style=color:#000;font-weight:700>|</span> stdout <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------+
</code></pre></div><p>All nodes should now have <code>ssh</code> access to each other.</p><h3 id=64-installing-cms-on-a-pi>6.4 Installing <code>cms</code> on a Pi</h3><p>Some cloudmesh commands offered can be very useful on the Pis. You can install <code>cms</code> on all Pis in this fashion, but
we will only demonstrate this for the manager pi.</p><p>For the production version pleas use</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh red
pi@red $ curl -Ls http://cloudmesh.github.io/get/pi <span style=color:#000;font-weight:700>|</span> sh -
</code></pre></div><p>However, to get the newest development version please use</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh red
pi@red $ curl -Ls https://raw.githubusercontent.com/cloudmesh/get/main/pi/index.html <span style=color:#000;font-weight:700>|</span> sh -
</code></pre></div><p>This will not only install <code>cms</code>, but will also upgrade your system, install the dependencies for <code>cms</code>, and create a
virtual environment. Because a system upgrade takes place, this command may take several minutes to run.</p><p>After a reboot, we can verify the success of the script with the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> pi@red $ cms <span style=color:#204a87>help</span>
<span style=color:#204a87>help</span>

Documented commands <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87>type</span> <span style=color:#204a87>help</span> &lt;topic&gt;<span style=color:#ce5c00;font-weight:700>)</span>:
<span style=color:#ce5c00;font-weight:700>========================================</span>
EOF     check     default  <span style=color:#204a87>help</span>       pause     quit   start      <span style=color:#204a87>test</span>
admin   clear     diagram  host       pi        <span style=color:#204a87>set</span>    stop       var
banner  commands  dryrun   info       provider  shell  stopwatch  version
bridge  config    <span style=color:#204a87>echo</span>     inventory  py        sleep  sys
burn    debug     gui      man        q         ssh    term
</code></pre></div><h2 id=7-appendix>7. Appendix</h2><h2 id=71-writing-our-cluster-configuration>7.1 Writing our cluster configuration</h2><p>Cloudmesh has a simple system for managing cluster configurations as an inventory.
We do this management for you, but you can control it also from the command line.
We can first add a manager with cluster subnet IP <code>10.1.1.1</code>. We also add the <code>bridge</code> service which is
recognized by <code>cms</code> as the Wifi bridge service connecting devices on eth0 to the internet.
We also set the timezone and locale here. You may want to change them as you wish.</p><h3 id=72-default-cluster-creation>7.2 Default Cluster Creation</h3><p>As we want to make the cluster very easy to create we demonstrated in
Section 5 how to create a default cluster directly from the burn command.
As a future feature, this behavior will also be implemented into the inventory
command. To make a default inventory named inventory-red.yaml:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory add cluster <span style=color:#4e9a06>&#34;red,red[01-04]&#34;</span>
</code></pre></div><p>This command will find your current WiFi SSID, your current locale and set up a simple network as depicted in Figure 1 on your cluster. In case you have more or fewer nodes, the command will make appropriate updates.</p><h3 id=73-custom-cluster-creation>7.3 Custom Cluster Creation</h3><p>For a custom cluster, you can inspect the parameters of the inventory command. Here are the commands to use for the previous setup while writing them out. You can modify the parameters to your liking:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory add red --service<span style=color:#ce5c00;font-weight:700>=</span>manager --ip<span style=color:#ce5c00;font-weight:700>=</span>10.1.1.1 --tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;latest-lite&#34;</span> --timezone<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;America/Indiana/Indianapolis&#34;</span> --locale<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;us&#34;</span> --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
you@yourlaptop $ cms inventory <span style=color:#204a87>set</span> red services to <span style=color:#4e9a06>&#34;bridge,wifi&#34;</span> --listvalue --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><p>We can then add the workers</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory add <span style=color:#4e9a06>&#34;red0[1-4]&#34;</span> --service<span style=color:#ce5c00;font-weight:700>=</span>worker --ip<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;10.1.1.[2-5]&#34;</span> --router<span style=color:#ce5c00;font-weight:700>=</span>10.1.1.1 --tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;latest-lite&#34;</span>  --timezone<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;America/Indiana/Indianapolis&#34;</span> --locale<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;us&#34;</span> --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
you@yourlaptop $ cms inventory <span style=color:#204a87>set</span> <span style=color:#4e9a06>&#34;red0[1-4]&#34;</span> dns to <span style=color:#4e9a06>&#34;8.8.8.8,8.8.4.4&#34;</span> --listvalue --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><blockquote><p>Note we are using Google&rsquo;s DNS here [8.8.8.8, 8.8.4.4]</p></blockquote><h3 id=74-inspect-the-cluster-configuration>7.4 Inspect the Cluster Configuration</h3><p>Our cluster configuration is now complete. You may run the following to list your configuration. We include ours for a sanity check:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory list --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
+-------+-------------+---------+---------+--------------------+----------+------------------------+----------+--------+------------------------------+--------+---------+-------------+-------------------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> tag         <span style=color:#000;font-weight:700>|</span> cluster <span style=color:#000;font-weight:700>|</span> service <span style=color:#000;font-weight:700>|</span> services           <span style=color:#000;font-weight:700>|</span> ip       <span style=color:#000;font-weight:700>|</span> dns                    <span style=color:#000;font-weight:700>|</span> router   <span style=color:#000;font-weight:700>|</span> locale <span style=color:#000;font-weight:700>|</span> timezone                     <span style=color:#000;font-weight:700>|</span> owners <span style=color:#000;font-weight:700>|</span> comment <span style=color:#000;font-weight:700>|</span> description <span style=color:#000;font-weight:700>|</span> keyfile           <span style=color:#000;font-weight:700>|</span>
+-------+-------------+---------+---------+--------------------+----------+------------------------+----------+--------+------------------------------+--------+---------+-------------+-------------------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> manager <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;bridge&#39;</span>, <span style=color:#4e9a06>&#39;wifi&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span>                        <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.2 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02 <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.3 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03 <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.4 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04 <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.5 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
+-------+-------------+---------+---------+--------------------+----------+------------------------+----------+--------+------------------------------+--------+---------+-------------+-------------------+
</code></pre></div><h3 id=75-burning-a-custom-cluster>7.5 Burning a Custom Cluster</h3><p>You can now specify your inventory as you burn your cluster or specific
machines from the cluster with the burn command. All hosts data found in the
inventory will be written to the machines, regardless if they are in the
burn command or not.</p><p>Burn the whole cluster.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>admin<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn raspberry <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> --device<span style=color:#ce5c00;font-weight:700>=</span>/dev/sdb 
--inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><p>Burn a specific machine.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>(</span>admin<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn raspberry <span style=color:#4e9a06>&#34;red03&#34;</span> --device<span style=color:#ce5c00;font-weight:700>=</span>/dev/sdb --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><h3 id=76-managing-known_hosts>7.6 Managing known_hosts</h3><p>In case you reburn a SDCard and use it in your cluster you will get a warning once you try to ssh into the machine. To remove the error simply execute the command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ ssh-keygen -R HOSTNAME
</code></pre></div><p>where hostname is either the hostname or the ip address of your machine. that is registered in known hosts.
To see the list, please use</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cat ~/.ssh/known_hosts
</code></pre></div><h3 id=77-get-the-os-image>7.7 Get the OS Image</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop  $ cms burn image versions --refresh

+-----------------------+------------+-------------+--------+-----------------------------------------+
<span style=color:#000;font-weight:700>|</span> Tag                   <span style=color:#000;font-weight:700>|</span> Date       <span style=color:#000;font-weight:700>|</span> OS          <span style=color:#000;font-weight:700>|</span> Type   <span style=color:#000;font-weight:700>|</span> Version                                 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>-----------------------+------------+-------------+--------+-----------------------------------------<span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> lite-2020-05-28       <span style=color:#000;font-weight:700>|</span> 2020-05-28 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> lite   <span style=color:#000;font-weight:700>|</span> raspios_lite_armhf-2020-05-28           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> lite-2020-08-24       <span style=color:#000;font-weight:700>|</span> 2020-08-24 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> lite   <span style=color:#000;font-weight:700>|</span> raspios_lite_armhf-2020-08-24           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> lite-2020-12-04       <span style=color:#000;font-weight:700>|</span> 2020-12-04 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> lite   <span style=color:#000;font-weight:700>|</span> raspios_lite_armhf-2020-12-04           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> lite-2021-01-12       <span style=color:#000;font-weight:700>|</span> 2021-01-12 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> lite   <span style=color:#000;font-weight:700>|</span> raspios_lite_armhf-2021-01-12           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> lite-2021-03-25       <span style=color:#000;font-weight:700>|</span> 2021-03-25 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> lite   <span style=color:#000;font-weight:700>|</span> raspios_lite_armhf-2021-03-25           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> lite-2021-05-28       <span style=color:#000;font-weight:700>|</span> 2021-05-28 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> lite   <span style=color:#000;font-weight:700>|</span> raspios_lite_armhf-2021-05-28           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> latest-lite           <span style=color:#000;font-weight:700>|</span> 2021-05-28 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> lite   <span style=color:#000;font-weight:700>|</span> raspios_lite_armhf-2021-05-28           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> full-2020-05-28       <span style=color:#000;font-weight:700>|</span> 2020-05-28 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> full   <span style=color:#000;font-weight:700>|</span> raspios_full_armhf-2020-05-28           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> full-2020-08-24       <span style=color:#000;font-weight:700>|</span> 2020-08-24 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> full   <span style=color:#000;font-weight:700>|</span> raspios_full_armhf-2020-08-24           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> full-2020-12-04       <span style=color:#000;font-weight:700>|</span> 2020-12-04 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> full   <span style=color:#000;font-weight:700>|</span> raspios_full_armhf-2020-12-04           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> full-2021-01-12       <span style=color:#000;font-weight:700>|</span> 2021-01-12 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> full   <span style=color:#000;font-weight:700>|</span> raspios_full_armhf-2021-01-12           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> full-2021-03-25       <span style=color:#000;font-weight:700>|</span> 2021-03-25 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> full   <span style=color:#000;font-weight:700>|</span> raspios_full_armhf-2021-03-25           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> full-2021-05-28       <span style=color:#000;font-weight:700>|</span> 2021-05-28 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> full   <span style=color:#000;font-weight:700>|</span> raspios_full_armhf-2021-05-28           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> latest-full           <span style=color:#000;font-weight:700>|</span> 2021-05-28 <span style=color:#000;font-weight:700>|</span> raspberryos <span style=color:#000;font-weight:700>|</span> full   <span style=color:#000;font-weight:700>|</span> raspios_full_armhf-2021-05-28           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> ubuntu-20.04.2-64-bit <span style=color:#000;font-weight:700>|</span> 2021-02-01 <span style=color:#000;font-weight:700>|</span> ubuntu      <span style=color:#000;font-weight:700>|</span> ubuntu <span style=color:#000;font-weight:700>|</span> 20.04.2<span style=color:#000;font-weight:700>&amp;</span><span style=color:#000>architecture</span><span style=color:#ce5c00;font-weight:700>=</span>server-arm64+raspi <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> ubuntu-20.04.2-32-bit <span style=color:#000;font-weight:700>|</span> 2021-02-01 <span style=color:#000;font-weight:700>|</span> ubuntu      <span style=color:#000;font-weight:700>|</span> ubuntu <span style=color:#000;font-weight:700>|</span> 20.04.2<span style=color:#000;font-weight:700>&amp;</span><span style=color:#000>architecture</span><span style=color:#ce5c00;font-weight:700>=</span>server-armhf+raspi <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> ubuntu-20.10-64-bit   <span style=color:#000;font-weight:700>|</span> 2021-02-01 <span style=color:#000;font-weight:700>|</span> ubuntu      <span style=color:#000;font-weight:700>|</span> ubuntu <span style=color:#000;font-weight:700>|</span> 20.10<span style=color:#000;font-weight:700>&amp;</span><span style=color:#000>architecture</span><span style=color:#ce5c00;font-weight:700>=</span>server-arm64+raspi   <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> ubuntu-20.10-32-bit   <span style=color:#000;font-weight:700>|</span> 2021-02-01 <span style=color:#000;font-weight:700>|</span> ubuntu      <span style=color:#000;font-weight:700>|</span> ubuntu <span style=color:#000;font-weight:700>|</span> 20.10<span style=color:#000;font-weight:700>&amp;</span><span style=color:#000>architecture</span><span style=color:#ce5c00;font-weight:700>=</span>server-armhf+raspi   <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> ubuntu-desktop        <span style=color:#000;font-weight:700>|</span> 2021-02-01 <span style=color:#000;font-weight:700>|</span> ubuntu      <span style=color:#000;font-weight:700>|</span> ubuntu <span style=color:#000;font-weight:700>|</span> 20.10<span style=color:#000;font-weight:700>&amp;</span><span style=color:#000>architecture</span><span style=color:#ce5c00;font-weight:700>=</span>desktop-arm64+raspi  <span style=color:#000;font-weight:700>|</span>
+-----------------------+------------+-------------+--------+-----------------------------------------+
</code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms burn image get latest-lite
you@yourlaptop $ cms burn image get latest-fll
</code></pre></div><h3 id=77-related-tutorials>7.7 Related tutorials</h3><ul><li><input disabled type=checkbox> TODO find the links, point to the medium.com once first.</li></ul><p>We provide also a list of related tutorials for other operating systems</p><p>This includes</p><p>Cluster with RaspberryOS on it:</p><ul><li><a href=https://laszewski.medium.com/easy-raspberry-pi-cluster-setup-with-cloudmesh-from-macos-e160ac848bf>Easy Raspberry PI Cluster Setup with Cloudmesh from MacOS</a></li><li>[Burning A Cluster with RaspberryOS on it from a Raspberry Pi]</li><li><a href=https://laszewski.medium.com/easy-raspberry-pi-cluster-setup-with-cloudmesh-sdcard-burner-a2035dfea22>TODO: Burning A Cluster with RaspberryOS on it from macOS</a></li><li><a href>TODO: Burning A Cluster with RaspberryOS on it from Ubuntu</a></li><li><a href>TODO: Burning A Cluster with RaspberryOS on it from Windows 10</a></li></ul><p>Cluster with Ubuntu on it:</p><ul><li><a href>TODO: Burning A cluster with Ubuntu on it from macOS</a></li><li><a href>TODO: Burning A cluster with Ubuntu on it from Ubuntu</a></li><li>Please note that burning the clustere from Windows 10 with
Ubuntu on the nodes has not yet been completed.
If you like to help, contact us.</li></ul><p>We have the following totorials also on other web pages. Here is a list</p><p>Hackaday:</p><ul><li><a href=https://hackaday.io/project/177874-preconfigured-sdcards-for-raspberry-pi-clusters>Preconfigured SDCards for Raspberry Pi Clusters</a></li><li><a href=https://hackaday.io/project/177904-headless-rasbery-pi-cluster-from-macs>https://hackaday.io/project/177904-headless-rasbery-pi-cluster-from-macs</a></li></ul><p>Piplanet:</p><p>Many tutorials are available at</p><ul><li><a href=https://cloudmesh.github.io/pi/tutorial/>piplanet.org/tutorial</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f5ee82ced5b00cecabe23b2b5c72e415>3 - Create and Deploy a Container and OpenAPI Service with Docker and K3s</h1><div class=lead>This post is walks you through using your pi cluster to create and deploy a container and OpenAPI Service on Docker and K3s</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:1121px><img class=card-img-top src=/pi/tutorial/create-deploy-container-k3/featured-dashboard_hu3bdb24a6878631c4ef3df1aa73d2ab37_260775_1111x610_fill_catmullrom_smart1_2.png width=1111 height=610><div class="card-body px-0 pt-2 pb-0"><p class=card-text></p></div></div><div class="pageinfo pageinfo-primary"><p>In this tutorial we will use a cms-burn created cluster to install Docker,
create a Docker container for the cloudmesh-openapi service, deploy the
container on Docker, install K3s, deploy the container on K3s, and enable
access to the container from an external host. Finally, automatically deploy
an OpenApi service onto a K3s cluster given only its python and yaml files.</p><p>This is currently (4/29/21) tested on a Raspberry pi using Ubuntu OS.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to install Docker, create a docker container, deploy a docker
container, install k3s, deploy a container on K3s, make K3s
containers externally accessible.</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-prerequisites>2. Prerequisites</a></li><li><a href=#3-install-docker>3. Install Docker</a></li><li><a href=#4-create-a-dockerfile>4. Create a Dockerfile</a></li><li><a href=#5-build-a-docker-image>5. Build a Docker Image</a></li><li><a href=#6-start-a-docker-container>6. Start a Docker Container</a></li><li><a href=#7-generate-and-start-the-cloudmesh-openapi-pipelineanovasvm-service>7. Generate and Start the Cloudmesh-Openapi PipelineAnovaSVM Service</a></li><li><a href=#8-interact-with-the-running-service>8. Interact with the Running Service</a></li><li><a href=#9-save-a-docker-image>9. Save a Docker Image</a></li><li><a href=#10-install-k3s-on-our-pi-cluster>10. Install K3s on our Pi Cluster</a></li><li><a href=#11-import-the-cloudmesh-openapi-image-into-all-k3s-nodes>11. Import the <code>cloudmesh-openapi</code> Image into All K3s Nodes</a></li><li><a href=#12-create-a-kubernetes-pod-manifest-yaml>12. Create a Kubernetes Pod Manifest YAML</a></li><li><a href=#13-deploy-a-pod>13. Deploy a Pod</a></li><li><a href=#14-start-a-shell-in-the-pod>14. Start a Shell in the Pod</a></li><li><a href=#15-create-a-kubernetes-service-manifest-to-start-a-k3s-load-balancer>15. Create a Kubernetes Service Manifest to Start a K3s Load-Balancer</a></li><li><a href=#16-deploy-the-loadbalancer-service>16. Deploy the LoadBalancer Service</a></li><li><a href=#17-interact-with-the-cloudmesh-openapi-pod>17. Interact with the <code>cloudmesh-openapi</code> Pod</a></li><li><a href=#18-automatically-deploy-an-openapi-service>18. Automatically deploy an OpenApi Service</a></li><li><a href=#19-creating-a-kubernetes-dashboard-to-monitor-the-services>19. Creating a Kubernetes Dashboard to Monitor the Services.</a></li><li><a href=#20-accessing-the-dashboard>20. Accessing the Dashboard</a></li><li><a href=#21-restarting-an-openapi-service-after-reboot>21. Restarting an OpenAPI service after Reboot.</a></li><li><a href=#22-commands-useful-for-debugging>22. Commands Useful for Debugging</a></li><li><a href=#23-uninstall-k3s>23. Uninstall K3s</a></li><li><a href=#24-uninstall-docker>24. Uninstall Docker</a></li></ul></nav></div></div><h2 id=1-introduction>1. Introduction</h2><p>Many tutorials walk you through individual components of our learning
objectives. This tutorial will walk you through step-by-step to create a
service and deploy it on a cms-brun created cluster.</p><h2 id=2-prerequisites>2. Prerequisites</h2><p>This tutorial assumes a cluster burned using one of the following methods:</p><p><a href=https://cloudmesh.github.io/pi/tutorial/raspberry-burn/>Burn a Raspberry OS Cluster</a> (not currently tested)</p><p><a href=https://cloudmesh.github.io/pi/tutorial/ubuntu-burn/>Burn an Ubuntu Cluster</a> (currently tested)</p><p><a href=https://cloudmesh.github.io/pi/tutorial/gui-burn/>Use our GUI to Burn a Cluster</a></p><h2 id=3-install-docker>3. Install Docker</h2><p>Access your cluster manager (red) and get the cloudmesh Docker installer.</p><pre><code>laptop$ ssh red
red$ cd cm
red$ cloudmesh-installer get docker-command
red$ cd ..
</code></pre><p>Now we install Docker.</p><pre><code>red$ cms docker deploy --host=localhost
</code></pre><p>Let us add our user to the Docker group so we can execute Docker comands without <code>sudo</code>.</p><pre><code>red$ sudo usermod -aG docker ubuntu
</code></pre><p>Let us verify the install by checking the version.</p><pre><code>red$ docker version
</code></pre><h2 id=4-create-a-dockerfile>4. Create a Dockerfile</h2><p>We will create a file named <code>Dockerfile</code> in a directory
<code>cloudmesh-openapi-container</code>. Substitute your prefered editor if you do not
like emacs.</p><pre><code>red$ mkdir cloudmesh-openapi-container
red$ cd cloudmesh-openapi-container
red$ emacs Dockerfile
</code></pre><p>In <code>Dockerfile</code> add the following lines. This provides Docker the commands
needed to install <a href=https://cloudmesh.github.io/pi/tutorial/analytics-services/>cloudmesh-openapi</a>
and the needed packages for our PipleLineAnovaSVM example into a Ubuntu
container.</p><pre><code># syntax=docker/dockerfile:1
FROM ubuntu:20.04
RUN mkdir cm
RUN apt update
RUN apt install python3-venv python3-wheel python3-dev python3-pip build-essential -y
RUN ln -s /usr/bin/pip3 /usr/bin/pip
RUN pip install pip -U
RUN pip install cloudmesh-installer
RUN apt install git -y
RUN cd cm; cloudmesh-installer get openapi
RUN pip install sklearn pandas
ARG DEBIAN_FRONTEND=noninteractive
ENV TZ=America/Indiana/Indianapolis
RUN apt install tzdata -y
RUN apt install emacs -y
CMD /bin/bash
</code></pre><h2 id=5-build-a-docker-image>5. Build a Docker Image</h2><p>Now we build an image based on the instructions provided in <code>Dockerfile</code>. We
name the image <code>cloudmesh-openapi</code>. The <code>.</code> instructs Docker to use the
Dockerfile in the present working directory.</p><pre><code>red$ docker build -t cloudmesh-openapi .
</code></pre><h2 id=6-start-a-docker-container>6. Start a Docker Container</h2><p>Now we start a Docker containe using our <code>cloudmesh-openapi</code> image. The
<code>-it</code> provide an interactive terminal, the <code>-p</code> maps the container port 8080
to the host port 8080, and <code>/bin/bash</code> is the command to run in the container.</p><pre><code>red$ docker run -it -p 8080:8080 cloudmesh-openapi /bin/bash
</code></pre><h2 id=7-generate-and-start-the-cloudmesh-openapi-pipelineanovasvm-service>7. Generate and Start the Cloudmesh-Openapi PipelineAnovaSVM Service</h2><p>Generate the service yaml.</p><pre><code>container$ cms openapi generate PipelineAnovaSVM \
    --filename=./tests/Scikitlearn-experimental/sklearn_svm.py \
    --import_class \
    --enable_upload
</code></pre><p>Start the service (defaults to port 8080). Leave this running and go to a
new terminal.</p><pre><code>container$ cms openapi server start ./tests/Scikitlearn-experimental/sklearn_svm.yaml --host=0.0.0.0
</code></pre><h2 id=8-interact-with-the-running-service>8. Interact with the Running Service</h2><p>In another terminal on your laptop you can now access the service from
<code>red.local:8080</code> because we mapped the container port 8080 to the host port 8080.</p><p>In a web browser go to <code>http://red.local:8080/cloudmesh/ui</code> to access the
web UI of the service.</p><p>Alternatively, you can access the service directly from the command line of
your laptop.</p><pre><code>laptop$ curl -L -o iris.data &quot;https://raw.githubusercontent.com/cloudmesh/cloudmesh-openapi/main/tests/Scikitlearn-experimental/iris.data&quot;

laptop$ export CMSIP=red.local:8080

laptop$ curl -X POST &quot;http://$CMSIP/cloudmesh/upload&quot; -H  &quot;accept: text/plain&quot; -H  &quot;Content-Type: multipart/form-data&quot; -F &quot;upload=@iris.data&quot;

laptop$ curl -X GET &quot;http://$CMSIP/cloudmesh/PipelineAnovaSVM/train?filename=iris.data&quot; -H  &quot;accept: text/plain&quot;

laptop$ curl -X GET &quot;http://$CMSIP/cloudmesh/PipelineAnovaSVM/make_prediction?model_name=iris&amp;params=5.1%2C%203.5%2C%201.4%2C%200.2&quot; -H  &quot;accept: */*&quot;
</code></pre><p>You can now <code>ctrl-C</code> and <code>exit</code> the running container to stop the service.</p><h2 id=9-save-a-docker-image>9. Save a Docker Image</h2><p>We need to save the Docker image so we can provide it to our K3s cluster.
alternatively you can upload it to a Docker registry like DockerHub.</p><p>We save our image in a tarfile named <code>cloudmesh-openapi.tar</code>.</p><pre><code>red$ docker save --output cloudmesh-openapi.tar cloudmesh-openapi:latest
</code></pre><p>We will reference this file later to import it to our K3s cluster.</p><h2 id=10-install-k3s-on-our-pi-cluster>10. Install K3s on our Pi Cluster</h2><p>Enable containers in the kernel, and wait for the cluster to reboot.</p><pre><code>laptop$ cms pi k3 enable containers red,red[01-03]
</code></pre><p>Now install K3s</p><pre><code>laptop$ cms pi k3 install cluster red,red0[1-3]
</code></pre><p>Verify all nodes show up.</p><pre><code>laptop$ cms pi k3 cluster info
</code></pre><h2 id=11-import-the-cloudmesh-openapi-image-into-all-k3s-nodes>11. Import the <code>cloudmesh-openapi</code> Image into All K3s Nodes</h2><p>As we are not using an image repository, we need to copy our
<code>cloudmesh-openapi.tar</code> file to all k3s nodes and import them image into
K3s.</p><pre><code>red$ cms pi k3 import image red,red0[1-3] cloudmesh-openapi.tar /home/ubuntu

pi k3 import image red,red0[1-3] cloudmesh-openapi.tar /home/ubuntu
INFO: Copying image to ['red', 'red01', 'red02', 'red03'] using source: cloudmesh-openapi.tar and destination: /home/ubuntu
INFO: This may take a few minutes depending on the file size and number of destinations
+---------+---------+--------+
| host    | success | stdout |
+---------+---------+--------+
| red     | True    |        |
| red01   | True    |        |
| red02   | True    |        |
| red03   | True    |        |
+---------+---------+--------+
INFO: Import image on ['red', 'red01', 'red02', 'red03'] using filepath:/home/ubuntu/cloudmesh-openapi.tar
+---------+---------+--------------------------------------------------+
| host    | success | stdout                                           |
+---------+---------+--------------------------------------------------+
| red     | True    | unpacking docker.io/library/cloudmesh-           |
|         |         | openapi:latest (sha256:829d62dafbb8c3335804517d6 |
|         |         | 00313e64be1983b93286328f6c0f66f7c4781ad)...done  |
| red01   | True    | unpacking docker.io/library/cloudmesh-           |
|         |         | openapi:latest (sha256:829d62dafbb8c3335804517d6 |
|         |         | 00313e64be1983b93286328f6c0f66f7c4781ad)...done  |
| red02   | True    | unpacking docker.io/library/cloudmesh-           |
|         |         | openapi:latest (sha256:829d62dafbb8c3335804517d6 |
|         |         | 00313e64be1983b93286328f6c0f66f7c4781ad)...done  |
| red03   | True    | unpacking docker.io/library/cloudmesh-           |
|         |         | openapi:latest (sha256:829d62dafbb8c3335804517d6 |
|         |         | 00313e64be1983b93286328f6c0f66f7c4781ad)...done  |
+---------+---------+--------------------------------------------------+
</code></pre><p>Validate the container is present.</p><pre><code>red$ sudo k3s ctr images list 
</code></pre><h2 id=12-create-a-kubernetes-pod-manifest-yaml>12. Create a Kubernetes Pod Manifest YAML</h2><p>To create Pod in Kubernetes, you need to define a YAML file. We create one
named <code>cloudmesh-openapi-pod.yaml</code>. The pod is the smallest deployable unit
of computing in K8s, and is a group of one or more containers. In our case one.</p><p>Create <code>cloudmesh-openapi-pod.yaml</code> and paste the following lines in the
document.</p><pre><code>apiVersion: v1
kind: Pod
metadata:
  name: cloudmesh-openapi-pod
  labels:
    app: cloudmesh-openapi-pod
spec:
  containers:
  - name: cloudmesh-openapi
    image: cloudmesh-openapi:latest
    imagePullPolicy: Never
    command:
      - &quot;sleep&quot;
      - &quot;604800&quot;
</code></pre><p>This will define a pod named <code>cloudmesh-openapi-pod</code>, containing
one container named <code>cloudmesh-openapi</code> based on our
<code>cloudmesh-openapi:latest</code> image, running the command <code>sleep 604800</code>. This
will essentially keep our container running for 7 days and then it will
close and restart based on the default restart policy: ALWAYS. The <code>. metadata.label.app</code> is important as it allows us to select our pod in our
in our following load-balancer service. The <code>.spec.imagePullPolicy: Never</code>
is also important as it prevents K8s from trying to download our image from
any repository and instead use the local copy.</p><h2 id=13-deploy-a-pod>13. Deploy a Pod</h2><p>Deploy your pod by applying the <code>cloudmesh-openapi-pod.yaml</code> configuration.</p><pre><code>red$ sudo kubectl apply -f ./cloudmesh-openapi-pod.yaml
</code></pre><p>Check that the pod is running.</p><pre><code>red$ sudo kubectl get pods
</code></pre><h2 id=14-start-a-shell-in-the-pod>14. Start a Shell in the Pod</h2><p>We need to start a shell in our Pod so we can generate and run the
cloudmesh-openapi service.</p><pre><code>red$ sudo kubectl exec --stdin --tty cloudmesh-openapi-pod -- /bin/bash
</code></pre><p>We can now run our serice generate and start command.</p><pre><code>container$ cms openapi generate PipelineAnovaSVM \
    --filename=./tests/Scikitlearn-experimental/sklearn_svm.py \
    --import_class \
    --enable_upload
</code></pre><pre><code>container$ cms openapi server start ./tests/Scikitlearn-experimental/sklearn_svm.yaml --host=0.0.0.0
</code></pre><p>You can now <code>exit</code> and the container and the service will continue running.</p><h2 id=15-create-a-kubernetes-service-manifest-to-start-a-k3s-load-balancer>15. Create a Kubernetes Service Manifest to Start a K3s Load-Balancer</h2><p>Kubernetes services expose your cluster Pods to external networks. K3s comes
with a build int load balancer that watches for Kubernetes LoadBalancer
services, and then deploys the necessary network infrastructure to make your
service accessible.</p><p>Create a file names <code>cloudmesh-openapi-lb-service.yaml</code> and paste the
following lines.</p><pre><code>apiVersion: v1
kind: Service
metadata:
  name: cloudmesh-openapi-lb-service
spec:
  selector:
    app: cloudmesh-openapi-pod
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
      nodePort: 30000
  type: LoadBalancer
</code></pre><p>It is important that the <code>.spec.selector.app</code> matches that defined in your
pod yaml. The <code>port</code> is the port accessible on cluster internal nodes, the
<code>targetPort</code> is the port in the container to which traffic will be forwarded,
and the <code>nodePort</code> is the port on cluster external networks can access the
service. This must match a predefined range.</p><h2 id=16-deploy-the-loadbalancer-service>16. Deploy the LoadBalancer Service</h2><p>Deploy the loadbalancer.</p><pre><code>red$ sudo kubectl apply -f ./cloudmesh-openapi-lb.service.yaml
</code></pre><p>Check to ensure it deployed.</p><pre><code>red$ sudo kubectl get services -o wide
</code></pre><p>Check to see the load balancer pods are deployed on all agent nodes.</p><pre><code>red$ sudo kubectl get pods
</code></pre><h2 id=17-interact-with-the-cloudmesh-openapi-pod>17. Interact with the <code>cloudmesh-openapi</code> Pod</h2><p>Because the loadbalancer is running on all nodes and forwarding traffic to
the existing pod, we can now reach our service from our laptop at <code>red.local:30000</code>. For some
reason <code>red.local:8080</code> works as well, I can&rsquo;t explain that yet.</p><p>On your laptop web browser browse to <code>http://red.local:30000/cloudmesh/ui</code></p><p>Alternatively, interact with the service from the command line.</p><pre><code>laptop$ curl -L -o iris.data &quot;https://raw.githubusercontent.com/cloudmesh/cloudmesh-openapi/main/tests/Scikitlearn-experimental/iris.data&quot;

laptop$ export CMSIP=red.local:30000

laptop$ curl -X POST &quot;http://$CMSIP/cloudmesh/upload&quot; -H  &quot;accept: text/plain&quot; -H  &quot;Content-Type: multipart/form-data&quot; -F &quot;upload=@iris.data&quot;

laptop$ curl -X GET &quot;http://$CMSIP/cloudmesh/PipelineAnovaSVM/train?filename=iris.data&quot; -H  &quot;accept: text/plain&quot;

laptop$ curl -X GET &quot;http://$CMSIP/cloudmesh/PipelineAnovaSVM/make_prediction?model_name=iris&amp;params=5.1%2C%203.5%2C%201.4%2C%200.2&quot; -H  &quot;accept: */*&quot;
</code></pre><h2 id=18-automatically-deploy-an-openapi-service>18. Automatically deploy an OpenApi Service</h2><p>We have provided a command that can automatically deploy an OpenAPI service
given the YAML file, python file, the server, and the ports you want it
deployed on. We expect the user to have previously used cloudmesh-openapi to
generate these files as needed.</p><p><code>cms pi k3 api deploy SERVER PORTS YAML PYTHON</code></p><p>Below is an example command invocation where whe deploy the Scikilearn Pipeline Anova SVM example as a service using the yaml file <code>sklearn_svm.yaml</code> and the python file <code>sklearn_svm_upload-enabled.py</code></p><pre><code>laptop$ cms pi k3 api deploy red 80[80-85] sklearn_svm.yaml sklearn_svm_upload-enabled.py

pi k3 api deploy red 80[80-85] sklearn_svm.yaml sklearn_svm_upload-enabled.py
INFO: Deploying cloudmesh openapi service based on yaml:sklearn_svm.yaml 
python file: sklearn_svm_upload-enabled.py to ports: ['8080', '8081', '8082','8083', '8084', '8085'] on server red
INFO: Deploying service for port: 8080
INFO: Deploying service for port: 8081
INFO: Deploying service for port: 8082
INFO: Deploying service for port: 8083
INFO: Deploying service for port: 8084
INFO: Deploying service for port: 8085
INFO: Services are available at:
NAME                                                 TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)          AGE
kubernetes                                           ClusterIP      10.43.0.1       &lt;none&gt;         443/TCP          39h
cloudmesh-openapi-sklearn-svm-port-8080-lb-service   LoadBalancer   10.43.157.137   192.168.1.16   8080:30988/TCP   89s
cloudmesh-openapi-sklearn-svm-port-8081-lb-service   LoadBalancer   10.43.105.151   192.168.1.16   8081:31733/TCP   69s
cloudmesh-openapi-sklearn-svm-port-8082-lb-service   LoadBalancer   10.43.66.0      192.168.1.16   8082:30442/TCP   55s
cloudmesh-openapi-sklearn-svm-port-8083-lb-service   LoadBalancer   10.43.212.54    192.168.1.16   8083:31632/TCP   33s
cloudmesh-openapi-sklearn-svm-port-8084-lb-service   LoadBalancer   10.43.52.81     192.168.1.16   8084:30334/TCP   22s
cloudmesh-openapi-sklearn-svm-port-8085-lb-service   LoadBalancer   10.43.238.192   192.168.1.16   8085:31442/TCP   8s
</code></pre><p>You can now access and interact with the service in the same manner as we
conducted in section 17.</p><h2 id=19-creating-a-kubernetes-dashboard-to-monitor-the-services>19. Creating a Kubernetes Dashboard to Monitor the Services.</h2><p>Next we will install a Kubernetes Dashboard so we can monitor the resource
consumption of our services.</p><p>If using Raspberry OS on the pis, run:</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard create red
</code></pre><p>If using Ubuntu Server on the pis, run:</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard create red --ubuntu
</code></pre><p>Both commands will automatically start the dashboard. However, on Ubuntu Server, <code>cms pi k3 dashboard start red</code> needs to be run when the pi is rebooted.</p><h2 id=20-accessing-the-dashboard>20. Accessing the Dashboard</h2><p>We can easily access the Web UI Dashboard for easy management of our cluster.</p><p>First, let us connect to the new dashboard created above.</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard connect red
</code></pre><p>We should get a green &ldquo;Connection created&rdquo; message. We can now check on the status of our dashboard and obtain our token to log in.</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard info
pi k3 dashboard info
INFO: Finding running dashboards...
+---------------------+-------------+------------+------------------+-------+
| Server Access Point | Remote Port | Local Port | Dashboard Status | PID   |
+---------------------+-------------+------------+------------------+-------+
| red                 | 8001        | 8001       | Active           | 99240 |
+---------------------+-------------+------------+------------------+-------+
INFO: Dashboard Link:
http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
INFO: Fetching authentication token...
# A long token will go here
</code></pre><blockquote><p>Note. If <code>Dasboard Status</code> says &ldquo;Up but not ready&rdquo;, the k3s dashboard is still likely in the process of coming online. Wait a few moments and try the info command again.</p></blockquote><p>Take note of the authentication token given. To open the dashboard, you may click on the link provided by the info command or use the following command to automaticallly open in browser.</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard
pi k3 dashboard
Opening dashboard...
</code></pre><p>You can monitor your pods resources consumption on the Pods tab.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:1121px><img class=card-img-top src=/pi/tutorial/create-deploy-container-k3/featured-dashboard_hu3bdb24a6878631c4ef3df1aa73d2ab37_260775_1111x610_fill_catmullrom_smart1_2.png width=1111 height=610><div class="card-body px-0 pt-2 pb-0"><p class=card-text></p></div></div><p>When ready, you can then disconnect from your dashboard with the following:</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard disconnect
</code></pre><h2 id=21-restarting-an-openapi-service-after-reboot>21. Restarting an OpenAPI service after Reboot.</h2><p>While hte containers will persist after a reboot, the services do not
currently automatically restart.</p><p>To restart the service suse the command</p><p><code>cms pi k3 api start SERVER PORTS YAML PYTHON</code></p><p>The YAML and PYTHON require the base filename only, they are not re-copied.</p><p>Here is an example invocation.</p><pre><code>laptopl$ cms pi k3 api start red 80[80-89] sklearn_svm.yaml sklearn_svm_upload-enabled.py
pi k3 api start red 80[80-89] sklearn_svm.yaml sklearn_svm_upload-enabled.py
INFO: Starting services in on ports ['8080', '8081', '8082', '8083', '8084', '8085']
INFO: Service on 8080 successfully started
INFO: Service on 8081 successfully started
INFO: Service on 8082 successfully started
INFO: Service on 8083 successfully started
INFO: Service on 8084 successfully started
INFO: Service on 8085 successfully started
</code></pre><h2 id=22-commands-useful-for-debugging>22. Commands Useful for Debugging</h2><p>Useful <code>kubectl</code> commands to debug a broken pod/service</p><pre><code>sudo kubectl describe pod cloudmesh-openapi-pod
sudo kubectl logs --previous cloudmesh-openapi-pod cloudmesh-openapi
sudo kubectl logs cloudmesh-openapi-pod cloudmesh-openapi
sudo kubectl delete pod cloudmesh-openapi-pod
sudo kubectl delete service clodmesh-openapi-lb-service
sudo kubectl get pods --show-labels
sudo kubectl edit pod cloudmesh-openapi-pod
</code></pre><p>If you have trouble accessing the pod shell, like below. Try stopping and
restarting the K3s services.</p><pre><code>(ENV3) ubuntu@red:~/cloudmesh-openapi-container$ sudo kubectl exec --stdin --tty cloudmesh-openapi-pod -- /bin/bash
error: unable to upgrade connection: Authorization error (user=kube-apiserver, verb=create, resource=nodes, subresource=proxy)
</code></pre><p>Stop and restart the K3s services.</p><pre><code>red$ cms pi k3 stop agent red,red0[1-3]
red$ cms pi k3 stop server red
red$ cms pi k3 start server red
ree$ cms pi k3 start agent red,red0[1-3]
</code></pre><h2 id=23-uninstall-k3s>23. Uninstall K3s</h2><pre><code>laptop$ cms pi k3 uninstall cluster red,red0[1-3]
</code></pre><h2 id=24-uninstall-docker>24. Uninstall Docker</h2><pre><code>red$ sudo apt-get purge docker-ce docker-ce-cli containerd.io
red$ sudo rm -rf /var/lib/docker
red$ sudo rm -rf /var/lib/containerd
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-3ffe143e2c4df353af7ad2c2b548ec93>4 - Employ K3S on a Pi Cluster</h1><div class=lead>Easily install your own K3S cluster on Raspberry Pis</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/k3s-cluster/featured-image_hu31ad1de8477c329f5412ff59acdd044d_22590_600x300_fill_catmullrom_smart1_2.png width=600 height=300><div class="card-body px-0 pt-2 pb-0"><p class=card-text></p></div></div><div class="pageinfo pageinfo-primary"><p>Install, manage, operate, and uninstall K3s on a cluster of Raspberry Pis
running Raspberry OS or Ubuntu.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to easily install, manage, operate, and unisntall a K3S cluster
using <code>cms</code>.</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-prequisites>2. Prequisites</a></li><li><a href=#3-cms-k3-commands>3. CMS k3 Commands</a></li><li><a href=#4-enable-containers>4. Enable Containers</a></li><li><a href=#5-install-k3s-on-the-entire-cluster>5. Install K3s on the Entire Cluster</a></li><li><a href=#6-verify-the-k3s-cluster-install>6. Verify the K3S Cluster Install</a></li><li><a href=#7-creating-the-dashboard>7. Creating the Dashboard.</a></li><li><a href=#8-accessing-the-dashboard>8. Accessing the Dashboard</a></li><li><a href=#9-adding-a-new-machine-to-the-cluster>9. Adding a new machine to the cluster</a></li><li><a href=#10-uninstall-the-k3s-cluster>10. Uninstall the K3S Cluster</a></li><li><a href=#11-add-a-new-standalone-k3s-server>11. Add a New Standalone K3S Server</a></li><li><a href=#12-uninstall-a-specific-k3s-server>12. Uninstall a specific K3S server</a></li><li><a href=#13-uninstall-a-specific-k3s-agent>13. Uninstall a Specific K3S Agent</a></li><li><a href=#14-kill-all-k3s-services-and-containers-on-hosts>14. Kill all K3S Services and Containers on Hosts</a></li><li><a href=#15-start-the-k3s-cluster-services>15. Start the K3S Cluster Services</a></li><li><a href=#16-stop-the-k3s-cluster-services>16. Stop the K3S Cluster Services</a></li><li><a href=#17-remove-a-node-from-the-cluster>17. Remove a Node from the Cluster</a></li></ul></nav></div></div><h2 id=1-introduction>1. Introduction</h2><p>K3S provides a lightweight, single binary distribution of Kubernetes with
very close feature parity to K8s that is perfect for single board computers
like the Raspberry Pi. In this tutorial we will install, verify, and
unistall K3s on a cluster of Pis that was created using the Cloudmesh burn
software.</p><h2 id=2-prequisites>2. Prequisites</h2><p>This tutorial assumes a cluster burned using one of the following methods:</p><p><a href=https://cloudmesh.github.io/pi/tutorial/raspberry-burn/>Burn a Raspberry OS Cluster</a></p><p><a href=https://cloudmesh.github.io/pi/tutorial/ubuntu-burn/>Burn an Ubuntu Cluster</a></p><p><a href=https://cloudmesh.github.io/pi/tutorial/gui-burn/>Use our GUI to Burn a Cluster</a></p><p>The tutorial supports both Raspberry OS and Ubuntu with no required user
input change.</p><h2 id=3-cms-k3-commands>3. CMS k3 Commands</h2><pre><code>    pi k3 enable containers NAMES
    pi k3 install server NAMES
    pi k3 install agent NAMES SERVER
    pi k3 install cluster NAMES
    pi k3 uninstall server NAMES
    pi k3 uninstall agent NAMES
    pi k3 uninstall cluster NAMES
    pi k3 kill NAMES
    pi k3 start server NAMES
    pi k3 start agent NAMES
    pi k3 start cluster NAMES
    pi k3 stop server NAMES
    pi k3 stop agent NAMES
    pi k3 stop cluster NAMES
    pi k3 remove node NAMES SERVER
    pi k3 cluster info SERVER
    pi k3 dashboard create SERVER [--ubuntu]
    pi k3 dashboard start SERVER
    pi k3 dashboard connect SERVER
    pi k3 dashboard disconnect [SERVER]
    pi k3 dashboard info
    pi k3 dashboard
    pi k3 import image NAMES SOURCE DESTINATION
    pi k3 api deploy SERVER PORTS YAML PYTHON
    pi k3 api start SERVER PORTS YAML PYTHON
</code></pre><h2 id=4-enable-containers>4. Enable Containers</h2><p>This command adds <code>'cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory'</code> to the end of the arguments in <code>cmdline.txt</code> if
they are not already present, and reboots the machines. This is required to
enable containers in the kernel.</p><pre><code>you@your-laptop:~$ cms pi k3 enable containers red,red0[1-3]
pi k3 enable containers red,red0[1-3]
INFO: Enabling cgroups for ['red', 'red01', 'red02', 'red03']
+-------+---------+--------+
| host  | success | stdout |
+-------+---------+--------+
| red   | True    |        |
| red01 | True    |        |
| red02 | True    |        |
| red03 | True    |        |
+-------+---------+--------+
INFO: Executing `sudo reboot` for ['red01', 'red02', 'red03']
INFO: Executing `sudo reboot` for red
</code></pre><h2 id=5-install-k3s-on-the-entire-cluster>5. Install K3s on the Entire Cluster</h2><p>This command wil install a K3S cluster with the manager (red) acting as the K3s
server, and the workers and the manager will be installed as agents of that
server. This also installs and configures a Web UI Dashboard.</p><pre><code>you@yourlaptop:~$ cms pi k3 install cluster red,red0[1-3]
pi k3 install cluster red,red0[1-3]
INFO: Installing K3s as stand-alone server on ['red']
+------+---------+--------------------------------------------------+
| host | success | stdout                                           |
+------+---------+--------------------------------------------------+
| red  | True    | [INFO]  Finding release for channel stable       |
|      |         | [INFO]  Using v1.20.5+k3s1 as release            |
|      |         | [INFO]  Downloading hash https://github.com/k3s- |
|      |         | io/k3s/releases/download/v1.20.5+k3s1/sha256sum- |
|      |         | arm.txt                                          |
|      |         | [INFO]  Downloading binary https://github.com/k3 |
|      |         | s-io/k3s/releases/download/v1.20.5+k3s1/k3s-armh |
|      |         | f                                                |
|      |         | [INFO]  Verifying binary download                |
|      |         | [INFO]  Installing k3s to /usr/local/bin/k3s     |
|      |         | [INFO]  Creating /usr/local/bin/kubectl symlink  |
|      |         | to k3s                                           |
|      |         | [INFO]  Creating /usr/local/bin/crictl symlink   |
|      |         | to k3s                                           |
|      |         | [INFO]  Creating /usr/local/bin/ctr symlink to   |
|      |         | k3s                                              |
|      |         | [INFO]  Creating killall script                  |
|      |         | /usr/local/bin/k3s-killall.sh                    |
|      |         | [INFO]  Creating uninstall script                |
|      |         | /usr/local/bin/k3s-uninstall.sh                  |
|      |         | [INFO]  env: Creating environment file           |
|      |         | /etc/systemd/system/k3s.service.env              |
|      |         | [INFO]  systemd: Creating service file           |
|      |         | /etc/systemd/system/k3s.service                  |
|      |         | [INFO]  systemd: Enabling k3s unit               |
|      |         | [INFO]  systemd: Starting k3s                    |
+------+---------+--------------------------------------------------+
INFO: Installing K3s on red as agent of red
INFO: Fetching the server token
+------+---------+--------------------------------------------------+
| host | success | stdout                                           |
+------+---------+--------------------------------------------------+
| red  | True    | [INFO]  Finding release for channel stable       |
|      |         | [INFO]  Using v1.20.5+k3s1 as release            |
|      |         | [INFO]  Downloading hash https://github.com/k3s- |
|      |         | io/k3s/releases/download/v1.20.5+k3s1/sha256sum- |
|      |         | arm.txt                                          |
|      |         | [INFO]  Skipping binary downloaded, installed    |
|      |         | k3s matches hash                                 |
|      |         | [INFO]  Skipping /usr/local/bin/kubectl symlink  |
|      |         | to k3s, already exists                           |
|      |         | [INFO]  Skipping /usr/local/bin/crictl symlink   |
|      |         | to k3s, already exists                           |
|      |         | [INFO]  Skipping /usr/local/bin/ctr symlink to   |
|      |         | k3s, already exists                              |
|      |         | [INFO]  Creating killall script                  |
|      |         | /usr/local/bin/k3s-killall.sh                    |
|      |         | [INFO]  Creating uninstall script                |
|      |         | /usr/local/bin/k3s-agent-uninstall.sh            |
|      |         | [INFO]  env: Creating environment file           |
|      |         | /etc/systemd/system/k3s-agent.service.env        |
|      |         | [INFO]  systemd: Creating service file           |
|      |         | /etc/systemd/system/k3s-agent.service            |
|      |         | [INFO]  systemd: Enabling k3s-agent unit         |
|      |         | [INFO]  systemd: Starting k3s-agent              |
+------+---------+--------------------------------------------------+
INFO: Installing K3s on ['red01', 'red02', 'red03'] as agent of red
INFO: Fetching the server token
+-------+---------+--------------------------------------------------+
| host  | success | stdout                                           |
+-------+---------+--------------------------------------------------+
| red01 | True    | [INFO]  Finding release for channel stable       |
|       |         | [INFO]  Using v1.20.5+k3s1 as release            |
|       |         | [INFO]  Downloading hash https://github.com/k3s- |
|       |         | io/k3s/releases/download/v1.20.5+k3s1/sha256sum- |
|       |         | arm.txt                                          |
|       |         | [INFO]  Downloading binary https://github.com/k3 |
|       |         | s-io/k3s/releases/download/v1.20.5+k3s1/k3s-armh |
|       |         | f                                                |
|       |         | [INFO]  Verifying binary download                |
|       |         | [INFO]  Installing k3s to /usr/local/bin/k3s     |
|       |         | [INFO]  Creating /usr/local/bin/kubectl symlink  |
|       |         | to k3s                                           |
|       |         | [INFO]  Creating /usr/local/bin/crictl symlink   |
|       |         | to k3s                                           |
|       |         | [INFO]  Creating /usr/local/bin/ctr symlink to   |
|       |         | k3s                                              |
|       |         | [INFO]  Creating killall script                  |
|       |         | /usr/local/bin/k3s-killall.sh                    |
|       |         | [INFO]  Creating uninstall script                |
|       |         | /usr/local/bin/k3s-agent-uninstall.sh            |
|       |         | [INFO]  env: Creating environment file           |
|       |         | /etc/systemd/system/k3s-agent.service.env        |
|       |         | [INFO]  systemd: Creating service file           |
|       |         | /etc/systemd/system/k3s-agent.service            |
|       |         | [INFO]  systemd: Enabling k3s-agent unit         |
|       |         | [INFO]  systemd: Starting k3s-agent              |
... Some output removed for brevity
</code></pre><h2 id=6-verify-the-k3s-cluster-install>6. Verify the K3S Cluster Install</h2><p>Wait a moment for k3s to set up initial containers.</p><p>Let us check that server reports the appropriate nodes as members.</p><p>We can run remote commands with the <code>cms host ssh</code> command as well as using
K3S specific commands.</p><p>For example to get cluster information we can run</p><pre><code>you@your-laptop:~$ cms pi k3 cluster info red
pi k3 cluster info red
INFO: Getting cluster info for red
INFO: sudo kubectl get nodes -o wide
NAME    STATUS   ROLES                  AGE   VERSION        INTERNAL-IP   EXTERNAL-IP    OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
red03   Ready    &lt;none&gt;                 28s   v1.20.5+k3s1   10.1.1.4      &lt;none&gt;         Raspbian GNU/Linux 10 (buster)   5.10.17-v7l+     containerd://1.4.4-k3s1
red02   Ready    &lt;none&gt;                 30s   v1.20.5+k3s1   10.1.1.3      &lt;none&gt;         Raspbian GNU/Linux 10 (buster)   5.10.17-v7l+     containerd://1.4.4-k3s1
red01   Ready    &lt;none&gt;                 27s   v1.20.5+k3s1   10.1.1.2      &lt;none&gt;         Raspbian GNU/Linux 10 (buster)   5.10.17-v7l+     containerd://1.4.4-k3s1
red     Ready    control-plane,master   84s   v1.20.5+k3s1   10.1.1.1      192.168.1.22   Raspbian GNU/Linux 10 (buster)   5.10.17-v7l+     containerd://1.4.4-k3s1
INFO: Server node token
K106f1caa41b133e69a69b1e3ac1da3a451393029e382be846eb0bcb7dfc7eab2db::server:2d604411ff6ab2a7c162bc4e82292690
INFO: Containers running on nodes
NODE: red03
CONTAINER           IMAGE               CREATED             STATE               NAME                ATTEMPT             POD ID
a24076569fa00       7d23a14d38d24       5 seconds ago       Running             lb-port-443         0                   70adcf7269a03
3332e6b1f602d       7d23a14d38d24       6 seconds ago       Running             lb-port-80          0                   70adcf7269a03
2f1273e3eca91       d24dd28770a36       15 seconds ago      Running             metrics-server      0                   0ca2190dba121

NODE: red02
CONTAINER           IMAGE               CREATED             STATE               NAME                     ATTEMPT             POD ID
be2ca6f1b77a5       7d23a14d38d24       5 seconds ago       Running             lb-port-443              0                   fc85e830e60bd
98ae1280e7a59       7d23a14d38d24       6 seconds ago       Running             lb-port-80               0                   fc85e830e60bd
ebcc2edeb3926       1e695755cc09d       13 seconds ago      Running             local-path-provisioner   0                   140da1f145714

NODE: red01
CONTAINER           IMAGE               CREATED             STATE               NAME                ATTEMPT             POD ID
bb4a9295bc345       7d23a14d38d24       1 second ago        Running             lb-port-443         0                   9fc4bec3faae0
6ba339136ae1a       944e5aba28f45       1 second ago        Running             traefik             0                   87ce8f8685767
491c2d8832f8d       7d23a14d38d24       1 second ago        Running             lb-port-80          0                   9fc4bec3faae0
d12b76e2c51e7       a0ce6ab869a69       12 seconds ago      Running             coredns             0                   a1777698c457c

NODE: red
CONTAINER           IMAGE               CREATED             STATE               NAME                ATTEMPT             POD ID
afa997d47eb33       7d23a14d38d24       4 seconds ago       Running             lb-port-443         0                   524fcbbd2b879
d0921db7d2229       7d23a14d38d24       5 seconds ago       Running             lb-port-80          0                   524fcbbd2b879
</code></pre><p>Or we can run the commands directly with <code>cms host ssh</code> as demonstrated
below. This is useful for commands that may not be built into cms, or that
the user knows better than the cms shell commands.</p><blockquote><p>NOTE: <code>cms host ssh</code>
commands go are interpreted first by bash and then by python, complex
commands may not work without complex escape sequences.</p></blockquote><pre><code>you@your-laptop:~$ cms host ssh red \&quot; sudo kubectl get nodes \&quot;
host ssh red &quot; sudo kubectl get nodes &quot;
+------+---------+--------------------------------------------------+
| host | success | stdout                                           |
+------+---------+--------------------------------------------------+
| red  | True    | NAME    STATUS   ROLES                  AGE      |
|      |         | VERSION                                          |
|      |         | red01   Ready    &lt;none&gt;                 15m      |
|      |         | v1.20.5+k3s1                                     |
|      |         | red02   Ready    &lt;none&gt;                 15m      |
|      |         | v1.20.5+k3s1                                     |
|      |         | red03   Ready    &lt;none&gt;                 15m      |
|      |         | v1.20.5+k3s1                                     |
|      |         | red     Ready    control-plane,master   16m      |
|      |         | v1.20.5+k3s1                                     |
+------+---------+--------------------------------------------------+
</code></pre><h2 id=7-creating-the-dashboard>7. Creating the Dashboard.</h2><p>It is straightforward to create a dashboard for our newly created cluster.</p><p>If using Raspberry OS on the pis, run:</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard create red
</code></pre><p>If using Ubuntu Server on the pis, run:</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard create red --ubuntu
</code></pre><p>Both commands will automatically start the dashboard. However, on Ubuntu Server, <code>cms pi k3 dashboard start red</code> needs to be run when the pi is rebooted.</p><h2 id=8-accessing-the-dashboard>8. Accessing the Dashboard</h2><p>We can easily access the Web UI Dashboard for easy management of our cluster.</p><p>First, let us connect to the new dashboard created above.</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard connect red
</code></pre><p>We should get a green &ldquo;Connection created&rdquo; message. We can now check on the status of our dashboard and obtain our token to log in.</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard info
pi k3 dashboard info
INFO: Finding running dashboards...
+---------------------+-------------+------------+------------------+-------+
| Server Access Point | Remote Port | Local Port | Dashboard Status | PID   |
+---------------------+-------------+------------+------------------+-------+
| red                 | 8001        | 8001       | Active           | 99240 |
+---------------------+-------------+------------+------------------+-------+
INFO: Dashboard Link:
http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
INFO: Fetching authentication token...
# A long token will go here
</code></pre><blockquote><p>Note. If <code>Dasboard Status</code> says &ldquo;Up but not ready&rdquo;, the k3s dashboard is still likely in the process of coming online. Wait a few moments and try the info command again.</p></blockquote><p>Take note of the authentication token given. To open the dashboard, you may click on the link provided by the info command or use the following command to automaticallly open in browser.</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard
pi k3 dashboard
Opening dashboard...
</code></pre><p>When ready, you can then disconnect from your dashboard with the following:</p><pre><code>you@your-laptop:~$ cms pi k3 dashboard disconnect
</code></pre><h2 id=9-adding-a-new-machine-to-the-cluster>9. Adding a new machine to the cluster</h2><p>We will add a new machine red04 to be an agent of the red hosted cluster.</p><pre><code>you@your-laptop:~$ cms pi k3 install agent red04 red
pi k3 install agent red04 red
INFO: Installing K3s on red04 as agent of red
INFO: Fetching the server token
+-------+---------+--------------------------------------------------+
| host  | success | stdout                                           |
+-------+---------+--------------------------------------------------+
| red04 | True    | [INFO]  Finding release for channel stable       |
|       |         | [INFO]  Using v1.20.5+k3s1 as release            |
|       |         | [INFO]  Downloading hash https://github.com/k3s- |
|       |         | io/k3s/releases/download/v1.20.5+k3s1/sha256sum- |
|       |         | arm.txt                                          |
|       |         | [INFO]  Downloading binary https://github.com/k3 |
|       |         | s-io/k3s/releases/download/v1.20.5+k3s1/k3s-armh |
|       |         | f                                                |
|       |         | [INFO]  Verifying binary download                |
|       |         | [INFO]  Installing k3s to /usr/local/bin/k3s     |
|       |         | [INFO]  Creating /usr/local/bin/kubectl symlink  |
|       |         | to k3s                                           |
|       |         | [INFO]  Creating /usr/local/bin/crictl symlink   |
|       |         | to k3s                                           |
|       |         | [INFO]  Creating /usr/local/bin/ctr symlink to   |
|       |         | k3s                                              |
|       |         | [INFO]  Creating killall script                  |
|       |         | /usr/local/bin/k3s-killall.sh                    |
|       |         | [INFO]  Creating uninstall script                |
|       |         | /usr/local/bin/k3s-agent-uninstall.sh            |
|       |         | [INFO]  env: Creating environment file           |
|       |         | /etc/systemd/system/k3s-agent.service.env        |
|       |         | [INFO]  systemd: Creating service file           |
|       |         | /etc/systemd/system/k3s-agent.service            |
|       |         | [INFO]  systemd: Enabling k3s-agent unit         |
|       |         | [INFO]  systemd: Starting k3s-agent              |
+-------+---------+--------------------------------------------------+
</code></pre><h2 id=10-uninstall-the-k3s-cluster>10. Uninstall the K3S Cluster</h2><p>We can also easily uninstall the K3S cluster.</p><pre><code>you@your-laptop:~$ cms pi k3 uninstall cluster red,red0[1-3]
pi k3 uninstall cluster red,red0[1-3]
INFO: Uninstalling agent install of K3s on ['red', 'red01', 'red02', 'red03', red04']
+-------+---------+--------------------------------------------------+
| host  | success | stdout                                           |
+-------+---------+--------------------------------------------------+
| red   | True    | /usr/bin/systemctl                               |
|       |         | Additional k3s services installed, skipping      |
|       |         | uninstall of k3s                                 |
| red01 | True    | /usr/bin/systemctl                               |
| red02 | True    | /usr/bin/systemctl                               |
| red03 | True    | /usr/bin/systemctl                               |
| red04 | True    | /usr/bin/systemctl                               |
+-------+---------+--------------------------------------------------+
INFO: Uninstalling server install of K3s on red
+------+---------+--------------------+
| host | success | stdout             |
+------+---------+--------------------+
| red  | True    | /usr/bin/systemctl |
+------+---------+--------------------+
</code></pre><h2 id=11-add-a-new-standalone-k3s-server>11. Add a New Standalone K3S Server</h2><p>Now we will create a new standalone K3s server on red05.</p><pre><code>you@your-laptop:~$ cms pi k3 install server red05
pi k3 install server red05
INFO: Installing K3s as stand-alone server on ['red05']
+-------+---------+--------------------------------------------------+
| host  | success | stdout                                           |
+-------+---------+--------------------------------------------------+
| red05 | True    | [INFO]  Finding release for channel stable       |
|       |         | [INFO]  Using v1.20.5+k3s1 as release            |
|       |         | [INFO]  Downloading hash https://github.com/k3s- |
|       |         | io/k3s/releases/download/v1.20.5+k3s1/sha256sum- |
|       |         | arm.txt                                          |
|       |         | [INFO]  Downloading binary https://github.com/k3 |
|       |         | s-io/k3s/releases/download/v1.20.5+k3s1/k3s-armh |
|       |         | f                                                |
|       |         | [INFO]  Verifying binary download                |
|       |         | [INFO]  Installing k3s to /usr/local/bin/k3s     |
|       |         | [INFO]  Creating /usr/local/bin/kubectl symlink  |
|       |         | to k3s                                           |
|       |         | [INFO]  Creating /usr/local/bin/crictl symlink   |
|       |         | to k3s                                           |
|       |         | [INFO]  Creating /usr/local/bin/ctr symlink to   |
|       |         | k3s                                              |
|       |         | [INFO]  Creating killall script                  |
|       |         | /usr/local/bin/k3s-killall.sh                    |
|       |         | [INFO]  Creating uninstall script                |
|       |         | /usr/local/bin/k3s-uninstall.sh                  |
|       |         | [INFO]  env: Creating environment file           |
|       |         | /etc/systemd/system/k3s.service.env              |
|       |         | [INFO]  systemd: Creating service file           |
|       |         | /etc/systemd/system/k3s.service                  |
|       |         | [INFO]  systemd: Enabling k3s unit               |
|       |         | [INFO]  systemd: Starting k3s                    |
+-------+---------+--------------------------------------------------+
</code></pre><p>To subsequently add this server as an agent to itself, you will need to run</p><pre><code>you@your-laptop:~$ cms pi k3 install agent red05 red05
</code></pre><h2 id=12-uninstall-a-specific-k3s-server>12. Uninstall a specific K3S server</h2><pre><code>you@your-laptop:~$ cms pi k3 uninstall server red05
</code></pre><h2 id=13-uninstall-a-specific-k3s-agent>13. Uninstall a Specific K3S Agent</h2><pre><code>you@your-laptop:~$ cms pi k3 uninstall agent red06
</code></pre><h2 id=14-kill-all-k3s-services-and-containers-on-hosts>14. Kill all K3S Services and Containers on Hosts</h2><p>This command runs the K3s provided <code>k3s-kill-all.sh</code> script that &ldquo;cleans up containers, K3s directories, and networking components while also removing the iptables chain with all the associated rules. The cluster data will not be deleted.&rdquo;</p><pre><code>you@your-laptop:~$ cms pi k3 kill red,red0[1-3]
pi k3 kill red,red0[1-3]
INFO: Stopping k3s services and containers on ['red01', 'red02', 'red03']
+-------+---------+--------+
| host  | success | stdout |
+-------+---------+--------+
| red01 | True    |        |
| red02 | True    |        |
| red03 | True    |        |
+-------+---------+--------+
INFO: Stopping k3s services and containers on red
+------+---------+--------+
| host | success | stdout |
+------+---------+--------+
| red  | True    |        |
+------+---------+--------+
</code></pre><h2 id=15-start-the-k3s-cluster-services>15. Start the K3S Cluster Services</h2><p>This command starts systemd the services <code>k3s</code> for the server and <code>k3s-agent</code>
for
the agents.</p><pre><code>you@your-laptop:~$ cms pi k3 start cluster red,red0[1-3]
pi k3 start cluster red,red0[1-3]
INFO: Starting server on red
+------+---------+--------+
| host | success | stdout |
+------+---------+--------+
| red  | True    |        |
+------+---------+--------+
INFO: Starting agent on ['red', 'red01', 'red02', 'red03']
+-------+---------+--------+
| host  | success | stdout |
+-------+---------+--------+
| red   | True    |        |
| red01 | True    |        |
| red02 | True    |        |
| red03 | True    |        |
+-------+---------+--------+
</code></pre><h2 id=16-stop-the-k3s-cluster-services>16. Stop the K3S Cluster Services</h2><p>This command stops the systemd services <code>k3s</code> for the server and <code>k3s-agent</code>
for
the agents.</p><pre><code>you@your-laptop:~$ cms pi k3 stop cluster red,red0[1-3]
pi k3 stop cluster red,red0[1-3]
INFO: Stopping server on red
+------+---------+--------+
| host | success | stdout |
+------+---------+--------+
| red  | True    |        |
+------+---------+--------+
INFO: Stopping agent on ['red', 'red01', 'red02', 'red03']
+-------+---------+--------+
| host  | success | stdout |
+-------+---------+--------+
| red   | True    |        |
| red01 | True    |        |
| red02 | True    |        |
| red03 | True    |        |
+-------+---------+--------+
</code></pre><h2 id=17-remove-a-node-from-the-cluster>17. Remove a Node from the Cluster</h2><p>Let us remove red01 from the K3s cluster server red.</p><pre><code>you@your-laptop:~$ cms pi k3 remove node red01 red
pi k3 remove node red01 red
INFO: Removing agents red01 from server red
INFO: Draining agent red01
+------+---------+---------------------+
| host | success | stdout              |
+------+---------+---------------------+
| red  | True    | node/red01 cordoned |
|      |         | node/red01 drained  |
+------+---------+---------------------+
INFO: Deleting agents red01
+------+---------+----------------------+
| host | success | stdout               |
+------+---------+----------------------+
| red  | True    | node &quot;red01&quot; deleted |
+------+---------+----------------------+
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-cafd8f57e7d7897f4a142c108548aa1f>5 - Autogenerating Analytics Rest Services</h1><div class=lead>In this section, we will deploy a Pipeline Anova SVM API on an openapi service using cloudmesh-openapi</div><div class="pageinfo pageinfo-primary"><p>On this page, we will deploy a Pipeline Anova SVM onto our openapi server, and subsequently train the model
with data and make predictions from said data. All code needed for this is
provided in the [cloudmesh-openapi](https://github.
com/cloudmesh/cloudmesh-openapi) repository. The code is largely based on
this <a href=https://scikit-learn.org/stable/auto_examples/feature_selection/plot_feature_selection_pipeline.html>sklearn example</a>. It is supported on Raspberry Pi OS, Linux and Mac.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to create autogeneratred analytic services in Python and
deployed with cloudmesh-openapi.</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-overview>1. Overview</a><ul><li><a href=#11-prerequisite>1.1 Prerequisite</a></li><li><a href=#12-effort>1.2 Effort</a></li><li><a href=#13-list-of-topics-covered>1.3 List of Topics Covered</a></li><li><a href=#14-syntax-of-this-tutorial>1.4 Syntax of this Tutorial.</a></li></ul></li><li><a href=#2-creating-a-virtual-environment>2. Creating a virtual environment</a></li><li><a href=#3-the-python-code>3. The Python Code</a></li><li><a href=#4-generating-the-openapi-yaml-file>4. Generating the OpenAPI YAML file</a></li><li><a href=#5-the-openapi-yaml-file-optional>5. The OpenAPI YAML File (optional)</a></li><li><a href=#6-starting-the-server>6. Starting the Server</a></li><li><a href=#7-interacting-with-the-endpoints>7. Interacting With the Endpoints</a><ul><li><a href=#71-uploading-the-dataset>7.1 Uploading the Dataset</a></li><li><a href=#72-training-on-the-dataset>7.2 Training on the Dataset</a></li><li><a href=#73-making-predictions>7.3 Making Predictions</a></li></ul></li><li><a href=#8-clean-up-optional>8. Clean Up (optional)</a></li><li><a href=#9-uninstallation-optional>9. Uninstallation (Optional)</a></li><li><a href=#10-references>10. References</a></li></ul></nav></div></div><h2 id=1-overview>1. Overview</h2><h3 id=11-prerequisite>1.1 Prerequisite</h3><p>It is also assumed that the user has installed and has familiarity with the following:</p><ul><li><code>python3 --version</code> >= 3.8</li><li>Linux Command line</li></ul><h3 id=12-effort>1.2 Effort</h3><ul><li>15 minutes (not including assignment)</li></ul><h3 id=13-list-of-topics-covered>1.3 List of Topics Covered</h3><p>In this module, we focus on the following:</p><ul><li>Training ML models with stateless requests</li><li>Generating RESTful APIs using <code>cms openapi</code> for existing python code</li><li>Deploying openapi definitions onto a localserver</li><li>Interacting with newly created openapi services</li></ul><h3 id=14-syntax-of-this-tutorial>1.4 Syntax of this Tutorial.</h3><p>We describe the syntax for terminal commands used in this tutorial
using the following example:</p><pre><code>(TESTENV) ~ $ echo &quot;hello&quot;
</code></pre><p>Here, we are in the python virtual environment <code>(TESTENV)</code> in the home directory <code>~</code>. The <code>$</code> symbol denotes the beginning of the terminal command (ie. <code>echo "hello"</code>). When copying and pasting commands, do not include <code>$</code> or anything before it.</p><h2 id=2-creating-a-virtual-environment>2. Creating a virtual environment</h2><p>It is best practice to create virtual environments when you do not envision needing a python package consistently. We also want to place all source code in a common directory called cm. Let us set up this create one for this tutorial.</p><p>On clusters created with cloudmesh-burn this virtual environment and <code>cm</code>
directory are already created and enabled by default, so you can skip to the <code>pip</code> installations
further below in this section if you do not want to isolate this in a
separate venv.</p><p>On your Linux/Mac, open a new terminal.</p><pre><code>~ $ python3 -m venv ~/ENV3
</code></pre><p>The above will create a new python virtual environment. Activate it with the following.</p><pre><code>~ $ source ~/ENV3/bin/activate
</code></pre><p>First, we update pip and verify your python and pip are correct</p><pre><code>(ENV3) ~ $ which python
/Users/user/ENV3/bin/python

(ENV3) ~ $ which pip
/Users/user/ENV3/bin/pip

(ENV3) ~ $ pip install -U pip
</code></pre><p>Now we can use <code>cloudmesh-installer</code> to install the code in developer mode. This gives you access to the source code.</p><p>First, create a new directory for the cloudmesh code.</p><pre><code>(ENV3) ~ $ mkdir ~/cm
(ENV3) ~ $ cd ~/cm
</code></pre><p>Next, we install <code>cloudmesh-installer</code> and use it to install cloudmesh openapi.</p><pre><code>(ENV3) ~/cm $ pip install -U pip
(ENV3) ~/cm $ pip install cloudmesh-installer
(ENV3) ~/cm $ cloudmesh-installer get openapi
</code></pre><p>Finally, for this tutorial, we use <code>sklearn</code>. Install the needed packages as follows:</p><pre><code>(ENV3) ~/cm $ pip install sklearn pandas
</code></pre><h2 id=3-the-python-code>3. The Python Code</h2><p>Let&rsquo;s take a look at the python code we would like to make a REST service from. First, let&rsquo;s navigate to the local openapi repository that was installed with <code>cloudmesh-installer</code>.</p><pre><code>(ENV3) ~/cm $ cd cloudmesh-openapi

(ENV3) ~/cm/cloudmesh-openapi $ pwd
/Users/user/cm/cloudmesh-openapi
</code></pre><p>Let us take a look at the PipelineAnova SVM example code. The code can also be viewed <a href=https://github.com/cloudmesh/cloudmesh-openapi/tree/main/tests/Scikitlearn-experimental>here</a></p><p>A
<a href=https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html>Pipeline</a>
is a <em>pipeline</em> of transformations to apply with a final
estimator. Analysis of variance
(<a href=https://en.wikipedia.org/wiki/Analysis_of_variance>ANOVA</a>) is used
for feature selection. A Support vector machine
<a href=https://en.wikipedia.org/wiki/Support_vector_machine>SVM</a> is used as
the actual learning model on the features.</p><p>Use your favorite editor to look at it (whether it be vscode, vim,
nano, etc). We will use emacs</p><pre><code>(ENV3) ~/cm/cloudmesh-openapi $ emacs ./tests/Scikitlearn-experimental/sklearn_svm.py
</code></pre><p>You may also look at the code <a href=https://github.com/cloudmesh/cloudmesh-openapi/blob/main/tests/Scikitlearn-experimental/sklearn_svm.py>here</a></p><p>The class within this file has two main methods to interact with (except for the file upload capability which is added at runtime)</p><pre><code>@classmethod
def train(cls, filename: str) -&gt; str:
    &quot;&quot;&quot;
    Given the filename of an uploaded file, train a PipelineAnovaSVM
    model from the data. Assumption of data is the classifications 
    are in the last column of the data.

    Returns the classification report of the test split
    &quot;&quot;&quot;
    # some code...

@classmethod
def make_prediction(cls, model_name: str, params: str):
    &quot;&quot;&quot;
    Make a prediction based on training configuration
    &quot;&quot;&quot;
    # some code...
</code></pre><p>Note the parameters that each of these methods takes in. These parameters are expected as part of the stateless request for each method.</p><h2 id=4-generating-the-openapi-yaml-file>4. Generating the OpenAPI YAML file</h2><p>Let us now use the python code from above to create the openapi YAML file that we will deploy onto our server. To correctly generate this file, use the following command:</p><pre><code>(ENV3) ~/cm/cloudmesh-openapi $ cms openapi generate PipelineAnovaSVM \
    --filename=./tests/Scikitlearn-experimental/sklearn_svm.py \
    --import_class \
    --enable_upload
</code></pre><p>Let us digest the options we have specified:</p><ul><li><code>--filename</code> indicates the path to the python file in which our code is located</li><li><code>--import_class</code> notifies <code>cms openapi</code> that the YAML file is generated
from a class. The name of this class is specified as <code>PipelineAnovaSVM</code></li><li><code>--enable_upload</code> allows the user to upload files to be stored on the server for reference. This flag causes <code>cms openapi</code> to auto-generate a new python file with the <code>upload</code> method appended to the end of
the file. For this example, you will notice a new file has been added in the same directory as <code>sklearn_svm.py</code>. The file is aptly called: <code>sklearn_svm_upload-enabled.py</code></li></ul><h2 id=5-the-openapi-yaml-file-optional>5. The OpenAPI YAML File (optional)</h2><p>If Section 2 above was correctly, cms will have generated the corresponding openapi YAML file. Let us take a look at it.</p><pre><code>(ENV3) ~/cm/cloudmesh-openapi $ emacs ./tests/Scikitlearn-experimental/sklearn_svm.yaml
</code></pre><p>You may also view the yaml file <a href=https://github.com/cloudmesh/cloudmesh-openapi/blob/main/tests/Scikitlearn-experimental/sklearn_svm.yaml>here</a></p><p>This YAML file has a lot of information to digest. The basic structure is documented <a href=https://swagger.io/docs/specification/basic-structure/>here</a>. However, it is not necessary to understand this information to deploy RESTful APIs.</p><p>However, take a look at <code>paths:</code> on line 9 in this file. Under this section, we have several different endpoints for our API listed. Notice the correlation between the endpoints and the python file we generated from.</p><h2 id=6-starting-the-server>6. Starting the Server</h2><p>Using the YAML file from Section 2, we can now start the server.</p><pre><code>(ENV3) ~/cm/cloudmesh-openapi $ cms openapi server start ./tests/Scikitlearn-experimental/sklearn_svm.yaml
</code></pre><p>The server should now be active. Navigate to <a href=http://localhost:8080/cloudmesh/ui>http://localhost:8080/cloudmesh/ui</a>.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:860px><img class=card-img-top src=/pi/tutorial/analytics-services/featured-cloudmesh_ui_huac9e5fdadbed4fcf4bef1e4e0d4a513a_231401_850x463_fill_catmullrom_smart1_2.png width=850 height=463></div><h2 id=7-interacting-with-the-endpoints>7. Interacting With the Endpoints</h2><h3 id=71-uploading-the-dataset>7.1 Uploading the Dataset</h3><p>We now have a nice user inteface to interact with our newly generated
API. Let us upload the data set. We are going to use the iris data set in this example. We have provided it for you to use. Simply navigate to the <code>/upload</code> endpoint by clicking on it, then click Try it out.</p><p>We can now upload the file. Click on Choose File and upload the data set located at <code>~/cm/cloudmesh-openapi/tests/Scikitlearn-experimental/iris.data</code>. Simply hit Execute after the file is uploaded. We should then get a <code>200</code> return code (telling us that everything went ok).</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:860px><img class=card-img-top src=/pi/tutorial/analytics-services/featured-upload_endpoint_hu66ce280f9c976ef6a9e8cd1ed8de8961_189050_850x463_fill_catmullrom_smart1_2.png width=850 height=463></div><h3 id=72-training-on-the-dataset>7.2 Training on the Dataset</h3><p>The server now has our dataset. Let us now navigate to the <code>/train</code> endpoint by, again, clicking on it. Similarly, click <code>Try it out</code>. The parameter being asked for is the filename. The filename we are interested in is <code>iris.data</code>. Then click execute. We should get another <code>200</code> return code with a Classification Report in the Response Body.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:860px><img class=card-img-top src=/pi/tutorial/analytics-services/featured-train_endpoint_hu2cf29470e85dcf7b95cc8fd032263211_216891_850x463_fill_catmullrom_smart1_2.png width=850 height=463></div><h3 id=73-making-predictions>7.3 Making Predictions</h3><p>We now have a trained model on the iris data set. Let us now use it to make predictions. The model expects 4 attribute values: sepal length, seapl width, petal length, and petal width. Let us use the values <code>5.1, 3.5, 1.4, 0.2</code> as our attributes. The expected classification is <code>Iris-setosa</code>.</p><p>Navigate to the <code>/make_prediction</code> endpoint as we have with other endpoints. Again, let us <code>Try it out</code>. We need to provide the name of the model and the params (attribute values). For the model name, our model is aptly called <code>iris</code> (based on the name of the data set).</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:860px><img class=card-img-top src=/pi/tutorial/analytics-services/featured-make_prediction_endpoint_hue0f7c14ce2c7715a011179c6c4682551_223130_850x463_fill_catmullrom_smart1_2.png width=850 height=463></div><p>As expected, we have a classification of <code>Iris-setosa</code>.</p><h2 id=8-clean-up-optional>8. Clean Up (optional)</h2><p>At this point, we have created and trained a model using <code>cms openapi</code>. After satisfactory use, we can shut down the server. Let us check what we have running.</p><pre><code>(ENV3) ~/cm/cloudmesh-openapi $ cms openapi server ps
openapi server ps

INFO: Running Cloudmesh OpenAPI Servers

+-------------+-------+--------------------------------------------------+
| name        | pid   | spec                                             |
+-------------+-------+--------------------------------------------------+
| sklearn_svm | 94428 | ./tests/Scikitlearn-                             |
|             |       | experimental/sklearn_svm.yaml                    |
+-------------+-------+--------------------------------------------------+
</code></pre><p>We can stop the server with the following command:</p><pre><code>(ENV3) ~/cm/cloudmesh-openapi $ cms openapi server stop sklearn_svm
</code></pre><p>We can verify the server is shut down by running the <code>ps</code> command again.</p><pre><code>(ENV3) ~/cm/cloudmesh-openapi $ cms openapi server ps
openapi server ps

INFO: Running Cloudmesh OpenAPI Servers

None
</code></pre><h2 id=9-uninstallation-optional>9. Uninstallation (Optional)</h2><p>After running this tutorial, you may uninstall all cloudmesh-related things as follows:</p><p>First, deactivate the virtual environment.</p><pre><code>(ENV3) ~/cm/cloudmesh-openapi $ deactivate

~/cm/cloudmesh-openapi $ cd ~
</code></pre><p>Then, we remove the <code>~/cm</code> directory.</p><pre><code>~ $ rm -r -f ~/cm
</code></pre><p>We also remove the cloudmesh hidden files:</p><pre><code>~ $ rm -r -f ~/.cloudmesh
</code></pre><p>Lastly, we delete our virtual environment.</p><pre><code>~ $ rm -r -f ~/ENV3
</code></pre><p>Cloudmesh is now succesfully uninstalled.</p><h2 id=10-references>10. References</h2><ul><li><a href=https://scikit-learn.org>Scikit-learn Web Page</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fc0258a9df9604a3a23d2c40592a4a5c>6 - Burning a set of pre-configured Raspberry OS cards for Raspberry Pis with Wifi Access</h1><div class=lead>A comprehensive tutorial of burning a Raspberry OS cluster with internet access</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/raspberry-burn/featured-image_hu36e8565082faa261af0bfcaa321767f3_2304706_600x300_fill_q75_catmullrom_smart1.jpg width=600 height=300></div><div class="pageinfo pageinfo-primary"><p>In this tutorial, we explain how to easily set up a preconfigured cluster of Pis using RaspberryOS while only burning SD Cards. The cluster is ready to boot after all cards have been burned. No other configuration is needed.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to use cloudmesh-burn to create a RaspberryOS cluster</li><li>Test the cluster after burning</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-pre-requisites>2. Pre-requisites</a></li><li><a href=#3-notation>3. Notation</a></li><li><a href=#4-installing-cloudmesh-and-setup>4. Installing cloudmesh and Setup</a><ul><li><a href=#41-install-from-pip-for-regular-users>4.1 Install from Pip for Regular Users</a></li><li><a href=#42-install-from-source-for-developers>4.2 Install from Source (for Developers)</a></li><li><a href=#43-initializing-the-cms-command>4.3 Initializing the cms Command</a></li><li><a href=#43-create-an-ssh-key>4.3 Create an SSH key</a></li></ul></li><li><a href=#5-burning-the-cluster>5. Burning the Cluster</a></li><li><a href=#6-burn-verification-and-post-process-steps>6. Burn Verification and Post-Process Steps</a><ul><li><a href=#61-setting-up-a-proxy-jump-with-cms-host>6.1 Setting up a Proxy Jump with <code>cms host</code></a></li><li><a href=#62-verifying-manager-and-worker-access>6.2 Verifying Manager and Worker Access</a></li><li><a href=#63-gather-and-scatter-authorized-keys>6.3 Gather and Scatter Authorized Keys</a></li><li><a href=#64-installing-cms-on-a-pi>6.4 Installing <code>cms</code> on a Pi</a></li></ul></li><li><a href=#7-appendix>7. Appendix</a></li><li><a href=#71-writing-our-cluster-configuration>7.1 Writing our cluster configuration</a><ul><li><a href=#72-default-cluster-creation>7.2 Default Cluster Creation</a></li><li><a href=#73-custom-cluster-creation>7.3 Custom Cluster Creation</a></li><li><a href=#74-inspect-the-cluster-configuration>7.4 Inspect the Cluster Configuration</a></li><li><a href=#75-burning-a-custom-cluster>7.5 Burning a Custom Cluster</a></li></ul></li></ul></nav></div></div><h2 id=1-introduction>1. Introduction</h2><p>With the release of <a href=https://www.raspberrypi.org/blog/raspberry-pi-imager-update-to-v1-6/>Pi Imager 1.6</a>, it is possible to configure a Raspberry Pi from any operating system while using RaspberryOS. While pi-imager only uses a limited number of parameters, our system adds network configurations to create a cluster including a simple network configuration. The system works while executing configurations automatically after the first boot.</p><blockquote><p>Note: at this time we have not yet ported our system to Windows, but it is fairly easy to do so. If you like to help, please contact <a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>.</p></blockquote><p>In addition to using RaspberryOS, we also have another tutorial that showcases how to use <a href=https://cloudmesh.github.io/pi/tutorial/ubuntu-burn/>Ubuntu</a>) as the operating system. Our tutorials are useful as typically many steps are involved to set up a cluster. This requires either the replication of time-consuming tasks that can be automated or the knowledge of DevOps frameworks.</p><p>We avoid this by simply burning a card for each of the PIs. No more hours wasted on setting up your initial cluster.</p><p>To facilitate this we developed a special command called <code>cms burn</code>, which allows us to create preconfigured cards with the necessary information. The features this command supports include:</p><ul><li>Setting the hostname,</li><li>Enabling SSH,</li><li>Configuring WiFi,</li><li>Setting the locale,</li><li>Changing the password,</li><li>Adding authorized keys,</li><li>Configuring static IPs for wired ethernet along with routing preferences,</li><li>Configuring a WiFi <em>bridge</em> for a manager Pi to act as a router between the worker PIs and the internet, and</li><li>Automating the configuration on first boot.</li></ul><p>We demonstrate the usage of the <code>cms burn</code> command by creating a cluster of
5 pis (1 manager, 4 workers) where we connect the manager to the internet
via Wifi and configure the workers to access the internet through the manager via
ethernet connection. This is useful for those with restricted internet access where devices must be registered
by MAC Address or through browser login.</p><h2 id=2-pre-requisites>2. Pre-requisites</h2><ul><li>Computer/Laptop with macOS or Linux. (Windows is not supported, but could be easily added with your help. Please contact us if you like to help)</li><li><code>python3 --version</code> > 3.8</li><li>WiFi SSID and password</li><li>5 Raspberry Pis and 5 SD Cards with power cables. (However, you only need
a minimum of 2 is needed, one manager and 1 worker if you do not have 4 Pis)</li><li>5 Ethernet Cables</li><li>An unmanaged ethernet switch</li></ul><p>For parts for different pi cluster configurations, please see lists please see our links on <a href=https://cloudmesh.github.io/pi/docs/hardware/parts/>piplanet.org</a></p><h2 id=3-notation>3. Notation</h2><p>In our tutorial we define the manager hostname to be <code>red</code>, while each
worker has a number in it <code>red01</code>, <code>red02</code>, <code>red03</code>, <code>red04</code></p><p>The following image shows our cluster configuration:</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/raspberry-burn/featured-network_huc4b03e8453bdf7261a9062cdffac07b3_133769_600x300_fill_catmullrom_smart1_2.png width=600 height=300></div><h2 id=4-installing-cloudmesh-and-setup>4. Installing cloudmesh and Setup</h2><p>It is best practice to create virtual environments when you do not envision needing a python package consistently. We also want to
place all source code in a common directory called <code>cm</code>.
Let us set up this create one for this tutorial.</p><p>On your Linux/Mac, open a new terminal.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ python3 -m venv ~/ENV3
</code></pre></div><p>This will create a new python virtual environment. Activate it with the following.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ <span style=color:#204a87>source</span> ~/ENV3/bin/activate
</code></pre></div><p>First, we update pip and verify your <code>python</code> and <code>pip</code> are correct</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install --upgrade pip
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ which python
~/ENV3/bin/python

<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ which pip
~/ENV3/bin/pip
</code></pre></div><h3 id=41-install-from-pip-for-regular-users>4.1 Install from Pip for Regular Users</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install cloudmesh-pi-cluster
</code></pre></div><h3 id=42-install-from-source-for-developers>4.2 Install from Source (for Developers)</h3><p>If you are a developer that likes to add new features we recommend our source set up. We start after you have created the virtual env with the install of our convenient <code>cloudmesh-installer</code> and creating a directory called <code>cm</code> in which we download the sources</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install cloudmesh-installer
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ mkdir ~/cm
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ <span style=color:#204a87>cd</span> ~/cm
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cloudmesh-installer get pi
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ls
</code></pre></div><p>This directory will now contain all source code. It will also have the needed installed <code>cms</code> command.</p><h3 id=43-initializing-the-cms-command>4.3 Initializing the cms Command</h3><p>It is very important to initialize the cms command and test if it is properly installed. You do this simply with the command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms <span style=color:#204a87>help</span>
</code></pre></div><p>You will see a list of subcommands that are part of the cms if your installation succeeded.</p><h3 id=43-create-an-ssh-key>4.3 Create an SSH key</h3><p>It is important that we can easily access the manager and worker nodes from the laptop/desktop. Hence we create a keypair in <code>~/.ssh</code>. You can create one as follows by accepting the default location in <code>~/.ssh/id_rsa</code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh-keygen
</code></pre></div><p>Please use a unique and strong passphrase. We will use this default key to access our cluster after burning.</p><h2 id=5-burning-the-cluster>5. Burning the Cluster</h2><p>We are now ready to burn our cluster. Start by making sure you have the latest desired images to burn:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn image versions --refresh  
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn image get latest-lite
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn image get latest-full
</code></pre></div><p>Next, plug in your first SD Card into your card writer. Check your writer&rsquo;s path with the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn info
<span style=color:#8f5902;font-style:italic># ----------------------------------------------------------------------</span>
<span style=color:#8f5902;font-style:italic># SD Cards Found</span>
<span style=color:#8f5902;font-style:italic># ----------------------------------------------------------------------</span>

+----------+------------------------+-------------+------------------+--------------+------------+---------+----------+-------------+-------------+
<span style=color:#000;font-weight:700>|</span> Path     <span style=color:#000;font-weight:700>|</span> Info                   <span style=color:#000;font-weight:700>|</span> Formatted   <span style=color:#000;font-weight:700>|</span> Size             <span style=color:#000;font-weight:700>|</span> Plugged-in   <span style=color:#000;font-weight:700>|</span> Readable   <span style=color:#000;font-weight:700>|</span> Empty   <span style=color:#000;font-weight:700>|</span> Access   <span style=color:#000;font-weight:700>|</span> Removable   <span style=color:#000;font-weight:700>|</span> Writeable   <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>----------+------------------------+-------------+------------------+--------------+------------+---------+----------+-------------+-------------<span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> /dev/sdb <span style=color:#000;font-weight:700>|</span> Generic STORAGE DEVICE <span style=color:#000;font-weight:700>|</span> True        <span style=color:#000;font-weight:700>|</span> 64.1 GB/59.7 GiB <span style=color:#000;font-weight:700>|</span> True         <span style=color:#000;font-weight:700>|</span> True       <span style=color:#000;font-weight:700>|</span> False   <span style=color:#000;font-weight:700>|</span> True     <span style=color:#000;font-weight:700>|</span> True        <span style=color:#000;font-weight:700>|</span> True        <span style=color:#000;font-weight:700>|</span>
+----------+------------------------+-------------+------------------+--------------+------------+---------+----------+-------------+-------------+
</code></pre></div><p>Record the path for the SDCard. In this case, it is <code>/dev/sdb</code></p><blockquote><p>Note we omit some output of <code>cms burn info</code> for clarity.
On MacOS, you may get an <code>ERROR: We could not find your USB reader in the list of known readers</code>. This can be ignored. Additionally, <code>cms burn info</code> will list the partitions as well. For example, if you see the path <code>/dev/disk2s1</code> and <code>/dev/disk2s2</code>, then your device is <code>/dev/disk2</code>.</p></blockquote><p>This command will autodetect the SSID, locale, and country of your laptop.
We recommend not to use the password flags for the <code>wifipassword</code> and sudo
password as they will be stored in the command history and logs. When not
supplied as command line arguments, they will be asked for interactively.
The wifi setup will only be enabled on the manager (red). To burn the latest
32 bit OS use the following command. Otherwise, look at our subsequent note
for instructions to burn the latest 64 bit OS.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn raspberry <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> --device<span style=color:#ce5c00;font-weight:700>=</span>/dev/sdb -f
</code></pre></div><blockquote><p>Note: the <code>-f</code> flag instructs <code>cms burn</code> to build a default cloudmesh
inventory for the names provided. To see the contents of this file you
can use the command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cms inventory list --inventory<span style=color:#ce5c00;font-weight:700>=</span>inventory-red.yaml
</code></pre></div></blockquote><blockquote><p>Note: if you want to burn the <strong>64 bit OS</strong> use the following series of commands
instead.This creates a default cluster configuration, and then changes the OS tag
latest-lite-64.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cms inventory add cluster <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span>
cms inventory <span style=color:#204a87>set</span> <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> tag to latest-lite-64 --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
cms burn raspberry <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> --device<span style=color:#ce5c00;font-weight:700>=</span>/dev/sdb --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span> 
</code></pre></div></blockquote><p>After each card is burned, <code>cms burn raspberry</code> will prompt you to swap the SD card to burn the next host.</p><p>After all the cards have been burned, we can now plug them in our raspberry pis and boot. Ensure
that your workers and manager are connected to the same network switch via the ethernet cables. Ensure this network
switch does not have internet access in itself, e.g. do not connect the switch to the internet router. We will use the manager as the sole point of internet access here. This we do deliberately to be able to disconnect all nodes from the network via the Master in case this is needed.</p><h2 id=6-burn-verification-and-post-process-steps>6. Burn Verification and Post-Process Steps</h2><p>After you boot, we recommend waiting 2-3 minutes for the boot process to complete.</p><h3 id=61-setting-up-a-proxy-jump-with-cms-host>6.1 Setting up a Proxy Jump with <code>cms host</code></h3><p>While we are waiting for the Pis to boot, we can set up proxy jump on our laptop/desktop while adding it to the ssh config file. This will make it easier to access our workers. Use the following command to set this up:</p><pre><code>(ENV3) you@yourlaptop $ cms host config proxy pi@red.local &quot;red0[1-4]&quot;
</code></pre><p>It will do the appropriate modifications.</p><h3 id=62-verifying-manager-and-worker-access>6.2 Verifying Manager and Worker Access</h3><p>First verify that you can reach the manager (red).</p><pre><code>(ENV3) you@yourlaptop $ ssh red
...
pi@red:~ $ exit
</code></pre><blockquote><p>Note: If this does not work, it is likely that the wifi configuration was
incorrect, or there is an RF block on the Pi that could not be removed due
to an unknown locale of the burning machine. 2.4GHz wifi is more likely to
work without explicit country configuration than 5 GHz bands.</p></blockquote><p>We can use a simple <code>cms</code> command to verify connection to our Pis. For this purpose, we use our build in temperature command that reads the temperature values from each of the Pis.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms pi temp <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span>
pi temp red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span>
+--------+--------+-------+----------------------------+
<span style=color:#000;font-weight:700>|</span> host   <span style=color:#000;font-weight:700>|</span>    cpu <span style=color:#000;font-weight:700>|</span>   gpu <span style=color:#000;font-weight:700>|</span> date                       <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>--------+--------+-------+----------------------------<span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red    <span style=color:#000;font-weight:700>|</span> 47.712 <span style=color:#000;font-weight:700>|</span>  47.2 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:56.674668 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01  <span style=color:#000;font-weight:700>|</span> 37.485 <span style=color:#000;font-weight:700>|</span>  37.4 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.333300 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02  <span style=color:#000;font-weight:700>|</span> 38.946 <span style=color:#000;font-weight:700>|</span>  38.9 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.303389 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03  <span style=color:#000;font-weight:700>|</span> 38.946 <span style=color:#000;font-weight:700>|</span>  39.4 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.440690 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04  <span style=color:#000;font-weight:700>|</span> 38.936 <span style=color:#000;font-weight:700>|</span>  39.4 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.550690 <span style=color:#000;font-weight:700>|</span>
+--------+--------+-------+----------------------------+
</code></pre></div><p>By receiving this information from our devices we have confirmed our access.</p><h3 id=63-gather-and-scatter-authorized-keys>6.3 Gather and Scatter Authorized Keys</h3><p>Each of the nodes only has our laptop&rsquo;s ssh-key in its respective <code>authorized_keys</code> file. We can use the <code>cms</code> command to gather all keys in our cluster and then distribute them so that each node can ssh into each other.</p><p>We first create ssh-keys for all the nodes in our cluster.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key create <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span>
host key create red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span>
+-------+---------+--------------------------------------------------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> success <span style=color:#000;font-weight:700>|</span> stdout                                           <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------------------------------------------------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC99RR79UTQ <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> JznOPRN/FI6MqNsZ5Eirqs7JXA4UYfnMx8LVaD/ZcI6Sajr0 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 2nw2ucec8OMxtdzPrpWX5B+Hxz3GZWNKCbh2yHhMDIrf/Ohn <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> QGJrBx1mtAbqy4gd7qljEsL0FummdYmPdtHFBy7t2zkVp0J1 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> V5YiLEbbrmX9RXQF1bJvHb4VNOOcwq47qX9h561q8qBxgQLz <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> F3iHmrMxmL8oma1RFVgZmjhnKMoXF+t13uZrf2R5/hVO4K6T <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> +PENSnjW7OX6aiIT8Ty1ga74FhXr9F5t14cofpN6QwuF2SqM <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> CgpVGfRSGMrLI/2pefszU2b5eeICWYePdopkslML+f+n     <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> pi@red                                           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDRN/rGGF+e <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> dZ9S2IWX4P26F7T2H+nsbw7CfeJ6df9oX/npYuM9BPDzcEP7 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> +2jNIZtZVehJj5zHiodjAspCxjg+mByQZye1jioa3MBmgO3j <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> VwxCOPA7x0Wc2Dm9/QOg1kMMMlnNT2NHs+SeQMDXoUkpaLCQ <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 108VQxaTclJ67USC1e/9B7OtjhsVm5kGA7Eamyd5PgtANT7G <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> jHERXSnGzFnbqqsZEBvCLWLSbaSq3adWR1bVvDblu11nyitE <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> x7YKZA9RK0A7rTBzrZa70SfG65dSbpqQFxmQYSrgiwVSBokk <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 0vvk5l7NhBDrrrxWYWd9dm/SrDrInjcuDsCsjOVuccx7     <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> pi@red01                                         <span style=color:#000;font-weight:700>|</span>
... <span style=color:#8f5902;font-style:italic># Ommitted some output for brevity</span>
+-------+---------+--------------------------------------------------+
</code></pre></div><p>We can subsequently gather these keys into a file.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key gather <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> ~/.ssh/cluster_red_keys
</code></pre></div><p>And then Scatter them to the <code>authorized_keys</code> of our nodes.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key scatter <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> ~/.ssh/cluster_red_keys
host key scatter red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span> /Users/richie/.ssh/cluster_red_keys
+-------+---------+--------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> success <span style=color:#000;font-weight:700>|</span> stdout <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------+
</code></pre></div><p>All nodes should now have <code>ssh</code> access to each other.</p><h3 id=64-installing-cms-on-a-pi>6.4 Installing <code>cms</code> on a Pi</h3><p>Some cloudmesh commands offered can be very useful on the Pis. You can install <code>cms</code> on all Pis in this fashion, but
we will only demonstrate this for the manager pi.</p><p>For the production version pleas use</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh red
pi@red $ curl -Ls http://cloudmesh.github.io/get/pi <span style=color:#000;font-weight:700>|</span> sh -
</code></pre></div><p>However, to get the newest development version please use</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh red
pi@red $ curl -Ls https://raw.githubusercontent.com/cloudmesh/get/main/pi/index.html <span style=color:#000;font-weight:700>|</span> sh -
</code></pre></div><p>This will not only install <code>cms</code>, but will also upgrade your system, install the dependencies for <code>cms</code>, and create a
virtual environment. Because a system upgrade takes place, this command may take several minutes to run.</p><p>After a reboot, we can verify the success of the script with the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> pi@red $ cms <span style=color:#204a87>help</span>
<span style=color:#204a87>help</span>

Documented commands <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87>type</span> <span style=color:#204a87>help</span> &lt;topic&gt;<span style=color:#ce5c00;font-weight:700>)</span>:
<span style=color:#ce5c00;font-weight:700>========================================</span>
EOF     check     default  <span style=color:#204a87>help</span>       pause     quit   start      <span style=color:#204a87>test</span>
admin   clear     diagram  host       pi        <span style=color:#204a87>set</span>    stop       var
banner  commands  dryrun   info       provider  shell  stopwatch  version
bridge  config    <span style=color:#204a87>echo</span>     inventory  py        sleep  sys
burn    debug     gui      man        q         ssh    term
</code></pre></div><h2 id=7-appendix>7. Appendix</h2><h2 id=71-writing-our-cluster-configuration>7.1 Writing our cluster configuration</h2><p>Cloudmesh has a simple system for managing cluster configurations as an inventory.
We do this management for you, but you can control it also from the command line.
We can first add a manager with cluster subnet IP <code>10.1.1.1</code>. We also add the <code>bridge</code> service which is
recognized by <code>cms</code> as the Wifi bridge service connecting devices on eth0 to the internet.
We also set the timezone and locale here. You may want to change them as you wish.</p><h3 id=72-default-cluster-creation>7.2 Default Cluster Creation</h3><p>As we want to make the cluster very easy to create we demonstrated in
Section 5 how to create a default cluster directly from the burn command.
As a future feature, this behavior will also be implemented into the inventory
command. To make a default inventory named inventory-red.yaml:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory add cluster <span style=color:#4e9a06>&#34;red,red[01-04]&#34;</span>
</code></pre></div><p>This command will find your current WiFi SSID, your current locale and set up a simple network as depicted in Figure 1 on your cluster. In case you have more or fewer nodes, the command will make appropriate updates.</p><h3 id=73-custom-cluster-creation>7.3 Custom Cluster Creation</h3><p>For a custom cluster, you can inspect the parameters of the inventory command. Here are the commands to use for the previous setup while writing them out. You can modify the parameters to your liking:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory add red --service<span style=color:#ce5c00;font-weight:700>=</span>manager --ip<span style=color:#ce5c00;font-weight:700>=</span>10.1.1.1 --tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;latest-lite&#34;</span> --timezone<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;America/Indiana/Indianapolis&#34;</span> --locale<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;us&#34;</span> --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
you@yourlaptop $ cms inventory <span style=color:#204a87>set</span> red services to <span style=color:#4e9a06>&#34;bridge,wifi&#34;</span> --listvalue --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><p>We can then add the workers</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory add <span style=color:#4e9a06>&#34;red0[1-4]&#34;</span> --service<span style=color:#ce5c00;font-weight:700>=</span>worker --ip<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;10.1.1.[2-5]&#34;</span> --router<span style=color:#ce5c00;font-weight:700>=</span>10.1.1.1 --tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;latest-lite&#34;</span>  --timezone<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;America/Indiana/Indianapolis&#34;</span> --locale<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;us&#34;</span> --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
you@yourlaptop $ cms inventory <span style=color:#204a87>set</span> <span style=color:#4e9a06>&#34;red0[1-4]&#34;</span> dns to <span style=color:#4e9a06>&#34;8.8.8.8,8.8.4.4&#34;</span> --listvalue --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><blockquote><p>Note we are using Google&rsquo;s DNS here [8.8.8.8, 8.8.4.4]</p></blockquote><h3 id=74-inspect-the-cluster-configuration>7.4 Inspect the Cluster Configuration</h3><p>Our cluster configuration is now complete. You may run the following to list your configuration. We include ours for a sanity check:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory list --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
+-------+-------------+---------+---------+--------------------+----------+------------------------+----------+--------+------------------------------+--------+---------+-------------+-------------------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> tag         <span style=color:#000;font-weight:700>|</span> cluster <span style=color:#000;font-weight:700>|</span> service <span style=color:#000;font-weight:700>|</span> services           <span style=color:#000;font-weight:700>|</span> ip       <span style=color:#000;font-weight:700>|</span> dns                    <span style=color:#000;font-weight:700>|</span> router   <span style=color:#000;font-weight:700>|</span> locale <span style=color:#000;font-weight:700>|</span> timezone                     <span style=color:#000;font-weight:700>|</span> owners <span style=color:#000;font-weight:700>|</span> comment <span style=color:#000;font-weight:700>|</span> description <span style=color:#000;font-weight:700>|</span> keyfile           <span style=color:#000;font-weight:700>|</span>
+-------+-------------+---------+---------+--------------------+----------+------------------------+----------+--------+------------------------------+--------+---------+-------------+-------------------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> manager <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;bridge&#39;</span>, <span style=color:#4e9a06>&#39;wifi&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span>                        <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.2 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02 <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.3 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03 <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.4 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04 <span style=color:#000;font-weight:700>|</span> latest-lite <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.5 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
+-------+-------------+---------+---------+--------------------+----------+------------------------+----------+--------+------------------------------+--------+---------+-------------+-------------------+
</code></pre></div><h3 id=75-burning-a-custom-cluster>7.5 Burning a Custom Cluster</h3><p>You can now specify your inventory as you burn your cluster or specific
machines from the cluster with the burn command. All hosts data found in the
inventory will be written to the machines, regardless if they are in the
burn command or not.</p><p>Burn the whole cluster.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn raspberry <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> --device<span style=color:#ce5c00;font-weight:700>=</span>/dev/sdb 
--inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><p>Burn a specific machine.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn raspberry <span style=color:#4e9a06>&#34;red03&#34;</span> --device<span style=color:#ce5c00;font-weight:700>=</span>/dev/sdb --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2b1e5335b32ab7dc6a177dabd7edc467>7 - Burning a set of Ubuntu Server Cards for Raspberry Pis with Internet Access</h1><div class=lead>A comprehensive tutorial of burning an Ubuntu cluster with internet access</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/ubuntu-burn/featured-image_hub225d8e28e0c8cb78ba75e0b37fb6163_234635_600x300_fill_catmullrom_smart1_2.png width=600 height=300></div><div class="pageinfo pageinfo-primary"><p>In this tutorial, we explain how to easily set up a cluster of Pis with pre-configured Ubuntu cards
initialized with custom cloud-init configurations.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to use cloudmesh-burn to create an ubuntu cluster</li><li>Test the cluster after burning</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-pre-requisites>2. Pre-requisites</a></li><li><a href=#3-notation>3. Notation</a></li><li><a href=#4-installing-cloudmesh-and-setup>4. Installing cloudmesh and Setup</a><ul><li><a href=#41-install-from-pip-for-regular-users>4.1 Install from Pip for Regular Users</a></li><li><a href=#42-install-from-source-for-developers>4.2 Install from Source (for Developers)</a></li><li><a href=#43-initializing-the-cms-command>4.3 Initializing the cms Command</a></li><li><a href=#43-create-an-ssh-key>4.3 Create an SSH key</a></li></ul></li><li><a href=#5-burning-the-cluster>5. Burning the Cluster</a></li><li><a href=#6-burn-verification-and-post-process-steps>6. Burn Verification and Post-Process Steps</a><ul><li><a href=#61-setting-up-a-proxy-jump-with-cms-host>6.1 Setting up a Proxy Jump with <code>cms host</code></a></li><li><a href=#62-verifying-manager-and-worker-access>6.2 Verifying Manager and Worker Access</a></li><li><a href=#63-gather-and-scatter-authorized-keys>6.3 Gather and Scatter Authorized Keys</a></li><li><a href=#64-installing-cms-on-a-pi>6.4 Installing <code>cms</code> on a Pi</a></li></ul></li><li><a href=#7-appendix>7. Appendix</a></li><li><a href=#71-writing-our-cluster-configuration>7.1 Writing our cluster configuration</a><ul><li><a href=#72-default-cluster-creation>7.2 Default Cluster Creation</a></li><li><a href=#73-custom-cluster-creation>7.3 Custom Cluster Creation</a></li><li><a href=#74-inspect-the-cluster-configuration>7.4 Inspect the Cluster Configuration</a></li><li><a href=#75-burning-a-custom-cluster>7.5 Burning a Custom Cluster</a></li></ul></li></ul></nav></div></div><h2 id=1-introduction>1. Introduction</h2><p>Cloud-init provides powerful tools for configuring an Ubuntu Server. It allows users to configure network
information, add authorized keys, run commands on boot, and other useful tasks to set up the operating system. While cloud-init is a very
powerful tool, it requires knowledge to use it properly and therefore has a high learning curve when it comes to cluster-specific tasks such as using user data and network configurations
to get a cluster operational.</p><p>For this reason, we provide a simple set of commands to not only burn SD Cards with ubuntu server but to augment them with configurations for cloud-init
to set up a cluster correctly.</p><p>In this tutorial, we will burn a cluster of Raspberry Pis with Ubuntu Server per a user-friendly configuration.
This cluster will have wifi access from the manager, and the manager will act as a router for the workers (in that all
internet traffic is routed through the manager). This type of setup is useful for those with restricted internet access
(no access to modem), especially those that are required to register the MAC addresses of their devices. With a cluster
of 10 or more nodes, this can be quite tedious to do.</p><h2 id=2-pre-requisites>2. Pre-requisites</h2><ul><li>Computer/Laptop with MacOS or Linux. (Windows not supported yet)</li><li><code>python3 --version</code> > 3.8</li><li>5 Raspberry Pis and 5 SD Cards with power cables</li><li>WiFi SSID and Password</li><li>5 Ethernet Cables</li><li>An (un)managed ethernet switch</li></ul><h2 id=3-notation>3. Notation</h2><p>In our tutorial we define the manager hostname to be <code>red</code>, while each
worker has a number in it <code>red01</code>, <code>red02</code>, <code>red03</code>, <code>red04</code></p><p>The following image shows our cluster configuration:</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/ubuntu-burn/featured-network_huc4b03e8453bdf7261a9062cdffac07b3_133769_600x300_fill_catmullrom_smart1_2.png width=600 height=300></div><h2 id=4-installing-cloudmesh-and-setup>4. Installing cloudmesh and Setup</h2><p>It is best practice to create virtual environments when you do not envision needing a python package consistently. We also want to
place all source code in a common directory called <code>cm</code>.
Let us set up this create one for this tutorial.</p><p>On your Linux/Mac, open a new terminal.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ python3 -m venv ~/ENV3
</code></pre></div><p>The above will create a new python virtual environment. Activate it with the following.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ <span style=color:#204a87>source</span> ~/ENV3/bin/activate
</code></pre></div><p>First, we update pip and verify your <code>python</code> and <code>pip</code> are correct</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install --upgrade pip
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ which python
~/ENV3/bin/python

<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ which pip
~/ENV3/bin/pip
</code></pre></div><h3 id=41-install-from-pip-for-regular-users>4.1 Install from Pip for Regular Users</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install cloudmesh-pi-cluster
</code></pre></div><h3 id=42-install-from-source-for-developers>4.2 Install from Source (for Developers)</h3><p>If you are a developer that likes to add new features we recommend our source set up. We start after you have created the virtual env with the install of our convenient <code>cloudmesh-installer</code> and creating a directory called <code>cm</code> in which we download the sources</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install cloudmesh-installer
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ mkdir ~/cm
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ <span style=color:#204a87>cd</span> ~/cm
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cloudmesh-installer get pi
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ls
</code></pre></div><p>This directory will now contain all source code. It will also have the needed installed <code>cms</code> command.</p><h3 id=43-initializing-the-cms-command>4.3 Initializing the cms Command</h3><p>It is very important to initialize the cms command and test if it is properly installed. You do this simply with the command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms <span style=color:#204a87>help</span>
</code></pre></div><p>You will see a list of subcommands that are part of the cms if your installation succeeded.</p><h3 id=43-create-an-ssh-key>4.3 Create an SSH key</h3><p>It is important that we can easily access the manager and worker nodes from the laptop/desktop. Hence we create a keypair in <code>~/.ssh</code>. You can create one as follows by accepting the default location in <code>~/.ssh/id_rsa</code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh-keygen
</code></pre></div><p>Please use a unique and strong passphrase. We will use this default key to access our cluster after burning.</p><h2 id=5-burning-the-cluster>5. Burning the Cluster</h2><p>We are now ready to burn our cluster. Start by plugging in your first SD Card into your card writer. Check your writer&rsquo;s path with the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn info
<span style=color:#8f5902;font-style:italic># ----------------------------------------------------------------------</span>
<span style=color:#8f5902;font-style:italic># SD Cards Found</span>
<span style=color:#8f5902;font-style:italic># ----------------------------------------------------------------------</span>

+----------+------------------------+-------------+------------------+--------------+------------+---------+----------+-------------+-------------+
<span style=color:#000;font-weight:700>|</span> Path     <span style=color:#000;font-weight:700>|</span> Info                   <span style=color:#000;font-weight:700>|</span> Formatted   <span style=color:#000;font-weight:700>|</span> Size             <span style=color:#000;font-weight:700>|</span> Plugged-in   <span style=color:#000;font-weight:700>|</span> Readable   <span style=color:#000;font-weight:700>|</span> Empty   <span style=color:#000;font-weight:700>|</span> Access   <span style=color:#000;font-weight:700>|</span> Removable   <span style=color:#000;font-weight:700>|</span> Writeable   <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>----------+------------------------+-------------+------------------+--------------+------------+---------+----------+-------------+-------------<span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> /dev/sdb <span style=color:#000;font-weight:700>|</span> Generic STORAGE DEVICE <span style=color:#000;font-weight:700>|</span> True        <span style=color:#000;font-weight:700>|</span> 64.1 GB/59.7 GiB <span style=color:#000;font-weight:700>|</span> True         <span style=color:#000;font-weight:700>|</span> True       <span style=color:#000;font-weight:700>|</span> False   <span style=color:#000;font-weight:700>|</span> True     <span style=color:#000;font-weight:700>|</span> True        <span style=color:#000;font-weight:700>|</span> True        <span style=color:#000;font-weight:700>|</span>
+----------+------------------------+-------------+------------------+--------------+------------+---------+----------+-------------+-------------+
</code></pre></div><p>Record the path for the SDCard. In this case, it is <code>/dev/sdb</code></p><blockquote><p>Note we omit some output of <code>cms burn info</code> for clarity.
On MacOS, you may get an <code>ERROR: We could not find your USB reader in the list of known readers</code>. This can be ignored. Additionally, <code>cms burn info</code> will list the partitions as well. For example, if you see the path <code>/dev/disk2s1</code> and <code>/dev/disk2s2</code>, then your device is <code>/dev/disk2</code>.</p></blockquote><p>This command will autodetect the SSID, locale, and country of your laptop.
We recommend not to use the password flags for the <code>wifipassword</code> and sudo
password as they will be stored in the command history and logs. When not
supplied as command line arguments, they will be asked for interactively.
The wifi setup will only be enabled on the manager (red).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn ubuntu <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> --device<span style=color:#ce5c00;font-weight:700>=</span>/dev/sdb -f
</code></pre></div><blockquote><p>Note the <code>-f</code> flag instructs <code>cms burn</code> to build a default cloudmesh
inventory for the names provided. To see the contents of this file you
can use the command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cms inventory list --inventory<span style=color:#ce5c00;font-weight:700>=</span>inventory-red.yaml
</code></pre></div></blockquote><p>After each card is burned, <code>cms burn ubuntu</code> will prompt you to swap the SD
card to burn the next host.</p><p>After all the cards have been burned, we can now plug them in our raspberry pis and boot. Ensure
that your workers and manager are connected to the same network switch via the ethernet cables. Ensure this network
switch does not have internet access in itself, e.g. do not connect the switch to the internet router. We will use the manager as the sole point of internet access here. This we do deliberately to be able to disconnect all nodes from the network via the Master in case this is needed.</p><h2 id=6-burn-verification-and-post-process-steps>6. Burn Verification and Post-Process Steps</h2><p>After you boot, we recommend waiting 2-3 minutes for the boot process to complete.</p><h3 id=61-setting-up-a-proxy-jump-with-cms-host>6.1 Setting up a Proxy Jump with <code>cms host</code></h3><p>While we are waiting for the Pis to boot, we can set up proxy jump on our laptop/desktop while adding it to the ssh config file. This will make it easier to access our workers. Use the following command to set this up:</p><pre><code>(ENV3) you@yourlaptop $ cms host config proxy ubuntu@red.local &quot;red0[1-4]&quot;
</code></pre><p>It will do the appropriate modifications.</p><h3 id=62-verifying-manager-and-worker-access>6.2 Verifying Manager and Worker Access</h3><p>First verify that you can reach the manager (red).</p><pre><code>(ENV3) you@yourlaptop $ ssh red
...
pi@red:~ $ exit
</code></pre><blockquote><p>Note: If this does not work, it is likely that the wifi configuration was
incorrect, or there is an RF block on the Pi that could not be removed due
to an unknown locale of the burning machine. 2.4GHz wifi is more likely to
work without explicit country configuration than 5 GHz bands.</p></blockquote><p>We can use a simple <code>cms</code> commands to verify connection to our Pis. First we
reboot the cluster to activate the libraspberrypi-bin tools that were
installed on the first boot.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host reboot <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> 
host reboot red,rede0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span>
INFO: Executing <span style=color:#4e9a06>`</span>sudo reboot<span style=color:#4e9a06>`</span> <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;red01&#39;</span>, <span style=color:#4e9a06>&#39;red02&#39;</span>, <span style=color:#4e9a06>&#39;red03&#39;</span>, <span style=color:#4e9a06>&#39;red04&#39;</span><span style=color:#ce5c00;font-weight:700>]</span>
INFO: Executing <span style=color:#4e9a06>`</span>sudo reboot<span style=color:#4e9a06>`</span> <span style=color:#204a87;font-weight:700>for</span> red
</code></pre></div><p>Wait for the reboot to complete. Then we use our built in temperature command
that reads the temperature values from each of the Pis.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms pi temp <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span>
pi temp red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span>
+--------+--------+-------+----------------------------+
<span style=color:#000;font-weight:700>|</span> host   <span style=color:#000;font-weight:700>|</span>    cpu <span style=color:#000;font-weight:700>|</span>   gpu <span style=color:#000;font-weight:700>|</span> date                       <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>--------+--------+-------+----------------------------<span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red    <span style=color:#000;font-weight:700>|</span> 47.712 <span style=color:#000;font-weight:700>|</span>  47.2 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:56.674668 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01  <span style=color:#000;font-weight:700>|</span> 37.485 <span style=color:#000;font-weight:700>|</span>  37.4 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.333300 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02  <span style=color:#000;font-weight:700>|</span> 38.946 <span style=color:#000;font-weight:700>|</span>  38.9 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.303389 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03  <span style=color:#000;font-weight:700>|</span> 38.946 <span style=color:#000;font-weight:700>|</span>  39.4 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.440690 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04  <span style=color:#000;font-weight:700>|</span> 38.936 <span style=color:#000;font-weight:700>|</span>  39.4 <span style=color:#000;font-weight:700>|</span> 2021-03-27 19:52:57.550690 <span style=color:#000;font-weight:700>|</span>
+--------+--------+-------+----------------------------+
</code></pre></div><p>By receiving this information from our devices we have confirmed our access.</p><h3 id=63-gather-and-scatter-authorized-keys>6.3 Gather and Scatter Authorized Keys</h3><p>Each of the nodes only has our laptop&rsquo;s ssh-key in its respective <code>authorized_keys</code> file. We can use the <code>cms</code> command to gather all keys in our cluster and then distribute them so that each node can ssh into each other.</p><p>We first create ssh-keys for all the nodes in our cluster.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key create <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span>
host key create red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span>
+-------+---------+--------------------------------------------------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> success <span style=color:#000;font-weight:700>|</span> stdout                                           <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------------------------------------------------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC99RR79UTQ <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> JznOPRN/FI6MqNsZ5Eirqs7JXA4UYfnMx8LVaD/ZcI6Sajr0 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 2nw2ucec8OMxtdzPrpWX5B+Hxz3GZWNKCbh2yHhMDIrf/Ohn <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> QGJrBx1mtAbqy4gd7qljEsL0FummdYmPdtHFBy7t2zkVp0J1 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> V5YiLEbbrmX9RXQF1bJvHb4VNOOcwq47qX9h561q8qBxgQLz <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> F3iHmrMxmL8oma1RFVgZmjhnKMoXF+t13uZrf2R5/hVO4K6T <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> +PENSnjW7OX6aiIT8Ty1ga74FhXr9F5t14cofpN6QwuF2SqM <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> CgpVGfRSGMrLI/2pefszU2b5eeICWYePdopkslML+f+n     <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> ubuntu@red                                       <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDRN/rGGF+e <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> dZ9S2IWX4P26F7T2H+nsbw7CfeJ6df9oX/npYuM9BPDzcEP7 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> +2jNIZtZVehJj5zHiodjAspCxjg+mByQZye1jioa3MBmgO3j <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> VwxCOPA7x0Wc2Dm9/QOg1kMMMlnNT2NHs+SeQMDXoUkpaLCQ <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 108VQxaTclJ67USC1e/9B7OtjhsVm5kGA7Eamyd5PgtANT7G <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> jHERXSnGzFnbqqsZEBvCLWLSbaSq3adWR1bVvDblu11nyitE <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> x7YKZA9RK0A7rTBzrZa70SfG65dSbpqQFxmQYSrgiwVSBokk <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 0vvk5l7NhBDrrrxWYWd9dm/SrDrInjcuDsCsjOVuccx7     <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> ubuntu@red01                                     <span style=color:#000;font-weight:700>|</span>
... <span style=color:#8f5902;font-style:italic># Ommitted some output for brevity</span>
+-------+---------+--------------------------------------------------+
</code></pre></div><p>We can subsequently gather these keys into a file.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key gather <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> ~/.ssh/cluster_red_keys
</code></pre></div><p>And then Scatter them to the <code>authorized_keys</code> of our nodes.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key scatter <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> ~/.ssh/cluster_red_keys
host key scatter red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span> /Users/richie/.ssh/cluster_red_keys
+-------+---------+--------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> success <span style=color:#000;font-weight:700>|</span> stdout <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------+
</code></pre></div><p>All nodes should now have <code>ssh</code> access to each other.</p><h3 id=64-installing-cms-on-a-pi>6.4 Installing <code>cms</code> on a Pi</h3><p>Some cloudmesh commands offered can be very useful on the Pis. You can install <code>cms</code> on all Pis in this fashion, but
we will only demonstrate this for the manager pi.</p><p>For the production version pleas use</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh red
pi@red $ curl -Ls http://cloudmesh.github.io/get/pi <span style=color:#000;font-weight:700>|</span> sh -
</code></pre></div><p>However, to get the newest development version please use</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh red
pi@red $ curl -Ls https://raw.githubusercontent.com/cloudmesh/get/main/pi/index.html <span style=color:#000;font-weight:700>|</span> sh -
</code></pre></div><p>This will not only install <code>cms</code>, but will also upgrade your system, install the dependencies for <code>cms</code>, and create a
virtual environment. Because a system upgrade takes place, this command may take several minutes to run.</p><p>After a reboot, we can verify the success of the script with the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> pi@red $ cms <span style=color:#204a87>help</span>
<span style=color:#204a87>help</span>

Documented commands <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87>type</span> <span style=color:#204a87>help</span> &lt;topic&gt;<span style=color:#ce5c00;font-weight:700>)</span>:
<span style=color:#ce5c00;font-weight:700>========================================</span>
EOF     check     default  <span style=color:#204a87>help</span>       pause     quit   start      <span style=color:#204a87>test</span>
admin   clear     diagram  host       pi        <span style=color:#204a87>set</span>    stop       var
banner  commands  dryrun   info       provider  shell  stopwatch  version
bridge  config    <span style=color:#204a87>echo</span>     inventory  py        sleep  sys
burn    debug     gui      man        q         ssh    term
</code></pre></div><h2 id=7-appendix>7. Appendix</h2><h2 id=71-writing-our-cluster-configuration>7.1 Writing our cluster configuration</h2><p>Cloudmesh has a simple system for managing cluster configurations as an inventory.
We do this management for you, but you can control it also from the command line.
We can first add a manager with cluster subnet IP <code>10.1.1.1</code>. We also add the <code>bridge</code> service which is
recognized by <code>cms</code> as the Wifi bridge service connecting devices on eth0 to the internet.
We also set the timezone and locale here. You may want to change them as you wish.</p><h3 id=72-default-cluster-creation>7.2 Default Cluster Creation</h3><p>As we want to make the cluster very easy to create we demonstrated in
Section 5 how to create a default cluster directly from the burn command.
As a future feature, this behavior will also be implemented into the inventory
command. To make a default inventory named inventory-red.yaml:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory add cluster <span style=color:#4e9a06>&#34;red,red[01-04]&#34;</span>
</code></pre></div><p>This command will find your current WiFi SSID, your current locale and set up a simple network as depicted in Figure 1 on your cluster. In case you have more or fewer nodes, the command will make appropriate updates.</p><h3 id=73-custom-cluster-creation>7.3 Custom Cluster Creation</h3><p>For a custom cluster, you can inspect the parameters of the inventory command. Here are the commands to use for the previous setup while writing them out. You can modify the parameters to your liking:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory add red --service<span style=color:#ce5c00;font-weight:700>=</span>manager --ip<span style=color:#ce5c00;font-weight:700>=</span>10.1.1.1 --tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;ubuntu-20.10-64-bit&#34;</span> --timezone<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;America/Indiana/Indianapolis&#34;</span> --locale<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;us&#34;</span> --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
you@yourlaptop $ cms inventory <span style=color:#204a87>set</span> red services to <span style=color:#4e9a06>&#34;bridge,wifi&#34;</span> --listvalue --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><p>We can then add the workers</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory add <span style=color:#4e9a06>&#34;red0[1-4]&#34;</span> --service<span style=color:#ce5c00;font-weight:700>=</span>worker --ip<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;10.1.1.[2-5]&#34;</span> --router<span style=color:#ce5c00;font-weight:700>=</span>10.1.1.1 --tag<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;ubuntu-20.10-64-bit&#34;</span>  --timezone<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;America/Indiana/Indianapolis&#34;</span> --locale<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;us&#34;</span> --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
you@yourlaptop $ cms inventory <span style=color:#204a87>set</span> <span style=color:#4e9a06>&#34;red0[1-4]&#34;</span> dns to <span style=color:#4e9a06>&#34;8.8.8.8,8.8.4.4&#34;</span> --listvalue --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><blockquote><p>Note we are using Google&rsquo;s DNS here [8.8.8.8, 8.8.4.4]</p></blockquote><h3 id=74-inspect-the-cluster-configuration>7.4 Inspect the Cluster Configuration</h3><p>Our cluster configuration is now complete. You may run the following to list your configuration. We include ours for a sanity check:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ cms inventory list --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
+-------+---------------------+---------+---------+--------------------+----------+------------------------+----------+--------+------------------------------+--------+---------+-------------+-------------------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> tag                 <span style=color:#000;font-weight:700>|</span> cluster <span style=color:#000;font-weight:700>|</span> service <span style=color:#000;font-weight:700>|</span> services           <span style=color:#000;font-weight:700>|</span> ip       <span style=color:#000;font-weight:700>|</span> dns                    <span style=color:#000;font-weight:700>|</span> router   <span style=color:#000;font-weight:700>|</span> locale <span style=color:#000;font-weight:700>|</span> timezone                     <span style=color:#000;font-weight:700>|</span> owners <span style=color:#000;font-weight:700>|</span> comment <span style=color:#000;font-weight:700>|</span> description <span style=color:#000;font-weight:700>|</span> keyfile           <span style=color:#000;font-weight:700>|</span>
+-------+---------------------+---------+---------+--------------------+----------+------------------------+----------+--------+------------------------------+--------+---------+-------------+-------------------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> ubuntu-20.10-64-bit <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> manager <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;bridge&#39;</span>, <span style=color:#4e9a06>&#39;wifi&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span>                        <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> ubuntu-20.10-64-bit <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.2 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02 <span style=color:#000;font-weight:700>|</span> ubuntu-20.10-64-bit <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.3 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03 <span style=color:#000;font-weight:700>|</span> ubuntu-20.10-64-bit <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.4 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04 <span style=color:#000;font-weight:700>|</span> ubuntu-20.10-64-bit <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> worker  <span style=color:#000;font-weight:700>|</span>                    <span style=color:#000;font-weight:700>|</span> 10.1.1.5 <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;8.8.8.8&#39;</span>, <span style=color:#4e9a06>&#39;8.8.4.4&#39;</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>|</span> 10.1.1.1 <span style=color:#000;font-weight:700>|</span> us     <span style=color:#000;font-weight:700>|</span> America/Indiana/Indianapolis <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span> ~/.ssh/id_rsa.pub <span style=color:#000;font-weight:700>|</span>
+-------+---------------------+---------+---------+--------------------+----------+------------------------+----------+--------+------------------------------+--------+---------+-------------+-------------------+

</code></pre></div><h3 id=75-burning-a-custom-cluster>7.5 Burning a Custom Cluster</h3><p>You can now specify your inventory as you burn your cluster or specific
machines from the cluster with the burn command. All hosts data found in the
inventory will be written to the machines, regardless if they are in the
burn command or not.</p><p>Burn the whole cluster.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn ubuntu <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> --device<span style=color:#ce5c00;font-weight:700>=</span>/dev/sdb --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div><p>Burn a specific machine.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms burn ubuntu <span style=color:#4e9a06>&#34;red03&#34;</span> --device<span style=color:#ce5c00;font-weight:700>=</span>/dev/sdb --inventory<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;inventory-red.yaml&#34;</span>
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-9e7cb422383e60f88931f7c943382971>8 - Burning a set of pre-configured SD cards with a GUI for Raspberry Pis with Wifi Access</h1><div class=lead>A GUI tutorial of burning a cluster with internet access</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-complete_hu773914d20ddd47a9ff8e281e292d1047_29276_600x300_fill_catmullrom_smart1_2.png width=600 height=300></div><div class="pageinfo pageinfo-primary"><p>In this tutorial, we explain how to easily set up a preconfigured cluster of
Pis using RaspberryOS or Ubuntu while only burning SD Cards. The cluster is
ready to boot after all cards have been burned. No other configuration is needed.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to use cloudmesh-burn to create a cluster using Cloudmesh Burn GUI</li><li>Test the cluster after burning</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-pre-requisites>2. Pre-requisites</a></li><li><a href=#3-notation>3. Notation</a></li><li><a href=#4-installing-cloudmesh-and-setup>4. Installing cloudmesh and Setup</a><ul><li><a href=#41-install-from-pip-for-regular-users>4.1 Install from Pip for Regular Users</a></li><li><a href=#42-install-from-source-for-developers>4.2 Install from Source (for Developers)</a></li><li><a href=#43-initializing-the-cms-command>4.3 Initializing the cms Command</a></li><li><a href=#43-create-an-ssh-key>4.3 Create an SSH key</a></li></ul></li><li><a href=#5-burning-the-cluster>5. Burning the Cluster</a></li><li><a href=#6-burn-verification-and-post-process-steps>6. Burn Verification and Post-Process Steps</a><ul><li><a href=#61-setting-up-a-proxy-jump-with-cms-host>6.1 Setting up a Proxy Jump with <code>cms host</code></a></li><li><a href=#62-verifying-manager-and-worker-access>6.2 Verifying Manager and Worker Access</a></li><li><a href=#63-gather-and-scatter-authorized-keys>6.3 Gather and Scatter Authorized Keys</a></li></ul></li><li><a href=#installing-cms-on-a-pi>Installing <code>cms</code> on a Pi</a></li></ul></nav></div></div><h2 id=1-introduction>1. Introduction</h2><p>With the release of <a href=https://www.raspberrypi.org/blog/raspberry-pi-imager-update-to-v1-6/>Pi Imager 1.6</a>, it is possible to configure a
Raspberry Pi from any operating system while using RaspberryOS. While
pi-imager only uses a limited number of parameters, our system supports
both RaspberryOS and Ubunty, and adds network configurations to create a
cluster with a simple network configuration. The system works while executing
configurations automatically after the first boot.</p><blockquote><p>Note: at this time we have not yet ported our system to Windows, but it is fairly easy to do so. If you like to help, please contact <a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>.</p></blockquote><p>In addition to using the GUI, we have additional command line
tutorials for <a href=https://cloudmesh.github.io/pi/tutorial/raspberry-burn/>RaspberryOS</a>,
and <a href=https://cloudmesh.github.io/pi/tutorial/ubuntu-burn/>Ubuntu</a> that
provide additional flexibility. Our tutorials are useful as typically many
steps are involved to set up a cluster. This requires either the replication of time-consuming tasks that can be automated or the knowledge of DevOps frameworks.</p><p>We avoid this by simply burning a card for each of the PIs. No more hours wasted on setting up your initial cluster.</p><p>To facilitate this we developed a special command called <code>cms burn gui</code>, which
allows us to create preconfigured cards with the necessary information. The features this command supports include:</p><ul><li>Setting the hostname,</li><li>Enabling SSH,</li><li>Configuring WiFi,</li><li>Setting the locale,</li><li>Adding authorized keys,</li><li>Configuring static IPs for wired ethernet along with routing preferences,</li><li>Configuring a WiFi <em>bridge</em> for a manager Pi to act as a router between the worker PIs and the internet, and</li><li>Automating the configuration on first boot.</li></ul><p>We demonstrate the usage of the <code>cms burn gui</code> command by creating a cluster of
4 pis (1 manager, 3 workers) where we
connect the manager to the internet via Wifi and configure the workers to access the internet through the manager via
ethernet connection. This is useful for those with restricted internet access where devices must be registered
by MAC Address or through browser login.</p><h2 id=2-pre-requisites>2. Pre-requisites</h2><ul><li>Computer/Laptop with macOS or Linux. (Windows is not supported, but could be easily added with your help. Please contact us if you like to help)</li><li><code>python3 --version</code> > 3.8</li><li>WiFi SSID and password</li><li>5 Raspberry Pis and 5 SD Cards with power cables. (However, you only need
a minimum of 2 is needed, one manager and 1 worker if you do not have 5 Pis)</li><li>5 Ethernet Cables</li><li>An unmanaged ethernet switch</li></ul><p>For parts for different pi cluster configurations, please see lists please see our links on <a href=https://cloudmesh.github.io/pi/docs/hardware/parts/>piplanet.org</a></p><h2 id=3-notation>3. Notation</h2><p>In our tutorial we define the manager hostname to be <code>red</code>, while each
worker has a number in it <code>red01</code>, <code>red02</code>, <code>red03</code>, <code>red04</code></p><p>The following image shows our cluster configuration:</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-cluster_huc4b03e8453bdf7261a9062cdffac07b3_133769_600x300_fit_catmullrom_2.png width=600 height=293></div><h2 id=4-installing-cloudmesh-and-setup>4. Installing cloudmesh and Setup</h2><p>It is best practice to create virtual environments when you do not envision needing a python package consistently. We also want to
place all source code in a common directory called <code>cm</code>.
Let us set up this create one for this tutorial.</p><p>On your Linux/Mac, open a new terminal.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ python3 -m venv ~/ENV3
</code></pre></div><p>The above will create a new python virtual environment. Activate it with the following.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>you@yourlaptop $ <span style=color:#204a87>source</span> ~/ENV3/bin/activate
</code></pre></div><p>First, we update pip and verify your <code>python</code> and <code>pip</code> are correct</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install --upgrade pip
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ which python
~/ENV3/bin/python

<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ which pip
~/ENV3/bin/pip
</code></pre></div><h3 id=41-install-from-pip-for-regular-users>4.1 Install from Pip for Regular Users</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install cloudmesh-pi-cluster
</code></pre></div><h3 id=42-install-from-source-for-developers>4.2 Install from Source (for Developers)</h3><p>If you are a developer that likes to add new features we recommend our source set up. We start after you have created the virtual env with the install of our convenient <code>cloudmesh-installer</code> and creating a directory called <code>cm</code> in which we download the sources</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ pip install cloudmesh-installer
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ mkdir ~/cm
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ <span style=color:#204a87>cd</span> ~/cm
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cloudmesh-installer get pi
<span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ls
</code></pre></div><p>This directory will now contain all source code. It will also have the needed installed <code>cms</code> command.</p><h3 id=43-initializing-the-cms-command>4.3 Initializing the cms Command</h3><p>It is very important to initialize the cms command and test if it is properly installed. You do this simply with the command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms <span style=color:#204a87>help</span>
</code></pre></div><p>You will see a list of subcommands that are part of the cms if your installation succeeded.</p><h3 id=43-create-an-ssh-key>4.3 Create an SSH key</h3><p>It is important that we can easily access the manager and worker nodes from the laptop/desktop. Hence we create a keypair in <code>~/.ssh</code>. You can create one as follows by accepting the default location in <code>~/.ssh/id_rsa</code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh-keygen
</code></pre></div><p>Please use a unique and strong passphrase. We will use this default key to access our cluster after burning.</p><h2 id=5-burning-the-cluster>5. Burning the Cluster</h2><p>We are now ready to burn our cluster. Start by plugging in your first SD
Card into your card writer. Then run the following command, where the
&ndash;hostname includes the names of the devices to be burned. You will be asked
to input your <code>sudo</code> password which is needed to burn the sd cards. After
entering the password a simple GUI will appear.</p><pre><code>(ENV3) you@yourlaptop $ cms burn gui --hostname=red,red0[1-4]
# ----------------------------------------------------------------------
#  _____                               _                
# |  __ \                             | |               
# | |__) |_ _ _ __ __ _ _ __ ___   ___| |_ ___ _ __ ___ 
# |  ___/ _` | '__/ _` | '_ ` _ \ / _ \ __/ _ \ '__/ __|
# | |  | (_| | | | (_| | | | | | |  __/ ||  __/ |  \__ \
# |_|   \__,_|_|  \__,_|_| |_| |_|\___|\__\___|_|  |___/
#                                                       
#                                                       
# ----------------------------------------------------------------------

Manager:       red
Workers:       ['red01', 'red02', 'red03', 'red04']
IPS:           ['10.1.1.1', '10.1.1.2', '10.1.1.3', '10.1.1.4', '10.1.1.5']
Key:           /home/anthony/.ssh/id_rsa.pub
Dryrun:        False
sudo password: 
</code></pre><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:300px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-launch_huc77a96aa8843cf0cc3bc931879827ab8_83693_600x300_fit_catmullrom_2.png width=290 height=300></div><p>Ensure the appropriate device is selected so you do not accidentally burn to
the wrong storage device. It is best to only have one attached storage
device to prevent mistakes.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-device_hubac9c1c5b012d67fd32c0abd229c31a0_2722_600x300_fit_catmullrom_2.png width=600 height=45></div><p>Next, select the OS that you would like to burn to the SD cards.
Selecting the radio button will automatically update the image field for
each machine. RaspberryOS supports two tags, latest-full (a desktop environment
that takes more storage space) and latest-lite (smaller image with no desktop).
Ubuntu only has one tag per distribution type.</p><blockquote><p>If you want to further customize your image selction, you can input any
tag from <code>cms burn image versions --refresh</code>.</p></blockquote><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:484px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-os_hu3af6e7577483e21a4da8ea3a0ca9cd9b_46161_600x300_fit_catmullrom_2.png width=474 height=300></div><p>Next, verify the path to the SSH key that will be written to all hosts
authorized_keys file. Verify the SSID (this will be prepopulated with your
machines current wifi network if one exists), and enter the wifi password.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-security_hu88b8831e01ae22784a4f31ca21396fd5_9233_600x300_fit_catmullrom_2.png width=600 height=84></div><p>We are now ready to burn.</p><blockquote><p>Note: you can further customize image tags and IP addresses.</p></blockquote><p>Burn the manager device by pressing the <code>Burn</code> button next to the machine <code>red</code>.
In the command line prompt you will see the inventory created for the
cluster, the underlying burn command, OS image download progress, and finally
you will be asked to verify that the sd card is inserted.</p><pre><code># ----------------------------------------------------------------------
#  _____                      _                 _ _             
# |  __ \                    | |               | (_)            
# | |  | | _____      ___ __ | | ___   __ _  __| |_ _ __   __ _ 
# | |  | |/ _ \ \ /\ / / '_ \| |/ _ \ / _` |/ _` | | '_ \ / _` |
# | |__| | (_) \ V  V /| | | | | (_) | (_| | (_| | | | | | (_| |
# |_____/ \___/ \_/\_/ |_| |_|_|\___/ \__,_|\__,_|_|_| |_|\__, |
#                                                          __/ |
#                                                         |___/ 
#  _____                                 
# |_   _|                                
#   | |  _ __ ___   __ _  __ _  ___  ___ 
#   | | | '_ ` _ \ / _` |/ _` |/ _ \/ __|
#  _| |_| | | | | | (_| | (_| |  __/\__ \
# |_____|_| |_| |_|\__,_|\__, |\___||___/
#                         __/ |          
#                        |___/           
# ----------------------------------------------------------------------

INFO: Attempting to download latest-lite
Downloading 2021-03-04-raspios-buster-armhf-lite.zip

...

INFO: Verifying sha1
INFO: Verifying sha256
SHA1 is ok
SHA256 is ok
Extracting 2021-03-04-raspios-buster-armhf-lite.img
INFO: Attempting to download latest-full
Downloading 2021-03-04-raspios-buster-armhf-full.zip

...

INFO: Verifying sha1
INFO: Verifying sha256
SHA1 is ok
SHA256 is ok
Extracting 2021-03-04-raspios-buster-armhf-full.img
Is the card to be burned for red inserted? (Y/n) y
</code></pre><p>The <code>Burn</code> button will turn grey while the burn is in progress.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-inprogress_huf07e96dc7f8b86f62842becb56d702f2_4299_600x300_fit_catmullrom_2.png width=600 height=36></div><p>And the <code>Burn</code> button will turn green once the burn has completed. It is
best to check the command line output to verify there were no unhandled
errors. If an error occurred, you can first try to re-burn before further
troubleshooting.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-done_hufe215b68cfa4ff628597baf63f543b9e_5816_600x300_fit_catmullrom_2.png width=600 height=50></div><p>Continue to burn the workers 1 by 1, remembering to answer the &ldquo;card
inserted?&rdquo; prompt on the commandline, until you have completed burning all SD
cards.</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-complete_hu773914d20ddd47a9ff8e281e292d1047_29276_600x300_fit_catmullrom_2.png width=600 height=199></div><blockquote><p>Note: You can view a network diagram and rack diagram on the respective tabs.</p></blockquote><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-network_hu11a10c1a2287231b67fc7633ec856134_17090_600x300_fit_catmullrom_2.png width=600 height=287></div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:205px><img class=card-img-top src=/pi/tutorial/gui-burn/featured-gui-rack_hu200f8c24302308ef18431eab135cd9fd_7002_600x300_fit_catmullrom_2.png width=195 height=300></div><p>Now, plug in the SD cards and boot the cluster.</p><h2 id=6-burn-verification-and-post-process-steps>6. Burn Verification and Post-Process Steps</h2><p>After you boot, we recommend waiting 2-3 minutes for the boot process to complete.</p><h3 id=61-setting-up-a-proxy-jump-with-cms-host>6.1 Setting up a Proxy Jump with <code>cms host</code></h3><p>While we are waiting for the Pis to boot, we can set up proxy jump on our laptop/desktop while adding it to the ssh config file. This will make it easier to access our workers. Use the following command to set this up:</p><pre><code>(ENV3) you@yourlaptop $ cms host config proxy pi@red.local &quot;red0[1-4]&quot;
</code></pre><p>It will do the appropriate modifications.</p><h3 id=62-verifying-manager-and-worker-access>6.2 Verifying Manager and Worker Access</h3><p>First verify that you can reach the manager (red).</p><pre><code>(ENV3) you@yourlaptop $ ssh red
...
pi@red:~ $ exit
</code></pre><blockquote><p>Note: If this does not work, it is likely that the wifi configuration was
incorrect, or there is an RF block on the Pi that could not be removed due
to an unknown locale of the burning machine. 2.4GHz wifi is more likely to
work without explicit country configuration than 5 GHz bands.</p></blockquote><p>Now we can use a simple <code>cms</code> command to verify connection to our Pis. For this
purpose, we use our build in temperature command that reads the temperature values from each of the Pis.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms pi temp <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span>
pi temp red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-4<span style=color:#ce5c00;font-weight:700>]</span>
+--------+--------+-------+----------------------------+
<span style=color:#000;font-weight:700>|</span> host   <span style=color:#000;font-weight:700>|</span>    cpu <span style=color:#000;font-weight:700>|</span>   gpu <span style=color:#000;font-weight:700>|</span> date                       <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>--------+--------+-------+----------------------------<span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red    <span style=color:#000;font-weight:700>|</span> 52.095 <span style=color:#000;font-weight:700>|</span>  52.5 <span style=color:#000;font-weight:700>|</span> 2021-03-29 16:24:29.375779 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01  <span style=color:#000;font-weight:700>|</span> 51.608 <span style=color:#000;font-weight:700>|</span>  51.6 <span style=color:#000;font-weight:700>|</span> 2021-03-29 16:24:29.775136 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02  <span style=color:#000;font-weight:700>|</span> 54.53  <span style=color:#000;font-weight:700>|</span>  54.5 <span style=color:#000;font-weight:700>|</span> 2021-03-29 16:24:29.735953 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03  <span style=color:#000;font-weight:700>|</span> 55.504 <span style=color:#000;font-weight:700>|</span>  55.5 <span style=color:#000;font-weight:700>|</span> 2021-03-29 16:24:30.375218 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04  <span style=color:#000;font-weight:700>|</span> 50.147 <span style=color:#000;font-weight:700>|</span>  50.6 <span style=color:#000;font-weight:700>|</span> 2021-03-29 16:24:30.949371 <span style=color:#000;font-weight:700>|</span>
+--------+--------+-------+----------------------------+
</code></pre></div><p>By receiving this information from our devices we have confirmed our access.</p><h3 id=63-gather-and-scatter-authorized-keys>6.3 Gather and Scatter Authorized Keys</h3><p>Each of the nodes only has our laptop&rsquo;s ssh-key in its respective <code>authorized_keys</code> file. We can use the <code>cms</code> command to gather all keys in our cluster and then distribute them so that each node can ssh into each other.</p><p>We first create ssh-keys for all the nodes in our cluster.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key create <span style=color:#4e9a06>&#34;red,red0[1-3]&#34;</span>
host key create red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-3<span style=color:#ce5c00;font-weight:700>]</span>
+-------+---------+--------------------------------------------------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> success <span style=color:#000;font-weight:700>|</span> stdout                                           <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------------------------------------------------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC99RR79UTQ <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> JznOPRN/FI6MqNsZ5Eirqs7JXA4UYfnMx8LVaD/ZcI6Sajr0 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 2nw2ucec8OMxtdzPrpWX5B+Hxz3GZWNKCbh2yHhMDIrf/Ohn <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> QGJrBx1mtAbqy4gd7qljEsL0FummdYmPdtHFBy7t2zkVp0J1 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> V5YiLEbbrmX9RXQF1bJvHb4VNOOcwq47qX9h561q8qBxgQLz <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> F3iHmrMxmL8oma1RFVgZmjhnKMoXF+t13uZrf2R5/hVO4K6T <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> +PENSnjW7OX6aiIT8Ty1ga74FhXr9F5t14cofpN6QwuF2SqM <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> CgpVGfRSGMrLI/2pefszU2b5eeICWYePdopkslML+f+n     <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> pi@red                                           <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDRN/rGGF+e <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> dZ9S2IWX4P26F7T2H+nsbw7CfeJ6df9oX/npYuM9BPDzcEP7 <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> +2jNIZtZVehJj5zHiodjAspCxjg+mByQZye1jioa3MBmgO3j <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> VwxCOPA7x0Wc2Dm9/QOg1kMMMlnNT2NHs+SeQMDXoUkpaLCQ <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 108VQxaTclJ67USC1e/9B7OtjhsVm5kGA7Eamyd5PgtANT7G <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> jHERXSnGzFnbqqsZEBvCLWLSbaSq3adWR1bVvDblu11nyitE <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> x7YKZA9RK0A7rTBzrZa70SfG65dSbpqQFxmQYSrgiwVSBokk <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> 0vvk5l7NhBDrrrxWYWd9dm/SrDrInjcuDsCsjOVuccx7     <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span>         <span style=color:#000;font-weight:700>|</span> pi@red01                                         <span style=color:#000;font-weight:700>|</span>
... <span style=color:#8f5902;font-style:italic># Ommitted some output for brevity</span>
+-------+---------+--------------------------------------------------+
</code></pre></div><p>We can subsequently gather these keys into a file.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key gather <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> ~/.
ssh/cluster_red_keys
</code></pre></div><p>And then Scatter them to the <code>authorized_keys</code> of our nodes.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ cms host key scatter <span style=color:#4e9a06>&#34;red,red0[1-4]&#34;</span> ~/.
sss/cluster_red_keys
host key scatter red,red0<span style=color:#ce5c00;font-weight:700>[</span>1-3<span style=color:#ce5c00;font-weight:700>]</span> /Users/richie/.ssh/cluster_red_keys
+-------+---------+--------+
<span style=color:#000;font-weight:700>|</span> host  <span style=color:#000;font-weight:700>|</span> success <span style=color:#000;font-weight:700>|</span> stdout <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------+
<span style=color:#000;font-weight:700>|</span> red   <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red01 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red02 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red03 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> red04 <span style=color:#000;font-weight:700>|</span> True    <span style=color:#000;font-weight:700>|</span>        <span style=color:#000;font-weight:700>|</span>
+-------+---------+--------+
</code></pre></div><p>All nodes should now have <code>ssh</code> access to each other.</p><h2 id=installing-cms-on-a-pi>Installing <code>cms</code> on a Pi</h2><p>Some cloudmesh commands offered can be very useful on the Pis. You can install <code>cms</code> on all Pis in this fashion, but
we will only demonstrate this for the manager pi.</p><p>For the production version pleas use</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh red
pi@red $ curl -Ls curl -Ls http://cloudmesh.github.io/get/pi <span style=color:#000;font-weight:700>|</span> sh -
</code></pre></div><p>However, to get the newest development version please use</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> you@yourlaptop $ ssh red
pi@red $ curl -Ls https://raw.githubusercontent.com/cloudmesh/get/main/pi/index.html <span style=color:#000;font-weight:700>|</span> sh -
</code></pre></div><p>This will not only install <code>cms</code>, but will also upgrade your system, install the dependencies for <code>cms</code>, and create a
virtual environment. Because a system upgrade takes place, this command may take several minutes to run.</p><p>After a reboot, we can verify the success of the script with the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ce5c00;font-weight:700>(</span>ENV3<span style=color:#ce5c00;font-weight:700>)</span> pi@red $ cms <span style=color:#204a87>help</span>
<span style=color:#204a87>help</span>

Documented commands <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87>type</span> <span style=color:#204a87>help</span> &lt;topic&gt;<span style=color:#ce5c00;font-weight:700>)</span>:
<span style=color:#ce5c00;font-weight:700>========================================</span>
EOF     check     default  <span style=color:#204a87>help</span>       pause     quit   start      <span style=color:#204a87>test</span>
admin   clear     diagram  host       pi        <span style=color:#204a87>set</span>    stop       var
banner  commands  dryrun   info       provider  shell  stopwatch  version
bridge  config    <span style=color:#204a87>echo</span>     inventory  py        sleep  sys
burn    debug     gui      man        q         ssh    term
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-03cb49c826ef4fa4c93d74e1dbc53e48>9 - GitHub gh Command Line Interface</h1><div class=lead>A brief tutorial on the installation and usage of the GitHub gh CLI</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/gh-command/featured-image_hua13b09a952d27db01b9dc61a71d8a1d4_269789_600x300_fill_catmullrom_smart1_2.png width=600 height=300><div class="card-body px-0 pt-2 pb-0"><p class=card-text></p></div></div><p>Figure 1: GitHub Command gh.</p><div class="pageinfo pageinfo-primary"><p>GitHub provides an extended gh commandline tool that allow easy interaction of
forking repositories directly from github. IT also provides additional fimctionality
to interact with other advanced features that are typically not provided in the git command tool.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to install the gh command</li><li>Learn how to use the gh command</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-installing-github-gh-command>2. Installing GitHub gh command</a></li><li><a href=#3-logging-in-with-github-gh-command>3. Logging in with GitHub gh Command</a><ul><li><a href=#31-adding-additional-keys>3.1 Adding Additional Keys</a></li></ul></li><li><a href=#4-forking>4. Forking</a></li><li><a href=#5-pull-requests>5. Pull Requests</a></li><li><a href=#6-managing-issues-with-github-gh-command>6. Managing Issues with GitHub gh Command</a></li><li><a href=#7-manual-pages>7. Manual Pages</a><ul><li><a href=#71-gh>7.1 gh</a></li><li><a href=#72-list-of-man-pages>7.2 List of Man Pages</a></li></ul></li><li><a href=#7-conclusion>7. Conclusion</a></li></ul></nav></div></div><h2 id=1-introduction>1. Introduction</h2><p>The new GitHub <code>gh</code> command allows GitHub users to work from the terminal of
their machine without having to visit the web browser GUI to manage things like
issues, PRs, and forking. We will show you what features it provides and how to
use it. The <code>gh</code> command provides useful features that is not provided by the `git
commandline tool.</p><h2 id=2-installing-github-gh-command>2. Installing GitHub gh command</h2><p>Visit the GitHub CLI homepage at <a href=https://cli.github.com/>https://cli.github.com/</a> for installation
instructions. We recommend that you check out the source distribution because
We found that whne we did this tutorial not all features were included in the
brew instalation. We assume ths will cahnge over time and you may soon be able
to just use the bre install on LInux and MacOs.</p><p>On mac, you can use the following command with
<a href=https://brew.sh/>Brew</a>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>brew install gh
</code></pre></div><p>For Windows useser, please follow the install instructions fro Winodws.</p><h2 id=3-logging-in-with-github-gh-command>3. Logging in with GitHub gh Command</h2><p>It is best practice to be using SSH-keys with GitHub. Create one if you have
not already with the following command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh-keygen
</code></pre></div><p>We recommend t use the the default location.</p><p>To authenticate with the GitHub <code>gh</code> comamand, run the following command. We have included
the answers to the interactive prompts used for this guide.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh auth login

What account <span style=color:#204a87;font-weight:700>do</span> you want to log into? GitHub.com
? What account <span style=color:#204a87;font-weight:700>do</span> you want to log into? GitHub.com
? What is your preferred protocol <span style=color:#204a87;font-weight:700>for</span> Git operations? SSH
? Upload your SSH public key to your GitHub account? ~/.ssh/id_rsa.pub
? How would you like to authenticate GitHub CLI? Login with a web browser

! First copy your one-time code: 1234-1A11
- Press Enter to open github.com in your browser...
</code></pre></div><h3 id=31-adding-additional-keys>3.1 Adding Additional Keys</h3><p>IN acse you work with multiple computers it is advisable to add your keys from these
machines also. We demonstarte the interaction to upload the key from a new machine.</p><pre><code>newmachine$ gh ssh-key add ~/.ssh/id_rsa.pub 
Error: insufficient OAuth scopes to list SSH keys
Run the following to grant scopes: gh auth refresh -s write:public_key
newmachine$ gh auth refresh -s write:public_key

! First copy your one-time code: 4C2D-E896
- Press Enter to open github.com in your browser... 
✓ Authentication complete. Press Enter to continue...

newmachine$ gh ssh-key add ~/.ssh/id_rsa.pub   
✓ Public key added to your account
</code></pre><h2 id=4-forking>4. Forking</h2><p>We can easily create a fork of a repo with the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh repo fork
</code></pre></div><p>This is useful for when you do not have write access to the original repository.</p><h2 id=5-pull-requests>5. Pull Requests</h2><p>We can create a pull request easily as follows from a git repo:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh pr create
</code></pre></div><p>The command above will ask the user where to push the branch (if it does not
already exist on the remote). It will also offer the option to fork the initial
repository. You will want to do this if you do not have write access to the
original repo.</p><p>Once created, you may view the status of the PR with the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh pr status
</code></pre></div><p>Reviewers can checkout your pull request to verify changes as follows:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh pr checkout <span style=color:#ce5c00;font-weight:700>{</span>PR NUMBER<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>The reviewer can then approve the PR as follows:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh pr review --approve
</code></pre></div><p>Subsequently, the PR can be merged as follows:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh pr merge <span style=color:#ce5c00;font-weight:700>{</span>PR NUMBER<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>You may also list all pull requests with the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh pr list
</code></pre></div><p>Finally, PRs can be closed with</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh pr close <span style=color:#ce5c00;font-weight:700>{</span>PR NUMBER<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><h2 id=6-managing-issues-with-github-gh-command>6. Managing Issues with GitHub gh Command</h2><p>To create an issue, call the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh issue create --title<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Bug 1&#34;</span> --body<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;description&#34;</span>
</code></pre></div><p>We can also check the status of issues relevant to use with:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh issue status
</code></pre></div><p>Alternatively, we may list all open issues.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh issue list
</code></pre></div><p>Finally, we may close issues with:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gh issue close <span style=color:#ce5c00;font-weight:700>{</span>ISSUE NUMBER<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><h2 id=7-manual-pages>7. Manual Pages</h2><h3 id=71-gh>7.1 gh</h3><pre><code>gh(1)                                                                    gh(1)

NAME
       gh - GitHub CLI

SYNOPSIS
       gh   [flags]

DESCRIPTION
       Work seamlessly with GitHub from the command line.

OPTIONS
       --help[=false]      Show help for command

       --version[=false]      Show gh version

EXAMPLE
              $ gh issue create
              $ gh repo clone cli/cli
              $ gh pr checkout 321

SEE ALSO
       gh-alias(1),  gh-api(1),  gh-auth(1),  gh-completion(1),  gh-config(1),
       gh-gist(1),   gh-issue(1),   gh-pr(1),    gh-release(1),    gh-repo(1),
       gh-secret(1), gh-ssh-key(1)
</code></pre><h3 id=72-list-of-man-pages>7.2 List of Man Pages</h3><p>Tha manual pages are published at the <a href=https://cli.github.com/manual/>gh manual</a>.
For mor information you can also use the man command. A full list of manual pages includes:</p><ul><li>gh</li><li>gh-alias-delete</li><li>gh-alias-list</li><li>gh-alias-set</li><li>gh-alias</li><li>gh-api</li><li>gh-auth-login</li><li>gh-auth-logout</li><li>gh-auth-refresh</li><li>gh-auth-status</li><li>gh-auth</li><li>gh-completion</li><li>gh-config-get</li><li>gh-config-set</li><li>gh-config</li><li>gh-gist-clone</li><li>gh-gist-create</li><li>gh-gist-delete</li><li>gh-gist-edit</li><li>gh-gist-list</li><li>gh-gist-view</li><li>gh-gist</li><li>gh-issue-close</li><li>gh-issue-comment</li><li>gh-issue-create</li><li>gh-issue-delete</li><li>gh-issue-edit</li><li>gh-issue-list</li><li>gh-issue-reopen</li><li>gh-issue-status</li><li>gh-issue-view</li><li>gh-issue</li><li>gh-pr-checkout</li><li>gh-pr-checks</li><li>gh-pr-close</li><li>gh-pr-comment</li><li>gh-pr-create</li><li>gh-pr-diff</li><li>gh-pr-edit</li><li>gh-pr-list</li><li>gh-pr-merge</li><li>gh-pr-ready</li><li>gh-pr-reopen</li><li>gh-pr-review</li><li>gh-pr-status</li><li>gh-pr-view</li><li>gh-pr</li><li>gh-release-create</li><li>gh-release-delete</li><li>gh-release-download</li><li>gh-release-list</li><li>gh-release-upload</li><li>gh-release-view</li><li>gh-release</li><li>gh-repo-clone</li><li>gh-repo-create</li><li>gh-repo-fork</li><li>gh-repo-view</li><li>gh-repo</li><li>gh-secret-list</li><li>gh-secret-remove</li><li>gh-secret-set</li><li>gh-secret</li><li>gh-ssh-key-add</li><li>gh-ssh-key-list</li><li>gh-ssh-key</li></ul><h2 id=7-conclusion>7. Conclusion</h2><p>There are many other commands for the GitHub CLI that can be found in the
<a href=https://cli.github.com/manual/>gh manual</a>, however we only include a select
number of relevant commands for this guide. The commands mentioned above serve
to familiarize the user with the GitHub CLI while also providing practical
usage.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-20addf5f1313d1459bd24fe54815c81f>10 - Command cms</h1><div class=lead>How to ad dnew commands to cloudmesh.</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/cms-commands/featured-image_hu31ad1de8477c329f5412ff59acdd044d_22590_600x300_fill_catmullrom_smart1_2.png width=600 height=300><div class="card-body px-0 pt-2 pb-0"><p class=card-text>Cloudmesh Commands</p></div></div><div class="pageinfo pageinfo-primary"><p>We explain how to very quickly add new commands to cloudmesh</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to quickly add new commands to cloudmesh</li><li>Learn how to modify the commands for your liking</li><li>Understand how we use docopts for manual page generation</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#check-if-you-have-a-good-version-of-python>Check if you have a good version of python</a></li><li><a href=#creating-new-commands>Creating new commands</a></li><li><a href=#modifying-the-command>Modifying the command</a></li><li><a href=#accessing-variables>Accessing Variables</a></li><li><a href=#debugging-dicts-and-variables>Debugging dicts and variables</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></div><h2 id=introduction>Introduction</h2><p>Cloudmesh offers an easy-to-use command line and shell interface using a library
called <code>cloudmesh-cmd5</code>. Cmd5 installs a program called Cloudmesh Shell or
<code>cms</code> when called in a terminal. Cludmesh can be installed either directly from pip of developers can install it via the cloudmesh-installer that also downloads the source. The installations are discussed in detail in the Cloudmesh Manual.</p><p>In any case, we recommend you use a venv to assure that you d not by accident
destroy your system-wide python installation. We always use the environment
<code>~/ENV3</code> to have all tutorials uniform and to simplify them. If you do not yet have one create it as follows.</p><h3 id=check-if-you-have-a-good-version-of-python>Check if you have a good version of python</h3><p>We recommend installing a 64-bit version of python directly from python.org.
Anaconda is also possible, but we do not use anaconda much as it has many
unnecessary packages and thus is not ideal for cloud-based research. It is
always better to assemble just the libraries that you really need.</p><pre><code>python --version
# on some systems you need to use python3 or python3.9
</code></pre><p>For convenience, we assume your system uses python3.9. Now create the venv with</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python3.9 -m venv ~/ENV3
$ <span style=color:#204a87>source</span> ~/ENV3/bin/activate
$ pip install pip -U
</code></pre></div><p>To install Cloudmesh shell from PyPI you can say</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ pip install cloudmesh-cms
</code></pre></div><p>To install it with source say</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mkdir ~/cm
$ <span style=color:#204a87>cd</span> ~/cm
$ pip install cloudmesh-installer
$ cloudmesh-installer get cms
$ cmas <span style=color:#204a87>help</span>
</code></pre></div><h3 id=creating-new-commands>Creating new commands</h3><p>Now you have everything that you need to install new commands. The important
feature that cloudmesh includes is that it uses python namespaces. This makes
it possible to develop your own command in separate directories and store them
in GitHub in your own repositories.</p><p>To create a command we simply create a new directory for it and populate it
with a template by calling the command generation command in cloudmesh. For
simplicity, we name the directory <code>cloudmesh-gregor</code> but you can name it the way
you like it. We intend to create a command called gergor</p><pre><code>mkdir -p ~/cm/cloudmesh-gregor
cd ~/cm/cloudmesh-gregor
cms sys command generate gregor .
pip install -e .
cms help
</code></pre><p>Yes, this is it, you have now generated a new command <code>gregor</code> that you can see listed in the commands. Try it out with</p><pre><code>cms gregor
</code></pre><h3 id=modifying-the-command>Modifying the command</h3><p>To change the source, go to the file</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>emacs ~/cm/cloudmesh-gregor/cloudmesh/gregor/command/gregor.py
</code></pre></div><p>There you will see a comment as part of the command using docopts. We chose
docopts for our command generation as it allows us to design the documentation
first before we implement it. Docopts will take this docstring and generate a
dictionary that we can inspect and use in if conditions. We have significantly
enhanced the cms tool from python to more conveniently program new commands.
For example, we use a <code>dotdict</code>
implementation allowing us to say</p><p><code>arguments.FILE</code> instead of <code>argunemnts["FILE"]</code></p><p>This has two limitations</p><ol><li><p>you can not use build-in names such as <code>format</code>, <code>list</code>, and so on. In this case, you still have to use <code>arguments["format"]</code> as <code>.format</code> in python has a
very special meaning.</p></li><li><p>in case a parameter is passed as an option with <code>--option</code> or <code>--option2=OPTION2</code>
you can obviously not use <code>arguments.--option</code>
For you to use <code>arguments.option</code> we introduced a function called
Parameter</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>cloudmesh.shell.command</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>command</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>map_parameters</span>
   
<span style=color:#000>map_parameters</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>,</span>
               <span style=color:#4e9a06>&#34;option&#34;</span><span style=color:#000;font-weight:700>,</span>
               <span style=color:#4e9a06>&#34;option2&#34;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>that maps the <code>--</code> preceded options simply into the arguments dictionary
without the <code>--</code>.</p></li></ol><h3 id=accessing-variables>Accessing Variables</h3><p>Cloudmesh has also a build-in mechanism to store and use cms variables. YOu can
see them while using the command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a40000>$</span> <span style=color:#000>cms</span> <span style=color:#204a87>set</span>
</code></pre></div><p>These are variables that you can use to for example initialize options not
just form the command line, but through preset values you yous yourself.</p><p>Let us assume you like to preset the FILE to the value <code>~/cm/cloudmesh-gregor/README.md</code></p><p>you can do this with</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>cms</span> <span style=color:#204a87>set</span> <span style=color:#000>FILE</span><span style=color:#ce5c00;font-weight:700>=~/</span><span style=color:#000>cm</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>cloudmesh</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>gregor</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>README</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>md</span><span style=color:#a40000>`</span>
</code></pre></div><p>Now you can enhance your program by checking if the variable exists and use
it. This has the advantage that the implementation is slightly more dynamic
than using the <code>[default: value]</code> option from cloudmesh and allows to use of a
shared state of the variable between invocations.</p><p>We simply add the following just after the map parameters function</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>variables</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Variables</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#000>arguments</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>output</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Parameter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>find</span><span style=color:#000;font-weight:700>(</span>
    <span style=color:#4e9a06>&#34;FILE&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#000>arguments</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#000>variables</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#34;~/cm/cloudmesh-gregor/README.md&#34;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>The order in the <code>find</code> is done sequentially. First, we look if arguments.FILE
is defined by the command, then we look if it is in the variables, then we set a
default value. The default value is simply last.</p><h3 id=debugging-dicts-and-variables>Debugging dicts and variables</h3><p>We also included a simple debug function that prints the content of dicts as
well as the filename and the line number in the program.</p><p>YOu can use it for displaying the contents of the arguments so you can see how
to best crate if conditions that react to their state. Please be reminded that
the order in the if conditions are relevant t write your command. Assure your
<code>arguments</code> setting does not fire the specific rule you intend
to use.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>cloudmesh.common.debug</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>VERBOSE</span>

<span style=color:#000>VERBOSE</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>YOU can use VERBOSE with any variable, but it works best with one dicts having
a single layer such as <code>arguments</code> or <code>variables</code>.</p><h2 id=references>References</h2><ol><li>CLoudmesh manual</li><li>cms sys</li><li><code>from cloudmesh.shell.command import command, map_parameters</code></li><li><code>from cloudmesh.common.debug import VERBOSE</code></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-e366e3514fac18c1ed613e3a5cbad167>11 - Tutorials and Links</h1><div class=lead>A collection of potentially useful tutorial links.</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/links/featured-pi-logo_hu5b8151c4a85d6b42524e2eadfdb8c838_56492_600x300_fill_q75_catmullrom_smart1.jpg width=600 height=300><div class="card-body px-0 pt-2 pb-0"><p class=card-text>Tutorial Links.</p></div></div><div class="pageinfo pageinfo-primary"><p>A collection of potentially useful tutirial links</p><p><strong>Learning Objectives</strong></p><ul><li>Collect useful information</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#raspberrypiorg>Raspberrypi.org</a></li><li><a href=#interesting-links-to-burn-sdcards>Interesting Links to burn SDCards</a></li><li><a href=#interesting-links-for-raspberryos>Interesting links for RaspberryOS</a></li><li><a href=#other-toys>Other toys</a></li><li><a href=#camera>Camera</a></li></ul></nav></div></div><h2 id=raspberrypiorg>Raspberrypi.org</h2><ul><li>python <a href=https://www.raspberrypi.org/documentation/usage/python/README.md>https://www.raspberrypi.org/documentation/usage/python/README.md</a></li><li>terminal <a href=https://www.raspberrypi.org/documentation/usage/terminal/README.md>https://www.raspberrypi.org/documentation/usage/terminal/README.md</a></li><li>configuration select from <a href=https://www.raspberrypi.org/documentation/configuration/>https://www.raspberrypi.org/documentation/configuration/</a></li><li>remote access <a href=https://www.raspberrypi.org/documentation/remote-access/>https://www.raspberrypi.org/documentation/remote-access/</a></li><li>linux select from <a href=https://www.raspberrypi.org/documentation/linux/>https://www.raspberrypi.org/documentation/linux/</a></li><li>raspbian select from <a href=https://www.raspberrypi.org/documentation/raspbian/>https://www.raspberrypi.org/documentation/raspbian/</a></li><li>update <a href=https://www.raspberrypi.org/documentation/raspbian/applications/rpi-update.md>https://www.raspberrypi.org/documentation/raspbian/applications/rpi-update.md</a></li></ul><h2 id=interesting-links-to-burn-sdcards>Interesting Links to burn SDCards</h2><p>interesting article to use a vm to modify the image</p><ul><li>modify image <a href=https://opensource.com/article/20/5/disk-image-raspberry-pi>https://opensource.com/article/20/5/disk-image-raspberry-pi</a></li><li>NFS <a href=https://opensource.com/article/20/5/nfs-raspberry-pi>https://opensource.com/article/20/5/nfs-raspberry-pi</a></li></ul><h2 id=interesting-links-for-raspberryos>Interesting links for RaspberryOS</h2><ul><li>file sync <a href=https://pimylifeup.com/raspberry-pi-syncthing/>https://pimylifeup.com/raspberry-pi-syncthing/</a></li><li>mngodb <a href=https://pimylifeup.com/mongodb-raspberry-pi/>https://pimylifeup.com/mongodb-raspberry-pi/</a></li><li>raspicast <a href=https://pimylifeup.com/raspberry-pi-chromecast/>https://pimylifeup.com/raspberry-pi-chromecast/</a></li><li>internet monitor <a href=https://pimylifeup.com/raspberry-pi-internet-speed-monitor/>https://pimylifeup.com/raspberry-pi-internet-speed-monitor/</a></li><li>nfs server <a href=https://pimylifeup.com/raspberry-pi-nfs/>https://pimylifeup.com/raspberry-pi-nfs/</a></li><li>grafana <a href=https://pimylifeup.com/raspberry-pi-grafana/>https://pimylifeup.com/raspberry-pi-grafana/</a></li><li>doccker <a href=https://pimylifeup.com/raspberry-pi-docker/>https://pimylifeup.com/raspberry-pi-docker/</a></li><li>gdrive <a href=https://pimylifeup.com/compiling-and-running-gdrive/>https://pimylifeup.com/compiling-and-running-gdrive/</a></li><li>ubuntu server enable ssh <a href=https://pimylifeup.com/ubuntu-server-raspberry-pi/>https://pimylifeup.com/ubuntu-server-raspberry-pi/</a></li><li>go <a href=https://pimylifeup.com/raspberry-pi-golang/>https://pimylifeup.com/raspberry-pi-golang/</a></li><li>mqtt <a href=https://pimylifeup.com/raspberry-pi-mosquitto-mqtt-server/>https://pimylifeup.com/raspberry-pi-mosquitto-mqtt-server/</a></li></ul><h2 id=other-toys>Other toys</h2><ul><li>php myadmin <a href=https://pimylifeup.com/raspberry-pi-phpmyadmin/>https://pimylifeup.com/raspberry-pi-phpmyadmin/</a></li><li>webcam <a href=https://pimylifeup.com/raspberry-pi-webcam-server/>https://pimylifeup.com/raspberry-pi-webcam-server/</a></li><li>owncloud <a href=https://pimylifeup.com/raspberry-pi-owncloud/>https://pimylifeup.com/raspberry-pi-owncloud/</a></li><li>git server <a href=https://pimylifeup.com/raspberry-pi-owncloud/>https://pimylifeup.com/raspberry-pi-owncloud/</a></li><li>wifi bridge <a href=https://pimylifeup.com/raspberry-pi-wifi-bridge/>https://pimylifeup.com/raspberry-pi-wifi-bridge/</a></li><li>next cloud <a href=https://pimylifeup.com/raspberry-pi-nextcloud-server/>https://pimylifeup.com/raspberry-pi-nextcloud-server/</a></li><li>twitch bot <a href=https://pimylifeup.com/raspberry-pi-twitch-bot/>https://pimylifeup.com/raspberry-pi-twitch-bot/</a></li><li>captive portal to use wifi <a href=https://pimylifeup.com/raspberry-pi-captive-portal/>https://pimylifeup.com/raspberry-pi-captive-portal/</a></li><li>ndnix <a href=https://pimylifeup.com/raspberry-pi-nginx/>https://pimylifeup.com/raspberry-pi-nginx/</a></li><li>vlc <a href=https://pimylifeup.com/raspberry-pi-vlc/>https://pimylifeup.com/raspberry-pi-vlc/</a></li><li>ebook server <a href=https://pimylifeup.com/raspberry-pi-ebook-server/>https://pimylifeup.com/raspberry-pi-ebook-server/</a></li><li><a href=https://pimylifeup.com/raspberry-pi-screen-sharing/>https://pimylifeup.com/raspberry-pi-screen-sharing/</a></li><li>add blocker <a href=https://pimylifeup.com/raspberry-pi-pi-hole/>https://pimylifeup.com/raspberry-pi-pi-hole/</a></li><li>fail to ban <a href=https://pimylifeup.com/raspberry-pi-fail2ban/>https://pimylifeup.com/raspberry-pi-fail2ban/</a></li></ul><h2 id=camera>Camera</h2><ul><li>control dslr <a href=https://pimylifeup.com/raspberry-pi-dslr-camera-control/>https://pimylifeup.com/raspberry-pi-dslr-camera-control/</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-112a4df841cb55c94a6b183558c66221>12 - Network Scanning Tutorial</h1><div class=lead>This post includes useful network enumeration commands.</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/network-scanning-tutorial/featured-image_hu31ad1de8477c329f5412ff59acdd044d_22590_600x300_fill_catmullrom_smart1_2.png width=600 height=300><div class="card-body px-0 pt-2 pb-0"><p class=card-text>The Web Page.</p></div></div><div class="pageinfo pageinfo-primary"><p>Abstract</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to enumerate and verify network conditions on a Pi cluster.</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#ip-address>IP Address</a></li><li><a href=#ping>Ping</a></li><li><a href=#arp>ARP</a></li><li><a href=#route>Route</a></li><li><a href=#traceroute>Traceroute</a></li><li><a href=#etchosts>/etc/hosts</a></li></ul></li></ul></nav></div></div><h2 id=introduction>Introduction</h2><p>While working with clusters there will be many times you need to
troubleshoot network connectivity. Below are useful commands to help you enumerate
and verify you network is operating correctly.</p><h3 id=ip-address>IP Address</h3><p>The ip address command can help you determine your network interface card
configuration (NIC) including IP address, networks, and MAC address.</p><pre><code>(ENV3) pi@red:~ $ ip address
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether dc:a6:32:e8:03:09 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.1/24 brd 10.1.1.255 scope global noprefixroute eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::bc02:69de:ea6d:78a2/64 scope link 
       valid_lft forever preferred_lft forever
3: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether dc:a6:32:e8:03:0a brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.27/24 brd 192.168.1.255 scope global dynamic noprefixroute wlan0
       valid_lft 86368sec preferred_lft 75568sec
    inet6 fe80::20a9:5c10:42fe:5eb0/64 scope link 
       valid_lft forever preferred_lft forever
(ENV3) pi@red:~ $ 

</code></pre><h3 id=ping>Ping</h3><p>To ping an IP address</p><pre><code>ping 10.1.1.1
</code></pre><h4 id=ping-when-you-do-not-know-the-ip-address>Ping when you do not know the IP address.</h4><p>Try using multicast doman name servcie (mDNS) to resolve the hostname using
the .local extension.</p><pre><code>ping red.local
</code></pre><h4 id=ping-from-a-specific-interface>Ping from a specific interface</h4><p>If you need to ping out a specific interface, such as eth0 or wlan0</p><pre><code>ping -I wlan0 red.local
</code></pre><h3 id=arp>ARP</h3><p>When your computer needs to send a packet to an IP address it must
first determine the next hop MAC address. It does this using the ARP protocol.</p><h4 id=to-view-the-arp-table-mac-address-to-ip-address->To view the ARP table (MAC Address to IP address )</h4><p>Next hop MAC address to IP pairings can be viewed in the ARP table. The ARP
also contains conveniently contains hostnames if they were resolved.</p><pre><code>arp -a
</code></pre><pre><code>pi@red:~ $ arp -a
red001 (10.1.1.2) at dc:a6:32:e7:fe:69 [ether] on eth0
? (192.168.1.1) at dc:ef:09:d9:5f:64 [ether] on wlan0
? (192.168.1.12) at e4:b3:18:d4:bd:d1 [ether] on wlan0
? (192.168.1.14) at e8:d8:d1:82:42:b8 [ether] on wlan0
red002 (10.1.1.3) at dc:a6:32:e8:02:25 [ether] on eth0
</code></pre><h4 id=to-clear-the-arp-table-forcing-mac-addresses-to-be-resolved-again-on-next-use>To clear the ARP table, forcing MAC addresses to be resolved again on next use.</h4><pre><code>ip -s -s neigh flush all
</code></pre><h3 id=route>Route</h3><p>The route command shows you all the rules you machine uses to route packets.</p><p>The example below informs us the default route is using the wlan0 interface,
while the 10.1.1.0/24 network will be reached using the eth0 interface.</p><pre><code>pi@red:~ $ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.1.1     0.0.0.0         UG    303    0        0 wlan0
10.1.1.0        0.0.0.0         255.255.255.0   U     202    0        0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U     303    0        0 wlan0
</code></pre><h3 id=traceroute>Traceroute</h3><p>Traceroute is a tool to determine the network routers on a path from your
host to a destination ip. For example, lets verify the worker (red001) uses the
manager pi (10.1.1.1) to reach the internet (8.8.8.8)</p><pre><code>pi@red001:~ $ traceroute 8.8.8.8
traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets
 1  red (10.1.1.1)  0.290 ms  0.252 ms  0.182 ms
 2  192.168.1.1 (192.168.1.1)  3.362 ms  3.577 ms  3.484 ms
 3  96.120.112.113 (96.120.112.113)  22.974 ms  15.305 ms  21.364 ms
 4  96.110.168.9 (96.110.168.9)  20.590 ms  19.890 ms  20.401 ms
 5  96.108.120.86 (96.108.120.86)  20.164 ms  21.079 ms  21.164 ms
 6  96.108.120.145 (96.108.120.145)  27.577 ms  22.101 ms  22.144 ms
 7  24.153.88.85 (24.153.88.85)  28.857 ms  29.504 ms  29.553 ms
 8  be-32241-cs04.350ecermak.il.ibone.comcast.net (96.110.40.61)  30.314 ms  31.071 ms  31.177 ms
 9  be-2112-pe12.350ecermak.il.ibone.comcast.net (96.110.33.210)  36.510 ms be-2412-pe12.350ecermak.il.ibone.comcast.net (96.110.33.222)  36.423 ms be-2111-pe11.350ecermak.il.ibone.comcast.net (96.110.33.194)  35.794 ms
10  96-87-9-122-static.hfc.comcastbusiness.net (96.87.9.122)  33.767 ms 66.208.233.86 (66.208.233.86)  34.202 ms 96-87-9-122-static.hfc.comcastbusiness.net (96.87.9.122)  34.035 ms
11  * * *
12  dns.google (8.8.8.8)  33.843 ms  33.433 ms  34.622 ms

</code></pre><h4 id=nmap>NMAP</h4><p>NMAP is a a tool that can conduct a wide variety of network scans. We will
use NMAP to find the IP of our manager pi (red) from our laptop on our
wireless network (192.168.1.0/24).</p><blockquote><p>Note: Raspberry Pi MAC addresses start with DC:A6:32, so we know 192.168.1.
27 is our manager pi</p></blockquote><pre><code>anthony@anthony-ubuntu:~$ sudo nmap -sP 192.168.1.0/24

Starting Nmap 7.60 ( https://nmap.org ) at 2021-03-11 14:16 EST
Nmap scan report for _gateway (192.168.1.1)
Host is up (0.0031s latency).
MAC Address: DC:EF:09:D9:5F:64 (Netgear)
Nmap scan report for 192.168.1.7
Host is up (0.18s latency).
MAC Address: E0:F6:B5:EA:C6:CC (Unknown)
Nmap scan report for 192.168.1.14
Host is up (0.46s latency).
MAC Address: E8:D8:D1:82:42:B8 (Unknown)
Nmap scan report for 192.168.1.19
Host is up (-0.017s latency).
MAC Address: 34:93:42:87:BA:46 (Unknown)
Nmap scan report for 192.168.1.23
Host is up (0.98s latency).
MAC Address: D0:D2:B0:90:2E:60 (Apple)
Nmap scan report for 192.168.1.27
Host is up (1.5s latency).
MAC Address: DC:A6:32:E8:03:0A (Unknown)
Nmap scan report for anthony-ubuntu (192.168.1.12)
Host is up.
Nmap done: 256 IP addresses (7 hosts up) scanned in 17.90 seconds
</code></pre><h3 id=etchosts>/etc/hosts</h3><p>This file contains static hostname to IP mappings.</p><pre><code>(ENV3) pi@red:~ $ cat /etc/hosts
127.0.0.1  localhost
::1        localhost ip6-localhost ip6-loopback
ff02::1    ip6-allnodes
ff02::2    ip6-allrouters
#
127.0.1.1  red
#
10.1.1.1	red
10.1.1.2	red001
10.1.1.3	red002
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-38142d6afd1cbdafe9e93351683a6a9a>13 - Port Forwarding Tutorial</h1><div class=lead>Enable cluster-internal service access to external machines</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/port-forwarding-ssh-tunnels/featured-web-port-forward_hua2ee70c9cd56e08e641ddf485eab0d08_78292_600x300_fill_catmullrom_smart1_2.png width=600 height=300><div class="card-body px-0 pt-2 pb-0"><p class=card-text>Port Forwarding Tutorial</p></div></div><div class="pageinfo pageinfo-primary"><p>c</p><p><strong>Learning Objectives</strong></p><ul><li><p>Learn how to provide external machines permanent access to cluster-internal
services with ssh port forwarding, autossh, and systemd</p></li><li><p>Easily SSH into cluster internal machines from an external machine using
ProxyJump.</p></li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#port-forwarding-tutorial>Port Forwarding Tutorial</a><ul><li><a href=#how-to-do-a-local-port-forward-for-internal-node-ssh-access-via-the-manager-node>How to do a local port forward for internal node SSH access via the manager node</a></li><li><a href=#how-to-make-a-local-port-forward-tunnel-persistent-using-autossh-and-systemd>How to make a local port forward tunnel persistent using Autossh and Systemd</a></li><li><a href=#how-to-use-proxyjump-for-ssh-access-to-internal-node-via-the-manager-node>How to use ProxyJump for SSH access to internal node via the manager node</a></li><li><a href=#can-proxyjump-be-used-for-arbitary-services>Can ProxyJump be used for arbitary services?</a></li><li><a href=#use-local-port-forward-to-expose-arbitrary-service>Use local port forward to expose arbitrary service</a></li><li><a href=#reccmmendatoins>Reccmmendatoins</a></li></ul></li></ul></nav></div></div><h2 id=port-forwarding-tutorial>Port Forwarding Tutorial</h2><h3 id=how-to-do-a-local-port-forward-for-internal-node-ssh-access-via-the-manager-node>How to do a local port forward for internal node SSH access via the manager node</h3><blockquote><p>NOTE: This is actually more than what is needed if all you want is SSH, see
ProxyJump section below</p></blockquote><p>In this image below we setup a ssh tunnel on the manager pi to enable ssh
access from the laptop to the worker node Red001.</p><p>The manager and laptop must both be included in red001&rsquo;s
<code>~/.ssh/authorized_hosts</code> file.</p><p><img src=https://github.com/cloudmesh/cloudmesh-pi-cluster/raw/main/images/ssh-port-forward.PNG alt></p><p>We create one tunnel for each worker each with a unique wlan_ip:port assigned.</p><p>Now in the laptop <code>~/.ssh/config</code> file we add:</p><pre><code>Host red
     HostName    red.local
     User        pi

Host red001
     HostName    red.local
     User        pi
     Port       8001

Host red002
     HostName    red.local
     User        pi
     Port        8002
</code></pre><p>Finally we can ssy from the laptop to the worker.</p><pre><code>you@laptop:~ $ ssh red001
</code></pre><p><strong>However, this tunnel is not permanent as is.</strong> Besides manager or worker
*restarts, it is also subject to communication failures, such as timeouts, that
*will cause the tunnel to break. This will force the user to re-run the command
*to create the tunnel, and in some cases, find and kill a failed but still
*existing tunnel process.</p><p>For additional visualizations and discussion of local and remote port
forwarding see <a href=http://dirk-loss.de/ssh-port-forwarding.htm>http://dirk-loss.de/ssh-port-forwarding.htm</a></p><h3 id=how-to-make-a-local-port-forward-tunnel-persistent-using-autossh-and-systemd>How to make a local port forward tunnel persistent using Autossh and Systemd</h3><p>Autossh is a program designed to automatically restart SSH sessions and
tunnels.</p><p>Systemd is a Linux system and service manager used by Raspi OS.</p><p>We use systemd to install an autossh service that starts on system boot to
establish the ssh tunnel.</p><p>Create the below file. Notice this requires the wifi IP address on the manager
(wlan0 e.g. 192.168.1.24).</p><p><code>/etc/systemd/system/autossh-red001.service</code></p><pre><code>[Unit]
Description=AutoSSH tunnel service to red001 on local port 8001
After=multi-user.target

[Service]
User=pi
Group=pi
Environment=&quot;AUTOSSH_GATETIME=0&quot;
ExecStart=/usr/bin/autossh -M 0 -o &quot;ServerAliveInterval 30&quot; -o &quot;ServerAliveCountMax 3&quot; -i /home/pi/.ssh/id_rsa -NL 192.168.1.24:8001:localhost:22 pi@red001

[Install]
WantedBy=multi-user.target
</code></pre><p>To get the service to start and be enabled on system restart we need to run the
following commands.</p><pre><code>sudo systemctl daemon-reload
sudo systemctl start autossh-red001.service
sudo systemctl enable autossh-red001.service
</code></pre><blockquote><p>NOTE: As we are binding the tunnel to a dynamically assigned address on our
wlan0 interface. The tunnel will not function if wlan0 interface is assigned a
different IP.</p></blockquote><p>Currently the command below will setup a autossh tunnel for ssh access to the
workers.</p><p><code>pi@manger $ cms host tunnel create red00[1-2] [--port]</code> If the wifi IP
changes, the above command needs to be run again, but the ssh config on the
laptop will not need to be changed unless the user specifies new ports.</p><h3 id=how-to-use-proxyjump-for-ssh-access-to-internal-node-via-the-manager-node>How to use ProxyJump for SSH access to internal node via the manager node</h3><p>It turns out setting up a port forward for simple ssh access to the workers via
the manger is over complicated.</p><p>ProxyJump is an SSH option that exists to simply this purpose. It is also more
reliabe as the tunnel is setup on demand.</p><p>See the example below.</p><pre><code>ssh -J pi@red.local pi@red001
</code></pre><p>We can also do this with a only <code>~/.ssh/config</code> file.</p><pre><code>Host red
   Hostname red.local
   User	    pi
   
Host red001
   Hostname red001
   User	    pi
   ProxyJump red
</code></pre><p>No we can simply setup a tunnel on demand as we access the worker.</p><pre><code>you@laptop:~ $ ssh red001
</code></pre><h3 id=can-proxyjump-be-used-for-arbitary-services>Can ProxyJump be used for arbitary services?</h3><p>I don&rsquo;t know yet. Based on a quick glance at this article, the answer is
<strong>no</strong>, but it can be useful if you need to tunnel through multiple hosts
before starting a remote port forward.</p><p><a href=https://medium.com/maverislabs/proxyjump-the-ssh-option-you-probably-never-heard-of-2d7e41d43464>https://medium.com/maverislabs/proxyjump-the-ssh-option-you-probably-never-heard-of-2d7e41d43464</a></p><h3 id=use-local-port-forward-to-expose-arbitrary-service>Use local port forward to expose arbitrary service</h3><p>So, port forwarding is still useful to expose arbitrary services.</p><p>In the example below we expose a worker running cloudmesh-openapi on port 80 to
the laptop with a local port foward. Again we can make this permanent with
autossh and systemd.</p><p><img src=https://github.com/cloudmesh/cloudmesh-pi-cluster/raw/main/images/web-port-forward.PNG alt></p><h3 id=reccmmendatoins>Reccmmendatoins</h3><p>For simple ssh access we make a command (or Gregor might have already done
this, I haven&rsquo;t reviewed his work yet)</p><pre><code>cms ssh config NAMES MANAGER [--laptop]
</code></pre><p>e.g.</p><pre><code> cms ssh config red00[1-2] red --laptop=anthony@anthony-ubuntu.local
</code></pre><p>We will probably turn <code>cms host tunnel create</code> into a command to expose an
arbirary cluster-internal service to the laptop (not just ssh). For example
accessing a web page running on a worker.</p><pre><code>cms host tunnel create NAMES SERVICE_PORTS EXTERNAL_START_PORT
</code></pre><p>e.g.</p><pre><code>cms host tunnel create red00[1-2] 80 8080
</code></pre><p>Now from laptop we can browse to <code>http://red.local:8080</code> and
<code>http://red.local:8081</code> to access the web pages on <code>red001:80</code> and <code>red002:80</code>
respectively.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-058d31f1ad9ef18980f31316da5cffc8>14 - Ubuntu on the Pi</h1><div class=lead>A collection of links and tutrials that halp making using Ubuntu on the Pi.</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/ubuntu/featured-image_hub225d8e28e0c8cb78ba75e0b37fb6163_234635_600x300_fill_catmullrom_smart1_2.png width=600 height=300><div class="card-body px-0 pt-2 pb-0"><p class=card-text>Upuntu Turorials</p></div></div><div class="pageinfo pageinfo-primary"><p>A collection of links and tutorials that halp making using Ubuntu on the Pi.</p><p><strong>Learning Objectives</strong></p><ul><li>Find tutorials and useful infpormation about PI&rsquo;s and Ubuntu.</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#canonical-tutorials>Canonical Tutorials</a></li><li><a href=#initialization>Initialization</a></li><li><a href=#faq>FAQ</a><ul><li><a href=#dd-from-compressed-files>dd from compressed files</a></li><li><a href=#cloudint-reset>cloudint reset</a></li><li><a href=#k3s>k3s</a></li><li><a href=#k3sup-with-static-adresses>k3sup with static adresses</a></li><li><a href=#k9s>k9s</a></li></ul></li><li><a href=#general-ubuntu>general ubuntu</a></li></ul></nav></div></div><h2 id=introduction>Introduction</h2><p>Ubuntu is a real good alternative for an operating system on teh PI. The reason
is that at this time RaspberryOS is only supporting 32-bit, while Ubuntu
supports both 32 and 64 bit versions of their operating system. We recommend to
just install the 64 bit version.</p><h2 id=canonical-tutorials>Canonical Tutorials</h2><ul><li><p><a href=https://wiki.ubuntu.com/ARM/RaspberryPi>The very useful Wiki</a></p></li><li><p><a href="https://ubuntu.com/tutorials?q=pi">Ubuntu PI tutorials from Canonical</a></p><p>Currently this includes</p><ul><li><a href=https://ubuntu.com/tutorials/how-to-install-ubuntu-desktop-on-raspberry-pi-4#1-overview>How to install Ubuntu Desktop on Raspberry Pi 4</a></li><li>[How to create an Ubuntu Server SDcard for Raspberry Pi](How to create an Ubuntu Server SDcard for Raspberry Pi)</li><li><a href=https://ubuntu.com/tutorials/how-to-install-ubuntu-on-your-raspberry-pi#1-overview>How to install Ubuntu Server on your Raspberry Pi</a></li><li><a href=https://ubuntu.com/tutorials/how-to-kubernetes-cluster-on-raspberry-pi#1-overview>How to build a Raspberry Pi Kubernetes cluster using MicroK8s</a></li><li><a href=https://ubuntu.com/tutorials/how-to-install-ubuntu-core-on-raspberry-pi#1-overview>How to install Ubuntu Core on your Raspberry Pi</a></li><li><a href=https://ubuntu.com/tutorials/create-an-ubuntu-image-for-a-raspberry-pi-on-windows#1-overview>Create an Ubuntu image for a Raspberry Pi on Windows</a></li><li><a href=https://ubuntu.com/tutorials/create-an-ubuntu-image-for-a-raspberry-pi-on-macos#1-overview>Create an Ubuntu image for a Raspberry Pi on MacOS</a></li><li><a href=https://ubuntu.com/tutorials/create-an-ubuntu-image-for-a-raspberry-pi-on-ubuntu#1-overview>Create an Ubuntu image for a Raspberry Pi on Ubuntu</a></li><li><a href=https://ubuntu.com/tutorials/how-to-install-adguard-home-raspberry-pi#1-overview>How to use the AdGuard Home Ubuntu Appliance</a></li></ul></li></ul><h2 id=initialization>Initialization</h2><ul><li><a href=https://cloudinit.readthedocs.io/en/latest/>Clud init</a></li><li><a href=https://roboticsbackend.com/install-ubuntu-on-raspberry-pi-without-monitor/>Headless Setup via user-data</a><ul><li><a href=https://stackoverflow.com/questions/62930794/ubuntu-focal-headless-setup-on-raspberry-pi-4-cloud-init-wifi-initialisation-b>network</a></li><li><a href=https://askubuntu.com/questions/1302840/ubuntu-setup-user-data-ssh>user-data</a></li></ul></li></ul><h2 id=faq>FAQ</h2><h3 id=dd-from-compressed-files>dd from compressed files</h3><p>from: <a href=https://www.zdnet.com/article/hands-on-adventures-with-ubuntu-linux-on-the-raspberry-pi-4/>https://www.zdnet.com/article/hands-on-adventures-with-ubuntu-linux-on-the-raspberry-pi-4/</a></p><pre><code>xzcat ubuntu-20.10-preinstalled-desktop-arm64+raspi.img.xz | dd bs=4M of=/dev/sdX iflag=fullblock oflag=direct status=progress
</code></pre><p>xzcat uncompresses the download file and writes it to standard output, so we can pipe it to the dd command
dd is the Linux raw copy utility, which will actually write the data to the SD card
bs=4M tells dd to read/write the data in blocks of 4 Megabytes
of=/dev/sdX tells dd where to write the output; you need to replace the X with the device identifier for the SD card on your system; be very careful about this, because putting the wrong character here can have catastrophic consequences
iflag=fullblock tells dd to accumulate full blocks on the input before proceeding to the output
oflag=direct tells dd to use direct I/O operations for the data
status=progress tells dd to show a periodic summary of the data transfer</p><h3 id=cloudint-reset>cloudint reset</h3><ul><li><a href="https://www.raspberrypi.org/forums/viewtopic.php?t=255465">https://www.raspberrypi.org/forums/viewtopic.php?t=255465</a></li></ul><p>sudo cloud-init clean &ndash;logs &ndash;reboot</p><p>Will cause cloud-init to reset itself and re-run after rebooting the machine.
Note that this does not clean up everything that cloud-init did the first time
round (user creation, file-writing, etc.), so depending on the configuration it
may or may not work successfully the second time (though generally I&rsquo;ve found
it reasonably useful for testing). Currently, the only way to completely clean
the system is to re-image.</p><h3 id=k3s>k3s</h3><ul><li>good tutorial: <a href=https://mhausenblas.info/kube-rpi/>https://mhausenblas.info/kube-rpi/</a></li><li><a href=https://medium.com/@amadmalik/installing-kubernetes-on-raspberry-pi-k3s-and-docker-on-ubuntu-20-04-ef51e5e56>https://medium.com/@amadmalik/installing-kubernetes-on-raspberry-pi-k3s-and-docker-on-ubuntu-20-04-ef51e5e56</a></li></ul><h3 id=k3sup-with-static-adresses>k3sup with static adresses</h3><ul><li><p>Important read but we want to use k3s and not k3sup
<a href=https://medium.com/icetek/building-a-kubernetes-cluster-on-raspberry-pi-running-ubuntu-server-8fc4edb30963>https://medium.com/icetek/building-a-kubernetes-cluster-on-raspberry-pi-running-ubuntu-server-8fc4edb30963</a></p></li><li><p><a href=https://ma.ttias.be/deploying-highly-available-k3s-k3sup/>https://ma.ttias.be/deploying-highly-available-k3s-k3sup/</a></p></li></ul><h3 id=k9s>k9s</h3><p>some tool, nt sure if useful</p><ul><li><a href=https://github.com/derailed/k9s>https://github.com/derailed/k9s</a></li></ul><h2 id=general-ubuntu>general ubuntu</h2><ul><li>enable ssh <a href=https://pimylifeup.com/ubuntu-enable-ssh/>https://pimylifeup.com/ubuntu-enable-ssh/</a></li><li>NTP with chrony <a href=https://pimylifeup.com/using-ntp-on-linux-with-chrony/>https://pimylifeup.com/using-ntp-on-linux-with-chrony/</a></li><li>NTP <a href=https://pimylifeup.com/timedatectl-command/>https://pimylifeup.com/timedatectl-command/</a></li><li>2 factor auth for ssh <a href=https://pimylifeup.com/setup-2fa-ssh/>https://pimylifeup.com/setup-2fa-ssh/</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8a03792772737c9fcda02ef45a778cc5>15 - User Management</h1><div class=lead>How to manage users on the pi cluster</div><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:610px><img class=card-img-top src=/pi/tutorial/usermanagement/featured-image_hu31ad1de8477c329f5412ff59acdd044d_22590_600x300_fill_catmullrom_smart1_2.png width=600 height=300><div class="card-body px-0 pt-2 pb-0"><p class=card-text></p></div></div><div class="pageinfo pageinfo-primary"><p>This tutorial will introduce you to simple user management commands for a Pi cluster generated with cloudmeah <code>cms burn</code>. It allows adding, deleting new users as wall as adding new keys too the manager and workers. It does only use ssh as mechanism for authentication as to keep the number of used services small.</p><p><strong>Learning Objectives</strong></p><ul><li>Learn how to manage users with cloudmesh</li><li>Learn ow to add and delete users</li><li>Learn how to add keys</li></ul><p><strong>Topics covered</strong></p><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#setup-sshconfig-to-use-proxyjump>Setup ~/.ssh/config to use PROXYJUMP</a></li><li><a href=#add-user>Add User</a></li><li><a href=#change-user-password>Change User Password</a></li><li><a href=#add-user-to-sudoers>Add User to Sudoers</a></li><li><a href=#test-user>Test User</a></li><li><a href=#add-a-key-to-a-users-authorized-keys>Add A Key to A User&rsquo;s Authorized Keys</a></li><li><a href=#delete--user>Delete User</a></li></ul></li></ul></nav></div></div><h3 id=setup-sshconfig-to-use-proxyjump>Setup ~/.ssh/config to use PROXYJUMP</h3><p>This tutorial assumes you have local network access to the target machines.
If this is not the case, such as in a bridge setup, you can run the
following command to setup your <code>~/.ssh/config</code> file to use the bridge to access
the target machines.</p><p>In this example <code>red.local</code> is the bridge and <code>red0[1-2]</code> are workers
accessible via the bridge device, and the workers already have your laptop&rsquo;s
ssh key in authorized_keys.</p><pre><code>you@yourlaptop:~/$ cms host config proxy pi@red.local red0[1-2]
host config proxy pi@red.local red0[1-2]
Adding to ~/.ssh/config

##### CLOUDMESH PROXY CONFIG #####

Host red
     HostName pi@red.local
     User pi

Host red01
     HostName red01
     User pi
     ProxyJump pi@red.local

Host red02
     HostName red02
     User pi
     ProxyJump pi@red.local

##### CLOUDMESH PROXY CONFIG #####

</code></pre><p>Let&rsquo;s test</p><pre><code>you@yourlaptop:~/$ ssh red
pi@red:~/$ exit
you@yourlaptop:~/$ ssh red01
pi@red001:~/$ exit
you@yourlaptop:~/$ ssh red02
pi@red002:~/$ exit
</code></pre><h3 id=add-user>Add User</h3><p>On red only.</p><pre><code>pi@red:~ $ sudo add user bob
</code></pre><p>On multiple cluster machines.</p><pre><code>you@yourlaptop:~/$ cms host adduser localhost,red,red0[1-2] wendy
host adduser localhost,red,red0[1-2] wendy

Adding user to localhost
Adding user `wendy' ...
Adding new group `wendy' (1011) ...
Adding new user `wendy' (1010) with group `wendy' ...
Creating home directory `/home/wendy' ...
Copying files from `/etc/skel' ...

+--------+---------+--------------------------------------------------+
| host   | success | stdout                                           |
+--------+---------+--------------------------------------------------+
| red    | True    | Adding user `wendy' ...                          |
|        |         | Adding new group `wendy' (1001) ...              |
|        |         | Adding new user `wendy' (1001) with group        |
|        |         | `wendy' ...                                      |
|        |         | Creating home directory `/home/wendy' ...        |
|        |         | Copying files from `/etc/skel' ...               |
| red01  | True    | Adding user `wendy' ...                          |
|        |         | Adding new group `wendy' (1001) ...              |
|        |         | Adding new user `wendy' (1001) with group        |
|        |         | `wendy' ...                                      |
|        |         | Creating home directory `/home/wendy' ...        |
|        |         | Copying files from `/etc/skel' ...               |
| red02  | True    | Adding user `wendy' ...                          |
|        |         | Adding new group `wendy' (1001) ...              |
|        |         | Adding new user `wendy' (1001) with group        |
|        |         | `wendy' ...                                      |
|        |         | Creating home directory `/home/wendy' ...        |
|        |         | Copying files from `/etc/skel' ...               |
+--------+---------+--------------------------------------------------+

</code></pre><h3 id=change-user-password>Change User Password</h3><p>On red only.</p><pre><code>pi@red:~ $ sudo passwd bob
</code></pre><p>On multiple cluster machines.</p><pre><code>you@yourlaptop:~/$ cms host passwd localhost,red,red0[1-2] wendy
host passwd localhost,red,red0[1-2] wendy

Setting password on localhost, please provide user password
Enter new UNIX password: 
Retype new UNIX password: 
passwd: password updated successfully
0

Setting password on remote hosts, please enter user password

Please enter the user password:
c+--------+---------+--------+
| host   | success | stdout |
+--------+---------+--------+
| red    | True    |        |
| red01  | True    |        |
| red02  | True    |        |
+--------+---------+--------+
</code></pre><p>However, it seems like this may not work on the local machine (red).</p><h3 id=add-user-to-sudoers>Add User to Sudoers</h3><p>On red only.</p><pre><code>pi@red:~ $ sudo adduser bob sudo
</code></pre><p>On multiple cluster machines.</p><pre><code>you@yourlaptop:~/$ cms host addsudo localhost,red,red00[1-2] wendy
host addsudo localhost,red,red00[1-2] wendy

Adding user to sudo group on localhost
Adding user `wendy' to group `sudo' ...
Adding user wendy to group sudo
Done.

+--------+---------+-----------------------------------------+
| host   | success | stdout                                  |
+--------+---------+-----------------------------------------+
| red    | True    | Adding user `wendy' to group `sudo' ... |
|        |         | Adding user wendy to group sudo         |
|        |         | Done.                                   |
| red01  | True    | Adding user `wendy' to group `sudo' ... |
|        |         | Adding user wendy to group sudo         |
|        |         | Done.                                   |
| red02  | True    | Adding user `wendy' to group `sudo' ... |
|        |         | Adding user wendy to group sudo         |
|        |         | Done.                                   |
+--------+---------+-----------------------------------------+
</code></pre><h3 id=test-user>Test User</h3><pre><code>you@yourlaptop:~ $ ssh red01

pi@red01:~$ su wendy
Password: 
To run a command as administrator (user &quot;root&quot;), use &quot;sudo &lt;command&gt;&quot;.
See &quot;man sudo_root&quot; for details.

wendy@red01:/home/ubuntu$ sudo echo hello
[sudo] password for wendy: 
hello
</code></pre><h3 id=add-a-key-to-a-users-authorized-keys>Add A Key to A User&rsquo;s Authorized Keys</h3><pre><code>you@yourlaptop:~ $ cms host key gather red keys.txt
host key gather red keys.txt

you@yourlaptop:~ $ cms host key scatter red,red0[1-2] keys.txt --user=wendy 
host key scatter red,red0[1-2] keys.txt --user=wendy
INFO: SCP to ./temp_authorzied_keys_temp
+--------+---------+--------+
| host   | success | stdout |
+--------+---------+--------+
| red    | True    |        |
| red01  | True    |        |
| red02  | True    |        |
+--------+---------+--------+
INFO: Mkdir /home/wendy/.ssh if not exist
+--------+---------+--------+
| host   | success | stdout |
+--------+---------+--------+
| red    | True    |        |
| red01  | True    |        |
| red02  | True    |        |
+--------+---------+--------+
INFO: Chown /home/wendy/.ssh to wendy
+--------+---------+--------+
| host   | success | stdout |
+--------+---------+--------+
| red    | True    |        |
| red01  | True    |        |
| red02  | True    |        |
+--------+---------+--------+
INFO: Chmod /home/wendy/.ssh to 700
+--------+---------+--------+
| host   | success | stdout |
+--------+---------+--------+
| red    | True    |        |
| red01  | True    |        |
| red02  | True    |        |
+--------+---------+--------+
INFO: Mv temp_authorized_keys_temp to /home/wendy/.ssh/authorized_keys
+--------+---------+--------+
| host   | success | stdout |
+--------+---------+--------+
| red    | True    |        |
| red01  | True    |        |
| red02  | True    |        |
+--------+---------+--------+
INFO: Chown /home/wendy/.ssh/authorized_keys to wendy
+--------+---------+--------+
| host   | success | stdout |
+--------+---------+--------+
| red    | True    |        |
| red01  | True    |        |
| red02  | True    |        |
+--------+---------+--------+

</code></pre><p>Let uss test logging in as wendy.</p><pre><code>you@yourlaptop:~ $ ssh wendy@red.local
Linux red 5.10.17-v7l+ #1403 SMP Mon Feb 22 11:33:35 GMT 2021 armv7l

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
wendy@red:~ $ 

</code></pre><h3 id=delete--user>Delete User</h3><p>On red only.</p><p>-r removes the user&rsquo;s home folder too.</p><pre><code>pi@red:~ $ sudo userdel -r bob
</code></pre><p>On multiple cluster machines.</p><pre><code>you@yourlaptop:~/$ cms host deluser localhost,red,red0[1-2] wendy
host deluser localhost,red,red0[1-2] wendy

Deleting user on localhost
userdel: wendy mail spool (/var/mail/wendy) not found

+--------+---------+--------+
| host   | success | stdout |
+--------+---------+--------+
| red    | True    |        |
| red01  | True    |        |
| red02  | True    |        |
+--------+---------+--------+
</code></pre></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Gregor von Laszewski" aria-label="Gregor von Laszewski"><a class=text-white target=_blank rel="noopener noreferrer" href=https://laszewski.github.io><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Cloudmesh GitHub" aria-label="Cloudmesh GitHub"><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/cloudmesh><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Web Site GitHub" aria-label="Web Site GitHub"><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/cloudmesh/pi><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Cloudmesh Community Slack" aria-label="Cloudmesh Community Slack"><a class=text-white target=_blank rel="noopener noreferrer" href=https://cloudmesh-community.slack.com><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://groups.google.com/g/piplanet><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 The Cloudmesh Projects, Gregor von Laszewski All Rights Reserved</small><p class=mt-2><a href=/pi/about/>About Cloudmesh Pi</a></p></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/pi/js/main.min.ff304e9949717e3408e45c6399bef7e0834e330b2cbb0a5a5ac54227112a59c0.js integrity="sha256-/zBOmUlxfjQI5Fxjmb734INOMwssuwpaWsVCJxEqWcA=" crossorigin=anonymous></script></body></html>